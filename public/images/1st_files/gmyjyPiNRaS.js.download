;/*FB_PKG_DELIM*/

__d("IGDUncaughtErrorState.react",["FBLogger","PolarisHttp500UnexpectedErrorPage.react","cr:8915","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=e.useEffect;function c(e){if(n("cr:8915")!=null&&e!=null&&e instanceof n("cr:8915").ReStoreDbVersionChange){r("FBLogger")("igd_web").info(e);return}r("FBLogger")("igd_web").catching(e).mustfix("Uncaught Error while loading chat: %s",e.toString())}function d(e){var t=o("react-compiler-runtime").c(7),n=e.description,a=e.error,i=e.header,l=e.onPress,d,m;t[0]!==a?(d=function(){c(a)},m=[a],t[0]=a,t[1]=d,t[2]=m):(d=t[1],m=t[2]),u(d,m);var p=n!=null?n:void 0,_=i!=null?i:void 0,f;return t[3]!==l||t[4]!==p||t[5]!==_?(f=s.jsx(r("PolarisHttp500UnexpectedErrorPage.react"),{description:p,header:_,onClick:l}),t[3]=l,t[4]=p,t[5]=_,t[6]=f):f=t[6],f}l.default=d}),98);
__d("IGDInboxErrorState.react",["IGDUncaughtErrorState.react","cr:9977","react","react-compiler-runtime","useCurrentDisplayMode"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=e.useMemo;function c(e){var t=o("react-compiler-runtime").c(10),a=e.error,i=a,l=r("useCurrentDisplayMode")(),u;t[0]!==a||t[1]!==l?(u=n("cr:9977")==null?void 0:n("cr:9977")(a,l),t[0]=a,t[1]=l,t[2]=u):u=t[2];var c=u;if(c!=null){var d,m=(d=c.action)==null?void 0:d.onPress,p;return t[3]!==c.body||t[4]!==c.headline||t[5]!==i||t[6]!==m?(p=s.jsx(r("IGDUncaughtErrorState.react"),{description:c.body,error:i,header:c.headline,onPress:m}),t[3]=c.body,t[4]=c.headline,t[5]=i,t[6]=m,t[7]=p):p=t[7],p}else{var _;return t[8]!==a?(_=s.jsx(r("IGDUncaughtErrorState.react"),{error:a}),t[8]=a,t[9]=_):_=t[9],_}}l.default=c}),98);
__d("LSBeginHandlingSyncForSyncGroup",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(o){return t.sequence([function(r){return t.db.table(1).fetch([[[e[0]]]]).next().then(function(e,r){var o=e.done,a=e.value;return o?n[0]=void 0:(r=a.item,n[9]=new t.Map,n[9].set("group_id",r.groupId),n[9].set("current_cursor",r.currentCursor),n[9].set("sync_status",r.syncStatus),n[9].set("sync_params",r.syncParams),n[9].set("send_sync_params",r.sendSyncParams),n[9].set("min_time_to_sync_timestamp_ms",r.minTimeToSyncTimestampMs),n[9].set("can_ignore_timestamp",r.canIgnoreTimestamp),n[9].set("sync_channel",r.syncChannel),n[9].set("last_sync_request_timestamp_ms",r.lastSyncRequestTimestampMs),n[0]=n[9])})},function(r){var o;return n[0]?n[2]=!1:n[2]=!0,n[2]?t.resolve((o=[e[0],void 0,t.i64.cast([0,4]),void 0,!1],n[3]=o[0],n[4]=o[1],n[5]=o[2],n[6]=o[3],n[7]=o[4],o)):t.sequence([function(e){return n[9]=n[0].get("group_id"),t.filter(t.db.table(3).fetch(),function(e){return t.i64.neq(e.epochId,void 0)&&t.i64.eq(e.syncDatabaseId,n[9])}).next().then(function(e,t){var r=e.done,o=e.value;return r?n[10]=!1:(t=o.item,n[10]=!0)})},function(r){var o;return n[10]?t.resolve((n[17]=n[0].get("group_id"),o=[n[17],void 0,t.i64.cast([0,4]),void 0,!1],n[12]=o[0],n[13]=o[1],n[14]=o[2],n[15]=o[3],n[16]=o[4])):t.sequence([function(r){return n[17]=t.i64.of_float(Date.now()),n[18]=n[0].get("min_time_to_sync_timestamp_ms"),n[19]=n[0].get("last_sync_request_timestamp_ms"),n[20]=n[0].get("can_ignore_timestamp"),n[20]&&e[1]||t.i64.ge(n[17],n[18])?t.sequence([function(r){return e[1]?t.resolve(n[28]=t.i64.cast([0,0])):t.sequence([function(e){return n[29]=n[0].get("group_id"),t.db.table(3).fetch([[["",n[29]]]]).next().then(function(e,r){var o=e.done,a=e.value;return o?n[30]=t.i64.cast([0,0]):(r=a.item,n[30]=r.failureCount)})},function(e){return n[32]=t.i64.mul(t.i64.sub(t.i64.lsl_(t.i64.cast([0,1]),t.i64.to_int32(t.i64.lt(t.i64.cast([0,15]),n[30])?t.i64.cast([0,15]):n[30])),t.i64.cast([0,1])),t.i64.cast([0,500])),n[33]=t.i64.sub(t.i64.add(n[19]==null?t.i64.cast([0,0]):n[19],t.i64.lt(n[32],t.i64.cast([0,3e4]))?n[32]:t.i64.cast([0,3e4])),n[17]),n[28]=t.i64.gt(n[33],t.i64.cast([0,0]))?n[33]:t.i64.cast([0,0])}])},function(e){return n[21]=n[28]}]):t.resolve(n[21]=t.i64.sub(n[18],n[17]))},function(e){return n[22]=n[0].get("group_id"),t.i64.gt(n[21],t.i64.cast([0,0]))?t.sequence([function(e){return n[28]=t.i64.of_float(Date.now()),t.forEach(t.filter(t.db.table(3).fetch(),function(e){return t.i64.eq(e.syncDatabaseId,n[22])}),function(e){var t=e.update,r=e.item;return t({lastDelayedRequestTimestampMs:n[28]})})},function(e){var r;return r=[n[22],n[21],t.i64.cast([0,3]),void 0,!1],n[23]=r[0],n[24]=r[1],n[25]=r[2],n[26]=r[3],n[27]=r[4],r}]):t.sequence([function(e){return n[28]=t.i64.of_float(Date.now()),t.forEach(t.db.table(1).fetch([[[n[22]]]]),function(e){var t=e.update,r=e.item;return t({lastSyncRequestTimestampMs:n[28]})})},function(e){return n[29]=t.i64.of_float(Date.now()),t.forEach(t.filter(t.db.table(3).fetch(),function(e){return t.i64.eq(e.syncDatabaseId,n[22])}),function(e){var t=e.update,r=e.item;return t({lastSyncRequestTimestampMs:n[29]})})},function(e){return n[30]=n[0].get("group_id"),n[31]=t.i64.of_float(Date.now()),n[32]=t.i64.random(),n[45]=t.i64.and_(t.i64.or_(t.i64.lsl_(n[31],t.i64.to_int32(t.i64.cast([0,22]))),t.i64.and_(n[32],t.i64.cast([0,4194303]))),t.i64.cast([2147483647,4294967295])),t.db.table(3).fetch([[["",n[30]]]]).next().then(function(e,r){var o=e.done,a=e.value;return o?t.db.table(3).add({syncDatabaseId:n[30],taskQueueName:"",failureCount:t.i64.cast([0,0]),lastSentTimestampMs:t.i64.cast([0,0]),lastSyncRequestTimestampMs:t.i64.cast([0,0]),epochId:n[45]}):(r=a.item,t.forEach(t.db.table(3).fetch([[["",n[30]]]]),function(e){var t=e.update,r=e.item;return t({epochId:n[45]})}))})},function(e){return n[34]=n[0].get("group_id"),t.db.table(3).fetch([[["",n[34]]]]).next().then(function(e,r){var o=e.done,a=e.value;return o?n[35]=t.i64.cast([0,0]):(r=a.item,n[35]=r.failureCount)})},function(e){var r;return n[37]=n[0].get("send_sync_params"),n[38]=n[0].get("sync_params"),n[39]=n[0].get("current_cursor"),n[40]=new t.Map,n[40].set("database",n[34]),n[40].set("version",t.i64.cast([-1,4294967295])),n[40].set("epoch_id",n[45]),n[40].set("last_applied_cursor",n[39]),n[40].set("sync_params",n[37]?n[38]:void 0),n[40].set("failure_count",t.i64.gt(n[35],t.i64.cast([0,0]))?n[35]:void 0),n[41]=n[0].get("current_cursor"),n[41]===void 0?n[42]=t.i64.cast([0,1]):n[42]=t.i64.cast([0,2]),n[43]=new t.Map,n[43].set("type",n[42]),n[43].set("request_payload",n[40]),n[44]=n[0].get("sync_channel"),r=[n[30],void 0,t.i64.cast([0,1]),n[43],t.i64.eq(n[44],t.i64.cast([0,2]))],n[23]=r[0],n[24]=r[1],n[25]=r[2],n[26]=r[3],n[27]=r[4]}])},function(e){var t;return t=[n[23],n[24],n[25],n[26],n[27]],n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=t[3],n[16]=t[4],t}])},function(e){var t;return t=[n[12],n[13],n[14],n[15],n[16]],n[3]=t[0],n[4]=t[1],n[5]=t[2],n[6]=t[3],n[7]=t[4],t}])},function(e){return n[8]=new t.Map,n[8].set("sync_group_id",n[3]),n[8].set("next_sync_ms",n[4]),n[8].set("work_item_type",n[5]),n[8].set("network_payload",n[6]),n[8].set("skip_realtime_gateway",n[7]),r[0]=n[8]}])},function(e){return t.resolve(r)}])}e.__sproc_name__="LSCoreBeginHandlingSyncForSyncGroupStoredProcedure",e.__tables__=["sync_groups","network_requests"],a.exports=e}),null);
__d("LSBeginHandlingSync",["LSBeginHandlingSyncForSyncGroup"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return r[0]=t.createArray(),t.forEach(t.db.table(1).fetch(),function(o){var a=o.item;return t.sequence([function(o){return t.storedProcedure(n("LSBeginHandlingSyncForSyncGroup"),a.groupId,e[0]).then(function(e){var t;return t=e,r[1]=t[0],t})},function(e){return r[2]=(r[0].push(r[1]),r[0])}])})},function(e){return o[0]=r[0]}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSCoreBeginHandlingSyncStoredProcedure",e.__tables__=["sync_groups"],a.exports=e}),null);
__d("LSBeginHandlingSyncForSyncGroupStoredProcedure",["LSBeginHandlingSyncForSyncGroup","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSBeginHandlingSyncForSyncGroup"),a.syncGroupId,a.ignoreSoftDelay);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("LSBeginHandlingSyncStoredProcedure",["LSBeginHandlingSync","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSBeginHandlingSync"),a.ignoreSoftDelay);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("LSCheckThreadConsistency",["LSIssueNewTask"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return r[0]=new t.Map,r[0].set("threads",e[0]),r[0].set("metadata",e[1]),r[1]=t.toJSON(r[0]),t.storedProcedure(n("LSIssueNewTask"),"check-thread-consistency",t.i64.cast([0,160019]),r[1],void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]),void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]))},function(e){return t.resolve(o)}])}e.__sproc_name__="LSE2EEMessagingMetadataMailboxCheckThreadConsistencyStoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSCheckThreadConsistencyStoredProcedure",["LSCheckThreadConsistency","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSCheckThreadConsistency"),a.threads,a.metadata);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("LSPlatformSyncSystem",["FBLogger","I64","LSBeginHandlingSyncForSyncGroupStoredProcedure","LSBeginHandlingSyncStoredProcedure","LSDatabaseProviderType","LSFactory","LSIntEnum","LSJson","LSMailboxInitialSyncCursor","LSPlatformGraphQLTransport","LSPlatformRealtimeTransport","LSPlatformRequestId","LSPlatformRequestScheduler","LSPlatformServerResponseHandler","LSShape","LSVec","MWPBumpEntityKey","MessengerLogHistory","Promise","ReQL","asyncToGeneratorRuntime","gkx","promiseDone","qex","throttle"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(t,a,l,c,d,m){var p=o("MessengerLogHistory").getInstance("client_sync"),_=new(r("LSPlatformServerResponseHandler"))(l),f=o("LSDatabaseProviderType").isProviderPersisted(t),g=function(r){return t.runInTransaction((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.network_requests).getKeyRange("",r));t!=null&&(yield e.network_requests.put({epochId:void 0,failureCount:(s||(s=o("I64"))).add(t.failureCount,s.one),lastDelayedRequestTimestampMs:t.lastDelayedRequestTimestampMs,lastSentTimestampMs:t.lastSentTimestampMs,lastSyncRequestTimestampMs:t.lastSyncRequestTimestampMs,networkTaskIdentifier:t.networkTaskIdentifier,syncDatabaseId:t.syncDatabaseId,taskQueueName:t.taskQueueName}))});return function(t){return e.apply(this,arguments)}})(),"readwrite",void 0,void 0,i.id+":77")},h=new(r("LSPlatformRequestScheduler")),y=(function(){var i=n("asyncToGeneratorRuntime").asyncToGenerator(function*(i,p){var g=o("LSShape").toRecord(p),h=o("LSShape").toRecord(g.request_payload),y=g.type,C=r("LSPlatformRequestId").generate(),b=o("LSJson").stringify(o("LSShape").ofRecord({database:h.database,epoch_id:h.epoch_id,failure_count:h.failure_count,last_applied_cursor:h.last_applied_cursor,sync_params:h.sync_params,version:(s||(s=o("I64"))).of_string(c)})),v=(s||(s=o("I64"))).equal(i.sync_group_id,(u||(u=o("LSIntEnum"))).ofNumber(1))&&r("gkx")("26386")===!0;if(!v&&i.skip_realtime_gateway){var S=yield o("LSPlatformGraphQLTransport").publish(d,C,y,b,m),R=S[0],L=S[1],E=S[2],k=S[3],I={experiments:E,syncScript:L,target:k};return f?_.maybeEvalInOrderReceived(R,I):l(I)}else{var T=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.tables.sync_groups).getKeyRange(i.sync_group_id)),D=(u||(u=o("LSIntEnum"))).ofNumber(2),x=(s||(s=o("I64"))).to_int32(h.database),$=o("LSMailboxInitialSyncCursor").dgwDisabledSyncGroups.split(",").includes(String(x)),P;return T!=null&&(s||(s=o("I64"))).equal(T.syncChannel,D)?P=D:P=$?(u||(u=o("LSIntEnum"))).ofNumber(1):o("LSMailboxInitialSyncCursor").syncChannel,a.publish({databaseType:x,payload:b,queueName:void 0,requestId:C,syncChannel:P,type_:y}).then(function(){return(e||(e=n("Promise"))).resolve()})}});return function(t,n){return i.apply(this,arguments)}})(),C=function(l){var a=function(n){return t.runInTransaction(function(e){return r("LSBeginHandlingSyncForSyncGroupStoredProcedure")(r("LSFactory")(e),{ignoreSoftDelay:!1,syncGroupId:n})},"readwrite",void 0,void 0,i.id+":192").then(function(e){return C(e[0])})},c=function(t,n){h.schedule(function(){r("promiseDone")(a(t))},(s||(s=o("I64"))).to_string(t),s.to_float(n))},d=o("LSShape").toRecord(l),m=d.work_item_type;if((s||(s=o("I64"))).equal(m,(u||(u=o("LSIntEnum"))).ofNumber(1))||(s||(s=o("I64"))).equal(m,(u||(u=o("LSIntEnum"))).ofNumber(5))){var _=d.network_payload;return _!=null?y(d,_).catch(function(e){if(e.message===o("LSPlatformGraphQLTransport").ServerError)o("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_sync","send_sync_request_graphql_error");else if(e.RE_EXN_ID===o("LSPlatformRealtimeTransport").Timeout||e.RE_EXN_ID===o("LSPlatformRealtimeTransport").NotConnected)o("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_sync","send_sync_request_timeout_or_disc"),p.debug("Publish timed out");else if(o("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_sync","send_sync_request_other_error"),e instanceof Error)r("FBLogger")("messenger_web").catching(e).mustfix("Encountered an JS error while publishing a LS sync request");else{var t="";try{t=JSON.stringify(e)}catch(e){}r("FBLogger")("messenger_web").mustfix("Encountered an JS error while publishing a LS sync request %s",t)}return o("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_sync","handleSyncFailure."+(u||(u=o("LSIntEnum"))).toNumber(o("LSShape").toRecord(_).type)+"."+u.toNumber(d.sync_group_id)),g(d.sync_group_id).then(function(){return a(d.sync_group_id)})}):(r("FBLogger")("ls_web_init").mustfix("Expected networkpayload for sync request but didn't get any"),(e||(e=n("Promise"))).resolve())}if(!(s||(s=o("I64"))).equal(m,(u||(u=o("LSIntEnum"))).ofNumber(3)))return(s||(s=o("I64"))).equal(m,(u||(u=o("LSIntEnum"))).ofNumber(4))||!(s||(s=o("I64"))).equal(m,(u||(u=o("LSIntEnum"))).ofNumber(2))||r("FBLogger")("ls_web_init").mustfix("Native handling for sync group not implemented yet"),(e||(e=n("Promise"))).resolve();var f=d.next_sync_ms;return f!=null?(c(d.sync_group_id,f),(e||(e=n("Promise"))).resolve()):(r("FBLogger")("ls_web_init").mustfix("Expected delay for delayed sync request but didn't get any"),(e||(e=n("Promise"))).resolve())},b=function(o){return(e||(e=n("Promise"))).all(r("LSVec").toArray(o[0]).map(function(e){return C(e)}))},v=function(){r("promiseDone")(t.runInTransaction(function(e){return r("LSBeginHandlingSyncStoredProcedure")(r("LSFactory")(e),{ignoreSoftDelay:!1})},"readwrite",void 0,void 0,i.id+":338").then(b))},S=r("throttle")(v,500),R=function(){return o("ReQL").fromTableAscending(t.tables.sync_groups).subscribe(function(){return S()})},L=function(){return a.subscribeToNonTaskResponses(function(e,t){var n=t.ex,a=t.payload,i={experiments:n,sp:t.sp,syncScript:a,target:t.target};r("promiseDone")(_.maybeEvalInOrderReceived(e,i),function(){return S()},function(e){if(o("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_sync","handle_sync_response_failure"),e instanceof Error)r("FBLogger")("messenger_web").catching(e).mustfix("JS error encountered handling response from MQTT (pdb=%s): %s",f,e.message);else{var t="";try{t=JSON.stringify(e)}catch(e){}r("FBLogger")("messenger_web").mustfix("JS error encountered handling response from MQTT (pdb=%s): %s",f,t)}})})},E=function(){return a.onReconnect(function(a){o("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_sync","resume_sync_reconnect"),!(o("LSMailboxInitialSyncCursor").isWebApp&&a===1&&r("qex")._("2072")===!0&&r("qex")._("2080")===!0)&&(p.debug("Sync System reconnecting"),r("promiseDone")(t.runInTransaction((function(){var a=n("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var i,l=yield(i=o("ReQL")).toArrayAsync(i.mergeJoin(i.fromTableAscending(t.tables.sync_groups),i.fromTableAscending(t.tables.network_requests).getKeyRange("")));return yield(e||(e=n("Promise"))).all(l.map(function(e){var t=e[1];return a.network_requests.put({epochId:void 0,failureCount:t.failureCount,lastDelayedRequestTimestampMs:t.lastDelayedRequestTimestampMs,lastSentTimestampMs:t.lastSentTimestampMs,lastSyncRequestTimestampMs:t.lastSyncRequestTimestampMs,networkTaskIdentifier:t.networkTaskIdentifier,syncDatabaseId:t.syncDatabaseId,taskQueueName:t.taskQueueName})})),r("LSBeginHandlingSyncStoredProcedure")(r("LSFactory")(a),{ignoreSoftDelay:!1})});return function(e){return a.apply(this,arguments)}})(),"readwrite",void 0,void 0,i.id+":432").then(b)))})},k=R(),I=L(),T=E();return S(),{cleanup:function(){k(),T(),I()}}}l.default=c}),98);
__d("MAWThreadConsistencyLogger",["FBLogger","I64","LSAuthorityLevel","LSCheckThreadConsistencyStoredProcedure","LSDatabaseSingleton","LSFactory","LSMessagingThreadTypeUtil","LSShape","LSVec","ODS","Promise","ReQL","WAArrayZip","asyncToGeneratorRuntime","clearInterval","justknobx","promiseDone","qex","setInterval"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=20,m=r("justknobx")._("3207"),p=!1,_=null;function f(){p||(p=!0,r("clearInterval")(_),_=r("setInterval")(function(){document.visibilityState==="visible"&&r("promiseDone")(g())},m*1e3))}function g(){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var t=yield(s||(s=o("LSDatabaseSingleton"))).LSDatabaseSingleton;r("promiseDone")(t.runInTransaction((function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){(c||(c=o("ODS"))).bumpEntityKey(3185,"maw_tc_metric","initiate_snapshot");var a=yield o("ReQL").toArrayAsync(o("ReQL").fromTableDescending(t.threads.index("lastActivityTimestampMs")).filter(y).take(d));if(a.length===0){(c||(c=o("ODS"))).bumpEntityKey(3185,"maw_tc_metric","no_e2ee_threads_fetched_on_client");return}var i;r("qex")._("18")?i=yield(e||(e=n("Promise"))).all(a.map(function(e){return o("ReQL").firstAsync(o("ReQL").fromTableDescending(t.messages.index("messageDisplayOrderOfflineThreadingId")).getKeyRange(e.threadKey))})):i=yield(e||(e=n("Promise"))).all(a.map(function(e){return o("ReQL").firstAsync(o("ReQL").fromTableDescending(t.messages.index("messageDisplayOrder")).getKeyRange(e.threadKey))}));var l=o("WAArrayZip").zip(a,i).map(function(e){var t=e[0],n=e[1];return o("LSShape").ofRecord({is_last_activity_optimistic:C(n),last_activity_timestamp_ms:t.lastActivityTimestampMs,last_read_timestamp_ms:t.lastReadWatermarkTimestampMs,thread_key:t.threadKey})});return r("LSCheckThreadConsistencyStoredProcedure")(r("LSFactory")(t),{metadata:o("LSShape").ofRecord({client_snapshot_timestamp_ms:(u||(u=o("I64"))).of_float(Date.now()),session_timestamp_ms:u.of_int32(Math.round(window.performance.now()))}),threads:r("LSVec").ofArray(l)})});return function(e){return t.apply(this,arguments)}})(),"readonly",void 0,void 0,i.id+":57"),function(){return(c||(c=o("ODS"))).bumpEntityKey(3185,"maw_tc_metric","send_snapshot")},function(e){r("FBLogger")("maw_tc_metric").catching(e).warn("failed to send tc metric snapshot")})}),h.apply(this,arguments)}function y(e){return o("LSMessagingThreadTypeUtil").isArmadilloSecure(e.threadType)&&e.folderName==="inbox"&&(u||(u=o("I64"))).to_int32(e.authorityLevel)>=r("LSAuthorityLevel").AUTHORITATIVE}function C(e){return e==null?!1:(u||(u=o("I64"))).to_int32(e.authorityLevel)<r("LSAuthorityLevel").AUTHORITATIVE}l.startMAWThreadConsistencyLogger=f,l.MAWThreadConsistencyLoggerTakeSnapshot=g}),98);