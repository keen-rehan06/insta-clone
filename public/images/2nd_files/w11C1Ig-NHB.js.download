;/*FB_PKG_DELIM*/

__d("DedupMiThreadCreationCache",["justknobx"],(function(t,n,r,o,a,i,l){"use strict";var e=new Set,s=function(n){var t=r("justknobx")._("4749");t&&e.add(n)};l.DedupMiThreadCreationCache=e,l.addToDedupMiThreadCreationCache=s}),98);
__d("EBInitializeMinosDb",["EBMinosDb","EBMinosLogger","FBLogger","asyncToGeneratorRuntime","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){o("EBMinosLogger").minosLogger.DEV(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Initialize Minos Dev DB"])));try{yield o("EBMinosDb").makeEBMinosDb()}catch(e){r("FBLogger")("wmi_minos").catching(r("getErrorSafe")(e)).mustfix("Runtime error in initializeMinosDb")}}),u.apply(this,arguments)}l.initializeMinosDb=s}),98);
__d("EBMainThreadListeners",["EBReenrollmentTriggerListener","LSDatabaseSingleton","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var t=yield(e||(e=o("LSDatabaseSingleton"))).LSDatabaseSingleton;o("EBReenrollmentTriggerListener").initEBReenrollmentTriggerListener(t)}),u.apply(this,arguments)}l.initEBListeners=s}),98);
__d("LSInstagramE2EEEligibility",[],(function(t,n,r,o,a,i){var e=Object.freeze({UNKNOWN:-1,INELIGIBLE:0,ELIGIBLE:1,REQUIRED:2,DUAL_SEND_ELIGIBLE:3,GROUPS_ELIGIBLE:4});i.default=e}),66);
__d("LSSetIGE2EEEligibility",["LSIssueNewTask"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.filter(t.db.table(176).fetch([[[e[0]]]]),function(n){return t.i64.eq(n.contactId,e[0])&&t.i64.eq(n.e2eeEligibility,e[1])}).next().then(function(o,a){var i=o.done,l=o.value;return i?(r[1]=new t.Map,r[1].set("contact_id",e[0]),r[1].set("new_eligibility",e[1]),r[2]=t.toJSON(r[1]),t.storedProcedure(n("LSIssueNewTask"),"ig_set_e2ee_eligibility",t.i64.cast([0,60001]),r[2],void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]),void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]))):(a=l.item,0)})},function(e){return t.resolve(o)}])}e.__sproc_name__="LSContactSetIGE2EEEligibilityStoredProcedure",e.__tables__=["ig_contact_info"],a.exports=e}),null);
__d("LSSetIGE2EEEligibilityStoredProcedure",["LSSetIGE2EEEligibility","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSSetIGE2EEEligibility"),a.id,a.e2eeEligibility);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("IGDSetIGE2EEEligibility",["I64","LSDatabaseSingleton","LSFactory","LSInstagramE2EEEligibility","LSIntEnum","LSSetIGE2EEEligibilityStoredProcedure","MAWCurrentUser","asyncToGeneratorRuntime","justknobx","promiseDone","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=(e||(e=o("react"))).useEffect;function m(e,t){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield(s||(s=o("LSDatabaseSingleton"))).LSDatabaseSingleton;return n.runInTransaction(function(n){return r("LSSetIGE2EEEligibilityStoredProcedure")(r("LSFactory")(n),{e2eeEligibility:(u||(u=o("LSIntEnum"))).ofNumber(t),id:(c||(c=o("I64"))).of_string(e)})},"readwrite",void 0,void 0,i.id+":31")}),p.apply(this,arguments)}function _(){var e=o("react-compiler-runtime").c(1),t;e[0]===Symbol.for("react.memo_cache_sentinel")?(t=[],e[0]=t):t=e[0],d(f,t)}function f(){if(!r("justknobx")._("2058")){var e=o("MAWCurrentUser").getID();r("promiseDone")(m(e,r("LSInstagramE2EEEligibility").ELIGIBLE))}}l.useUpsertSetIGE2EEEligibilityOnMount=_}),98);
__d("LSGetLatestThreadIds.nop",["I64","LSVec","MAWBridgeSafeActionsWorkerAndUI","Promise","ReQL","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(e,t){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a){var i=[],l=yield o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(a.mi_act_mapping_table)).then(function(e){return e.map(function(e){var t=e.jid;return(s||(s=o("I64"))).to_string(t)})});if(l.length>0){var u=new Set(l);t.forEach(function(e){u.has(e)&&i.push(e)})}return(e||(e=n("Promise"))).resolve([r("LSVec").ofArray(i),!0])}),c.apply(this,arguments)}function d(e){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("MAWBridgeSafeActionsWorkerAndUI").sendAndReceiveBackendWorkerAndUIShared("getLatestThreadIds",{numThreads:(s||(s=o("I64"))).to_int32(e)});return t}),m.apply(this,arguments)}function p(e,t,n,r,o){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a,i,l,c){if(c===void 0&&(c=!1),(s||(s=o("I64"))).gt(l,(s||(s=o("I64"))).zero))try{var m=yield d(l);return c?u(m,t):(e||(e=n("Promise"))).resolve([r("LSVec").ofArray(m),!0])}catch(t){return(e||(e=n("Promise"))).resolve([r("LSVec").ofArray([]),!1])}return(e||(e=n("Promise"))).resolve([r("LSVec").ofArray([]),!0])}),_.apply(this,arguments)}var f=p;p.__nop_name__="getLatestThreadIds",l.default=f}),98);
__d("LSPlatformGraphQLLightspeedRequestQuery.graphql",["relay-runtime"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"deviceId"},{defaultValue:null,kind:"LocalArgument",name:"requestId"},{defaultValue:null,kind:"LocalArgument",name:"requestPayload"},{defaultValue:null,kind:"LocalArgument",name:"requestType"}],t=[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:[{kind:"Variable",name:"device_id",variableName:"deviceId"},{kind:"Variable",name:"request_id",variableName:"requestId"},{kind:"Variable",name:"request_payload",variableName:"requestPayload"},{kind:"Variable",name:"request_type",variableName:"requestType"}],concreteType:"LightspeedWebResponse",kind:"LinkedField",name:"lightspeed_web_request",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"payload",storageKey:null},{alias:null,args:null,concreteType:"LightspeedWebRequestDependency",kind:"LinkedField",name:"dependencies",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"experiments",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"target",storageKey:null}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"LSPlatformGraphQLLightspeedRequestQuery",selections:t,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"LSPlatformGraphQLLightspeedRequestQuery",selections:t},params:{id:"8996647210435532",metadata:{},name:"LSPlatformGraphQLLightspeedRequestQuery",operationKind:"query",text:null}}})();n("relay-runtime").PreloadableQueryRegistry.set(e.params.id,e),a.exports=e}),null);
__d("LSPlatformGraphQLLightspeedRequestQuery",["LSPlatformGraphQLLightspeedRequestQuery.graphql"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e!==void 0?e:e=n("LSPlatformGraphQLLightspeedRequestQuery.graphql");l.query=s}),98);
__d("LSPlatformGraphQLLightspeedRequest",["CometRelay","LSPlatformGraphQLLightspeedRequestQuery","XPlatRelayEnvironment"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,r,a){return o("CometRelay").fetchQuery(o("XPlatRelayEnvironment").getRelayEnvironment(),o("LSPlatformGraphQLLightspeedRequestQuery").query,{deviceId:e,requestId:t,requestPayload:n,requestType:r},a!=null?a:void 0).toPromise().then(function(e){var t,n=e==null||(t=e.viewer)==null?void 0:t.lightspeed_web_request;if(n!=null)return babelHelpers.extends({dependencies:void 0},n)})}l.default=e}),98);
__d("MAWAbPropsClient",["WAAbPropsToUI"],(function(t,n,r,o,a,i,l){"use strict";var e={contents:o("WAAbPropsToUI").prepareAbPropsForUI()};function s(t){e.contents=t}function u(){return e.contents}l.rewrite=s,l.getAbProps=u}),98);
__d("WAChatState",[],(function(t,n,r,o,a,i){"use strict";var e="typing",l="recording_audio",s="idle",u={TYPING:e,RECORDING_AUDIO:l},c={IDLE:s};i.TYPING=e,i.RECORDING_AUDIO=l,i.IDLE=s,i.ACTIVE_CHAT_STATE_TYPE=u,i.IDLE_CHAT_STATE_TYPE=c}),66);
__d("MAWBridgeReceivedChatStateHandler",["I64","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","Promise","ServerTime","WAChatState","emptyFunction"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(t,a){return o("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(t,a.threadJid,"MAWBridgeReceivedChatStateHandler",function(t,i){var l=(s||(s=o("I64"))).of_string(a.senderId),u=s.of_float(3e3+o("ServerTime").getMillis());return a.state===o("WAChatState").TYPING?t.typing_indicator.upsert([i,l],{expirationTimestampMs:u,senderId:l,threadKey:i}).then(r("emptyFunction")):a.state===o("WAChatState").IDLE?t.typing_indicator.delete(i,l).then(r("emptyFunction")):(e||(e=n("Promise"))).resolve()})}l.call=u}),98);
__d("MAWFTSRawStringMatcher",["JSResourceForInteraction","asyncToGeneratorRuntime","nullthrows"],(function(t,n,r,o,a,i,l){"use strict";var e=r("JSResourceForInteraction")("WAFtsMultiLangTokenizer").__setRef("MAWFTSRawStringMatcher"),s=null;function u(){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){return s=yield e.load(),m}),c.apply(this,arguments)}function d(e){return new(r("nullthrows")(s))().tokenize(e)}function m(e,t){var n=Array.from(d(e)).filter(function(e){return e.length>1});if(n.length===0)return!1;var r=Array.from(d(t));return n.every(function(e){return r.some(function(t){return t.startsWith(e)})})}l.load=u}),98);
__d("LSSearchRequestStatusType",[],(function(t,n,r,o,a,i){var e=Object.freeze({PENDING:1,COMPLETE:2,FAILED:3});i.default=e}),66);
__d("MAWFTSMergeCutoverSearchResults",["fbt","I64"],(function(t,n,r,o,a,i,l,s){"use strict";var e;function u(t,n){var r,a,i,l,u=(e||(e=o("I64"))).add((r=t.matchCount)!=null?r:(e||(e=o("I64"))).of_string("1"),(a=n.matchCount)!=null?a:(e||(e=o("I64"))).of_string("1")),c=e.max((i=t.messageTimestampMs)!=null?i:(e||(e=o("I64"))).minus_one,(l=n.messageTimestampMs)!=null?l:(e||(e=o("I64"))).minus_one);return babelHelpers.extends({},t,{contextLine:s._(/*BTDS*/"_j{\"*\":\"{number} matched messages\",\"_1\":\"1 matched message\"}",[s._plural(e.to_int32(u),"number")]).toString(),matchCount:u,matchLengths:void 0,matchOffsets:void 0,messageId:void 0,messageTimestampMs:(e||(e=o("I64"))).equal(c,(e||(e=o("I64"))).minus_one)?void 0:c})}l.mergeCutoverSearchResults=u}),226);
__d("MAWMiActOnActThreadReadyDeferred",["requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e=r("requireDeferred")("MAWMiActOnActThreadReady").__setRef("MAWMiActOnActThreadReadyDeferred");function s(t,n,r,o){return e.load().then(function(e){var a=e.onActThreadReady;return a(t.tables,n,r,o)})}l.default=s}),98);
__d("MAWFTSUniversalSearchQPLLogger",["QPLUserFlow","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e={currentResultCount:0,hasStarted:!1,instanceKey:5e3},s=r("qpl")._(25301522,"2409");function u(){return e.hasStarted&&c(),e.instanceKey++,e.hasStarted=!0,r("QPLUserFlow").start(s,{annotations:{bool:{isInThread:!1}},instanceKey:e.instanceKey}),e.instanceKey}function c(t){!e.hasStarted||t!=null&&e.instanceKey!==t||(e.hasStarted=!1,r("QPLUserFlow").endCancel(s,{instanceKey:e.instanceKey}))}function d(t){var n=t.annotations,o=t.instanceKey,a=t.point;!e.hasStarted||o!=null&&e.instanceKey!==o||(r("QPLUserFlow").addPoint(s,a,{instanceKey:e.instanceKey}),n!=null&&m({annotations:n,instanceKey:e.instanceKey}))}function m(t){var n=t.annotations,o=t.instanceKey;!e.hasStarted||o!=null&&e.instanceKey!==o||r("QPLUserFlow").addAnnotations(s,n,{instanceKey:e.instanceKey})}function p(t){e.currentResultCount=t}function _(t){!e.hasStarted||t!=null&&e.instanceKey!==t||(e.hasStarted=!1,r("QPLUserFlow").endSuccess(s,{annotations:{int:{result_count:e.currentResultCount}},instanceKey:e.instanceKey}))}var f={getCurrentInstanceKey:function(){return e.instanceKey},qplAddAnnotations:m,qplAddPoint:d,qplCancel:c,qplMarkFirstResultShowUp:function(){},qplStart:u,qplSuccess:_,updateCurrentResultCount:p},g=f;l.default=g}),98);
__d("escapeRegExp",[],(function(t,n,r,o,a,i){"use strict";function e(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}i.default=e}),66);
__d("MWContentSearchUtils",["fbt","I64","LSIntEnum","LSMessageSearchType","MAWVault","escapeRegExp","gkx"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u,c=r("gkx")("1798");function d(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function m(e,t){var n=d(e).split(" "),o=d(t),a=[],i=[];return n.forEach(function(e){var t=new RegExp(r("escapeRegExp")(e),"gi"),n=o.matchAll(t),l=Array.from(n),s=l.map(function(e){return e.index}),u=s.map(function(t){return e.length});i.push.apply(i,s),a.push.apply(a,u)}),{matchLengths:a.join(","),matchOffsets:i.join(",")}}function p(t,n,a,i){if(a!=null&&(n===1||(e||(e=o("I64"))).equal(i,(u||(u=o("LSIntEnum"))).ofNumber(r("LSMessageSearchType").MESSAGE)))){var l=o("MAWVault").isVaulted(a)?o("MAWVault").unvault(a):a,c=m(t,l);return babelHelpers.extends({contextLine:l},c)}else return{contextLine:s._(/*BTDS*/"_j{\"*\":\"{number} matched messages\",\"_1\":\"1 matched message\"}",[s._plural(n,"number")]).toString(),matchLengths:void 0,matchOffsets:void 0}}function _(e,t){return e===1&&t!=null?t:void 0}function f(e,t){return e===1&&t!=null?t:void 0}function g(t){return t!=null?(e||(e=o("I64"))).of_float(t):void 0}function h(t,n){var r=(e||(e=o("I64"))).of_float(-t);return n==null?r:e.min(r,n)}function y(t,n){return!c||t.messageTimestampMs==null||n.messageTimestampMs==null?(e||(e=o("I64"))).gt(t.globalIndex,n.globalIndex)?1:(e||(e=o("I64"))).lt(t.globalIndex,n.globalIndex)?-1:0:(e||(e=o("I64"))).lt(t.messageTimestampMs,n.messageTimestampMs)?1:(e||(e=o("I64"))).gt(t.messageTimestampMs,n.messageTimestampMs)?-1:0}l.getContextLineAndMatches=p,l.getMessageOtid=_,l.getMessageId=f,l.getMessageTimestamp=g,l.getGlobalIndex=h,l.searchResultsCompareFn=y}),226);
__d("MWLSParticipant",["I64","LSContactBlockedByViewerStatus","LSContactGender","LSContactType","LSContactWorkForeignEntityType","LSIntEnum","LSMailboxType","MWLSContactTypeExactUtils","ReQL","getLSMediaContactProfilePictureUrl"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u={actual_name:"",blocked_by_viewer_status:(e||(e=o("LSIntEnum"))).ofNumber(r("LSContactBlockedByViewerStatus").UNBLOCKED),contact_id:(s||(s=o("I64"))).zero,contactType:e.ofNumber(r("LSContactType").UNKNOWN),delivered_watermark_timestamp_ms:s.zero,gender:e.ofNumber(r("LSContactGender").UNKNOWN),is_admin:!1,is_messenger_user:!1,mailbox_type:e.ofNumber(r("LSMailboxType").MESSENGER),name:"",nickname:void 0,profile_picture_url:"",rank:0,read_action_timestamp_ms:s.zero,read_watermark_timestamp_ms:s.zero,secondary_name:void 0,thread_key:s.zero,work_company_name:void 0,work_foreign_entity_info:e.ofNumber(r("LSContactWorkForeignEntityType").UNKNOWN),work_job_title:void 0};function c(t){var n,a,i=t[0],l=t[1],s=i.nickname,u=l.authorityLevel,c=l.blockedByViewerStatus,d=l.contactTypeExact,m=l.firstName,p=l.name,_=l.secondaryName,f=l.waConnectStatus;return{actual_name:p,authority_level:u,blocked_by_viewer_status:c,contact_id:i.contactId,contactType:l.contactType,delivered_watermark_timestamp_ms:i.deliveredWatermarkTimestampMs,gender:l.gender,is_admin:(n=i.isAdmin)!=null?n:!1,is_messenger_user:l.isMessengerUser,mailbox_type:(e||(e=o("LSIntEnum"))).ofNumber(r("LSMailboxType").MESSENGER),name:(a=s!=null?s:m)!=null?a:p,nickname:s,profile_picture_url:r("getLSMediaContactProfilePictureUrl")(l),rank:l.rank,read_action_timestamp_ms:i.readActionTimestampMs,read_watermark_timestamp_ms:i.readWatermarkTimestampMs,secondary_name:o("MWLSContactTypeExactUtils").isIgContact(d)?_:void 0,thread_key:i.threadKey,wa_connect_status:f,work_company_name:l.workCompanyName,work_foreign_entity_info:l.workForeignEntityType,work_job_title:l.workJobTitle}}function d(e,t,n){return o("ReQL").mergeJoin(o("ReQL").fromTableAscending(e.tables.participants).getKeyRange(n),t).map(c)}l.empty=u,l.projectOpen=c,l.getAllInOpenThread=d}),98);
__d("MWLSThreadTitle",["fbt","I64","LSMessagingThreadTypeUtil","gkx"],(function(t,n,r,o,a,i,l,s){"use strict";var e;function u(e){return e.length>4?"("+e.length+") "+e.join(", "):e.join(", ")}function c(e){switch(e.length){case 0:return r("gkx")("22885")?"":s._(/*BTDS*/"No participants");case 1:return e[0];case 2:return s._(/*BTDS*/"{participant1} and {participant2}",[s._param("participant1",e[0]),s._param("participant2",e[1])]);case 3:return s._(/*BTDS*/"{participant1}, {participant2} and {participant3}",[s._param("participant1",e[0]),s._param("participant2",e[1]),s._param("participant3",e[2])]);default:return s._(/*BTDS*/"{participant1}, {participant2} and {others_count} others",[s._param("participant1",e[0]),s._param("participant2",e[1]),s._param("others_count",String(e.length-2))])}}function d(t,n,r,a,i,l,s){if(s===void 0&&(s=!1),t!=null)return t;var d=o("LSMessagingThreadTypeUtil").isGroup(a),m=r.filter(function(t){return!(e||(e=o("I64"))).equal(t.contact_id,n)});return d?s?u(m.map(i)):c(m.map(i)):r.length!==1?c(m.map(l)):l(r[0])}function m(e,t,n,r,o){return o===void 0&&(o=!1),d(e,t,n,r,function(e){var t=e.name,n=e.nickname;return n!=null?n:t},function(e){var t=e.actual_name,n=e.nickname;return n!=null?n:t},o).toString()}function p(e,t,n,r){return d(e,t,n,r,function(e){var t=e.actual_name;return t},function(e){var t=e.actual_name;return t}).toString()}function _(e,t,n,r){return d(e,t,n,r,function(e){var t=e.actual_name,n=e.secondary_name;return n!=null?n:t},function(e){var t=e.actual_name,n=e.secondary_name;return n!=null?n:t}).toString()}l.getDefaultThreadTitle=m,l.getThreadTitleWithFullName=p,l.getThreadTitleWithSecondaryNames=_}),226);
__d("MWSearchThreadUtils",["I64","LSIntEnum","LSMessageSearchType","MAWChatJid","MWLSParticipant","MWLSThreadTitle","Promise","ReQL","asyncToGeneratorRuntime","getLSMediaContactProfilePictureUrl","getLSMediaThreadPictureUrl"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(t,a,i){var l=r("getLSMediaThreadPictureUrl")(t);if(l!=null)return(u||(u=n("Promise"))).resolve([l,void 0]);var s,c=(s=o("ReQL")).toArrayAsync(s.leftJoin(s.fromTableAscending(i.tables.participants,[]).getKeyRange(t.threadKey),s.fromTableAscending(i.tables.contacts)).map(function(e){var t=e[0],n=e[1];return n}).filter(Boolean)),d=c.then(function(t){var n=t.length===1&&(e||(e=o("I64"))).equal(t[0].id,a);return t.sort(function(e,t){return e.rank-t.rank}).filter(function(t){return(e||(e=o("I64"))).equal(t.id,a)?n:!0}).map(function(e){return r("getLSMediaContactProfilePictureUrl")(e)})}).then(function(e){var t=e[0];return t!=null?[t,e[1]]:["",void 0]});return d}function d(e,t){return o("ReQL").toArrayAsync(o("MWLSParticipant").getAllInOpenThread(t,o("ReQL").fromTableAscending(t.tables.contacts),e.threadKey))}function m(t,n,a,i,l){if((e||(e=o("I64"))).equal(l,(s||(s=o("LSIntEnum"))).ofNumber(r("LSMessageSearchType").MESSAGE))&&i!=null){var u,c=(u=a.find(function(e){return e.contact_id===i.id}))==null?void 0:u.nickname;return c!=null?c:i.name}return o("MWLSThreadTitle").getThreadTitleWithFullName(n.threadName,t,a,n.threadType)}function p(e,t,n,r){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r){var a=yield o("MAWChatJid").toThreadKeyMaybe(e.tables,t);return a==null?null:f(e,a,n,r)}),_.apply(this,arguments)}function f(e,t,n,r){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r){var a=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.tables.threads).getKeyRange(t));return a==null?null:h(e,a,n,r)}),g.apply(this,arguments)}function h(e,t,n,r){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,r,o){var a=yield(u||(u=n("Promise"))).all([c(t,r,e),d(t,e)]),i=a[0],l=i[0],s=i[1],p=a[1],_=yield m(r,t,p,void 0,o);return{profilePicUrl:l,secondaryProfilePicUrl:s,threadDisplayName:_,threadKey:t.threadKey,threadType:t.threadType}}),y.apply(this,arguments)}l.getThreadPics=c,l.getThreadParticipants=d,l.getThreadDisplayName=m,l.getThreadDataForSearchResult=p,l.getThreadDataByThreadKey=f}),98);
__d("LSThreadPointQueryAndRestoreMessagesWithGroupJID",["LSIssueNewTask"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return r[0]=new t.Map,r[0].set("wa_jid",e[0]),r[0].set("tam_thread_subtype",t.i64.cast([0,0])),r[1]=r[0].get("wa_jid"),r[2]=t.toJSON(r[0]),t.storedProcedure(n("LSIssueNewTask"),t.i64.to_string(r[1]),t.i64.cast([0,1021]),r[2],void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]),void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]))},function(e){return t.resolve(o)}])}e.__sproc_name__="LSE2EEMessagingMetadataMailboxThreadPointQueryAndRestoreMessagesWithGroupJIDStoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSThreadPointQueryAndRestoreMessagesWithGroupJIDStoredProcedure",["LSSynchronousPromise","LSThreadPointQueryAndRestoreMessagesWithGroupJID","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSThreadPointQueryAndRestoreMessagesWithGroupJID"),a.waJid);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("waitForMiActMappingForUniversalSearch",["FBLogger","I64","LSAuthorityLevel","LSFactory","LSThreadPointQueryAndRestoreMessagesWithGroupJIDStoredProcedure","LSThreadPointQueryAndRestoreMessagesWithJIDStoredProcedure","MAWCurrentUser","MAWJids","Promise","ReQL","WAJids","asyncToGeneratorRuntime","emptyFunction","err","getErrorSafe","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=3e4,c=3e4;function d(e){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("ReQL").toArrayAsync(e);return t.some(function(e){return e==null||(s||(s=o("I64"))).lt(e.authorityLevel,(s||(s=o("I64"))).of_int32(r("LSAuthorityLevel").AUTHORITATIVE))})===!1}),m.apply(this,arguments)}function p(e,t,n,r){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,a,i){a===void 0&&(a=r("emptyFunction")),i===void 0&&(i=r("emptyFunction"));var l=(s||(s=o("I64"))).of_string(o("MAWCurrentUser").getID()),u=o("ReQL").leftJoin(o("ReQL").fromTableAscending(e.tables.participants,["contactId"]).getKeyRange(t.serverThreadKey).filter(function(e){return!(s||(s=o("I64"))).equal(e.contactId,l)}),o("ReQL").fromTableAscending(e.tables.contacts)).map(function(e){var t=e[0],n=e[1];return n}),m=null,p={contents:function(){}};function _(){a(t),p.contents()}if(yield d(u))return _();p.contents=u.subscribe((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){if(t.operation!=="delete"&&(m!=null&&window.clearTimeout(m),yield d(u)))return _()});return function(t,n){return e.apply(this,arguments)}})()),m=window.setTimeout(function(){p.contents(),i(r("err")("Contacts timed out"))},c)}),_.apply(this,arguments)}function f(e,t){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a){var l=o("MAWJids").convertChatJidToIntJid(a),s=o("WAJids").interpretAsGroupJid(a)!=null,c=o("ReQL").fromTableAscending(t.tables.mi_act_mapping_table.index("jid")).getKeyRange(l),d=yield o("ReQL").firstAsync(c);if(d!=null)return yield p(t,d),(e||(e=n("Promise"))).resolve(d);var m=null,_=new(e||(e=n("Promise")))(function(e,o){var a={contents:function(){}};function i(t){a.contents(),e(t)}function l(e){a.contents(),o(e)}a.contents=c.subscribe((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,n){n.operation!=="delete"&&(m!=null&&window.clearTimeout(m),yield p(t,n.value,i,l))});return function(t,n){return e.apply(this,arguments)}})()),m=window.setTimeout(function(){l(r("err")("MiActMapping timed out"))},u)});r("promiseDone")(t.runInTransaction(function(e){return s?r("LSThreadPointQueryAndRestoreMessagesWithGroupJIDStoredProcedure")(r("LSFactory")(e),{waJid:l}):r("LSThreadPointQueryAndRestoreMessagesWithJIDStoredProcedure")(r("LSFactory")(e),{waJid:l})},"readwrite",void 0,void 0,i.id+":150"));try{d=yield _}catch(e){r("FBLogger")("messenger_web").warn("[FTS] Issue waiting for mi_act_mapping to be ready",r("getErrorSafe")(e).message)}return d}),g.apply(this,arguments)}l.default=f}),98);
__d("MAWUniversalMessageSearch",["FBLogger","I64","JSResourceForInteraction","LSIntEnum","LSMessageSearchType","LSMessagingThreadTypeUtil","LSSearchRequestStatusType","MAWBridgeSearchMsg","MAWBridgeSendAndReceive","MAWFTSMergeCutoverSearchResults","MAWFTSUniversalSearchQPLLogger","MWContentSearchUtils","MWSearchThreadUtils","Promise","ReQL","asyncToGeneratorRuntime","groupBy","promiseDone","vulture","waitForMiActMappingForUniversalSearch"],(function(t,n,r,o,a,i,l){"use strict";var e=["matchedTerms","recordType"],s,u,c,d=(u||(u=o("LSIntEnum"))).ofNumber(r("LSMessageSearchType").THREAD),m=new Map,p=r("JSResourceForInteraction")("MAWAsyncEBIssueBulkMessagesPointQuery").__setRef("MAWUniversalMessageSearch");function _(e,t,n){return f.apply(this,arguments)}function f(){return f=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){yield e.message_search_queries.put(babelHelpers.extends({hasNextPage:!1,query:t,threadKeyV2:(c||(c=o("I64"))).one,type_:d},n))}),f.apply(this,arguments)}function g(e,t){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=(c||(c=o("I64"))).to_string(t.threadKey);t.matchCount!=null&&m.set(n,(c||(c=o("I64"))).to_float(t.matchCount));var r=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.message_search_results).getKeyRange(d,t.query,t.threadKey));if(r==null)yield e.message_search_results.put(babelHelpers.extends({},t));else{var a=o("MAWFTSMergeCutoverSearchResults").mergeCutoverSearchResults(r,t);yield e.message_search_results.upsert([d,r.query,r.threadKey,r.globalIndex],babelHelpers.extends({},a,{globalIndex:t.globalIndex}))}}),h.apply(this,arguments)}function y(e,t){var n,r=(n=m.get((c||(c=o("I64"))).to_string(e)))!=null?n:0;r+=t,m.set((c||(c=o("I64"))).to_string(e),r)}function C(){m.clear()}function b(e,t){var n;return o("LSMessagingThreadTypeUtil").isArmadilloSecure(t)&&(n=m.get((c||(c=o("I64"))).to_string(e)))!=null?n:null}function v(e,t,n){return S.apply(this,arguments)}function S(){return S=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a,l){r("vulture")("dUWMD7M1UP3WOew6sGAtcsB6lhg="),m.clear(),yield t.runInTransaction((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield _(e,l,{resultCount:(c||(c=o("I64"))).zero,status:(u||(u=o("LSIntEnum"))).ofNumber(r("LSSearchRequestStatusType").PENDING)})});return function(t){return e.apply(this,arguments)}})(),"readwrite",void 0,void 0,i.id+":144"),r("MAWFTSUniversalSearchQPLLogger").qplAddPoint({point:"search_local_result_start"});var f=yield o("MAWBridgeSendAndReceive").sendAndReceive("backend","search",{query:l,searchMode:o("MAWBridgeSearchMsg").MESSAGE_CONTENT_SEARCH}),h=f.map(function(t){if(t.recordType==="msg"){var n=t.matchedTerms,r=t.recordType,o=babelHelpers.objectWithoutPropertiesLoose(t,e);return babelHelpers.extends({},o)}}).filter(Boolean),y=r("groupBy")(h,function(e){return e.chatJid}),C=Object.values(y);r("MAWFTSUniversalSearchQPLLogger").qplAddPoint({annotations:{int:{numResult:C.length}},point:"search_local_result_end"}),r("promiseDone")((s||(s=n("Promise"))).all(C.map((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,s){var u=e[0].chatJid;yield r("waitForMiActMappingForUniversalSearch")(t,u);var m=yield o("MWSearchThreadUtils").getThreadDataForSearchResult(t,u,a,d);if(m!=null){var _=m.profilePicUrl,f=m.secondaryProfilePicUrl,h=m.threadDisplayName,y=m.threadKey,C=m.threadType,b=e.sort(function(e,t){return t.sortOrderMs-e.sortOrderMs})[0],v=e.length===1&&b.msg==null?{id:b.externalId,sortOrderMs:b.sortOrderMs}:null,S={displayName:h,globalIndex:o("MWContentSearchUtils").getGlobalIndex(b.sortOrderMs),matchCount:(c||(c=o("I64"))).of_int32(e.length),profilePicUrl:_,query:l,secondaryProfilePicUrl:f,threadKey:y,threadType:C,type_:d};if(v==null)yield t.runInTransaction((function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n,r;yield g(t,babelHelpers.extends({},S,o("MWContentSearchUtils").getContextLineAndMatches(l,e.length,b==null||(n=b.msg)==null?void 0:n.content,d),{messageId:o("MWContentSearchUtils").getMessageId(e.length,b==null||(r=b.msg)==null?void 0:r.msgId),messageOtid:o("MWContentSearchUtils").getMessageOtid(e.length,b==null?void 0:b.externalId),messageTimestampMs:o("MWContentSearchUtils").getMessageTimestamp(b==null?void 0:b.sortOrderMs)}))});return function(e){return t.apply(this,arguments)}})(),"readwrite",void 0,void 0,i.id+":245");else{r("MAWFTSUniversalSearchQPLLogger").qplAddPoint({point:"fetch_missing_message_"+s+"_start"});var R=yield p.load().then(function(e){var t=e.issueQueryAsPromiseForSearchResult;return t(u,[v])});if(R!=null&&R.length!==0){var L=R[0];r("MAWFTSUniversalSearchQPLLogger").qplAddPoint({point:"fetch_missing_message_"+s+"_end"}),yield t.runInTransaction((function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n;yield g(t,babelHelpers.extends({},S,o("MWContentSearchUtils").getContextLineAndMatches(l,e.length,b==null||(n=b.msg)==null?void 0:n.content,d),{messageOtid:L.externalId,messageTimestampMs:L.sortOrderMs!=null?(c||(c=o("I64"))).of_float(L.sortOrderMs):void 0}))});return function(e){return t.apply(this,arguments)}})(),"readwrite",void 0,void 0,i.id+":284")}else r("MAWFTSUniversalSearchQPLLogger").qplAddPoint({annotations:{bool:{failedFetchingMissingMessage:!0}},point:"fetch_missing_message_"+s+"_end"})}}});return function(t,n){return e.apply(this,arguments)}})())),function(){r("MAWFTSUniversalSearchQPLLogger").qplAddPoint({annotations:{int:{numResult:C.length}},point:"issue_secure_search_query_end"}),r("promiseDone")(t.runInTransaction((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield _(e,l,{hasNextPage:!1,resultCount:(c||(c=o("I64"))).of_int32(C.length),status:(u||(u=o("LSIntEnum"))).ofNumber(r("LSSearchRequestStatusType").COMPLETE)})});return function(t){return e.apply(this,arguments)}})(),"readwrite",void 0,void 0,i.id+":324"))},function(e){r("FBLogger")("maw_fts_search").mustfix("Error while searching in secure threads. Err: %s",e==null?void 0:e.message)})}),S.apply(this,arguments)}l.updateSecureMsgMatchCountForThread=y,l.clearSecureMsgMatchCountForThread=C,l.getSecureMsgsMatchCountForThread=b,l.search=v}),98);
__d("isEBSearchEnabled",["gkx"],(function(t,n,r,o,a,i,l){"use strict";function e(){return r("gkx")("4741")}l.default=e}),98);
__d("MWInboxSecureContentSearch",["I64","JSResourceForInteraction","LSIntEnum","LSMessageSearchType","LSSearchRequestStatusType","MAWBridgeSearchMsg","MAWBridgeSendAndReceive","MAWChatJid","MAWFTSMergeCutoverSearchResults","MAWMiActOnActThreadReadyDeferred","MAWUniversalMessageSearch","MWContentSearchUtils","MWSearchThreadUtils","Promise","ReQL","asyncToGeneratorRuntime","emptyFunction","isEBSearchEnabled","justknobx"],(function(t,n,r,o,a,i,l){"use strict";var e=["matchedTerms","recordType"],s,u,c,d=r("JSResourceForInteraction")("MAWAsyncEBIssueBulkMessagesPointQuery").__setRef("MWInboxSecureContentSearch"),m=r("justknobx")._("2605");function p(e,t,r){return(c||(c=n("Promise"))).all([o("ReQL").mergeJoin(o("ReQL").fromTableAscending(r.tables.participants,[]).getKeyRange(e),o("ReQL").fromTableAscending(r.tables.contacts)),o("ReQL").firstAsync(o("ReQL").fromTableAscending(r.tables.threads).getKeyRange(e))]).then(function(e){var n=e[0],r=e[1],a=n.filter(function(e){var n=e[0],r=e[1],a=(s||(s=o("I64"))).equal(r.id,t);return!a}).map(function(e){var t=e[0],n=e[1];return n});return o("ReQL").firstAsync(a)})}function _(e,t){return o("MAWChatJid").toThreadKeyMaybe(t,e.chatJid).then(function(r){return r==null?(c||(c=n("Promise"))).resolve([null,e]):(c||(c=n("Promise"))).all([o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.threads).getKeyRange(r)),c.resolve(e)])})}function f(e,t){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.tables.contacts).getKeyRange((s||(s=o("I64"))).of_string(t)));return n}),g.apply(this,arguments)}function h(e,t){var n=t.query,a=t.threadKey;return o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.message_search_results).getKeyRange((u||(u=o("LSIntEnum"))).ofNumber(r("LSMessageSearchType").THREAD),n,a))}function y(e,t,a,l,d,m,p,g){g===void 0&&(g=r("LSSearchRequestStatusType").COMPLETE);var y=function(p){return _(e,p).then(function(e){var i=e[0];if(i!=null){var _=e[1],y=_.msg;if(y!=null&&_!=null)return(c||(c=n("Promise"))).all([o("MWSearchThreadUtils").getThreadPics(i,d,m),o("MWSearchThreadUtils").getThreadParticipants(i,m),(s||(s=o("I64"))).equal(l,(u||(u=o("LSIntEnum"))).ofNumber(r("LSMessageSearchType").MESSAGE))?f(m,y.sender):(c||(c=n("Promise"))).resolve(null),(s||(s=o("I64"))).equal(l,(u||(u=o("LSIntEnum"))).ofNumber(r("LSMessageSearchType").THREAD))?h(p,{query:a,threadKey:i.threadKey}):(c||(c=n("Promise"))).resolve(null)]).then(function(e){var m=e[0],f=m[0],h=m[1],C=e[1],b=e[2],v=e[3];(s||(s=o("I64"))).equal(l,(u||(u=o("LSIntEnum"))).ofNumber(r("LSMessageSearchType").THREAD))&&o("MAWUniversalMessageSearch").updateSecureMsgMatchCountForThread(i.threadKey,t);var S=babelHelpers.extends({},o("MWContentSearchUtils").getContextLineAndMatches(a,t,y.content,l),{displayName:o("MWSearchThreadUtils").getThreadDisplayName(d,i,C,b,l),globalIndex:(s||(s=o("I64"))).of_float(-_.sortOrderMs),matchCount:s.of_int32(t),messageId:y.msgId,messageOtid:_.externalId,messageTimestampMs:(s||(s=o("I64"))).equal(l,(u||(u=o("LSIntEnum"))).ofNumber(r("LSMessageSearchType").THREAD))&&t>1?void 0:(s||(s=o("I64"))).of_string(""+_.sortOrderMs),profilePicUrl:(s||(s=o("I64"))).equal(l,(u||(u=o("LSIntEnum"))).ofNumber(r("LSMessageSearchType").MESSAGE))&&b!=null?b.profilePictureUrl:f,query:a,secondaryProfilePicUrl:(s||(s=o("I64"))).equal(l,(u||(u=o("LSIntEnum"))).ofNumber(r("LSMessageSearchType").MESSAGE))&&b!=null?b.profilePictureFallbackUrl:h,threadKey:i.threadKey,threadType:i.threadType,type_:l}),R;if((s||(s=o("I64"))).equal(l,(u||(u=o("LSIntEnum"))).ofNumber(r("LSMessageSearchType").THREAD))||v==null)R=p.message_search_results.put(S);else{var L=o("MAWFTSMergeCutoverSearchResults").mergeCutoverSearchResults(v,S);R=p.message_search_results.upsert([l,v.query,v.threadKey,v.globalIndex],babelHelpers.extends({},L,{globalIndex:S.globalIndex}))}return(c||(c=n("Promise"))).all([p.message_search_queries.put({hasNextPage:void 0,nextPageCursor:void 0,query:a,resultCount:s.of_int32(t),status:(u||(u=o("LSIntEnum"))).ofNumber(g),threadKeyV2:i.threadKey,type_:l}),R]).then(r("emptyFunction"))})}})};return p!=null?y(p):m.runInTransaction(function(e){return y(e)},"readwrite",void 0,void 0,i.id+":280")}function C(e,t,n,r){return b.apply(this,arguments)}function b(){return b=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r,a,i){i!=null&&i.flow.qplAddPoint({instanceKey:i.instanceKey,point:"search_local_result_start"});var l=yield o("MAWBridgeSendAndReceive").sendAndReceive("backend","search",{query:r,searchMode:o("MAWBridgeSearchMsg").MESSAGE_CONTENT_SEARCH});return(c||(c=n("Promise"))).all(l.map(function(n){if(n.recordType==="msg"){var r=n.matchedTerms,a=n.recordType,i=babelHelpers.objectWithoutPropertiesLoose(n,e);return o("MAWChatJid").toThreadKeyMaybe(t.tables,i.chatJid).then(function(e){return[i,e]})}}).filter(Boolean)).then(function(e){var t=a!=null?e.filter(function(e){var t=e[0],n=e[1];return n!=null&&(s||(s=o("I64"))).equal(n,a)}):e.filter(function(e){var t=e[0],n=e[1];return n!=null}),n=null;return a!=null&&(n={int:{numResult:t.length}}),i!=null&&i.flow.qplAddPoint({annotations:babelHelpers.extends({},n),instanceKey:i.instanceKey,point:"search_local_result_end"}),t})}),b.apply(this,arguments)}function v(e,t,a,i,l,s){return(c||(c=n("Promise"))).all(i.map(function(n){return y(n,l,a,(u||(u=o("LSIntEnum"))).ofNumber(r("LSMessageSearchType").MESSAGE),s,e,t)})).then(r("emptyFunction"))}function S(e,t,a,i,l){return(c||(c=n("Promise"))).all(a.map(function(n){return y(n,i,t,(u||(u=o("LSIntEnum"))).ofNumber(r("LSMessageSearchType").MESSAGE),l,e)})).then(r("emptyFunction"))}function R(e,t,a,l,p){return l.runInTransaction(function(n){return n.message_search_queries.put({hasNextPage:void 0,nextPageCursor:void 0,query:e,resultCount:(s||(s=o("I64"))).of_int32(0),status:(u||(u=o("LSIntEnum"))).ofNumber(r("LSSearchRequestStatusType").PENDING),threadKeyV2:t,type_:u.ofNumber(r("LSMessageSearchType").MESSAGE)})},"readwrite",void 0,void 0,i.id+":411").then(function(n){return C(l,e,t,p)}).then(function(_){var f=_.length,g=_.filter(function(e){var t=e[0],n=e[1];return t.msg!=null}).length,h=g,C=function(){var o=_.map(function(e){var t=e[0];return t}).filter(function(e){return e.msg==null});return o.length===0?(c||(c=n("Promise"))).resolve():(o=o.slice(0,m),p.flow.qplAddPoint({annotations:{int:{numRequestedMessages:o.length}},instanceKey:p.instanceKey,point:"fetch_missing_messages_start"}),r("MAWMiActOnActThreadReadyDeferred")(l,t,"MWMessageSearchInput.react",function(t,r){var i=o.map(function(e){return{id:e.externalId,sortOrderMs:e.sortOrderMs}});return d.load().then(function(t){var o=t.issueQueryAsPromiseForSearchResult,s=o(r,i);return s==null?(c||(c=n("Promise"))).resolve():s.then((function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t;if(t.length!==i.length){p.flow.qplAddPoint({annotations:{int:{numRemainingMessages:i.length-t.length}},instanceKey:p.instanceKey,point:"fetch_missing_messages_partial"});var s=i.filter(function(e){return!n.some(function(t){return t.externalId===e.id})});if(s.length>0){var u=yield o(r,s);u!=null&&(n=[].concat(t,u))}}return h=g+n.length,p.flow.qplAddPoint({annotations:{int:{numRespondedMessages:n.length}},instanceKey:p.instanceKey,point:"fetch_missing_messages_end"}),S(l,e,n,h,a)});return function(e){return t.apply(this,arguments)}})())})}))};return(c||(c=n("Promise"))).all([_.map(function(t){var n=t[0];return y(n,f,e,(u||(u=o("LSIntEnum"))).ofNumber(r("LSMessageSearchType").MESSAGE),a,l,void 0,r("LSSearchRequestStatusType").PENDING)}).reduce(function(e,t){return(c||(c=n("Promise"))).all([e,t]).then(r("emptyFunction"))},c.resolve()),r("isEBSearchEnabled")()?C():(c||(c=n("Promise"))).resolve()]).then(function(n){return l.runInTransaction(function(n){return n.message_search_queries.put({hasNextPage:void 0,nextPageCursor:void 0,query:e,resultCount:(s||(s=o("I64"))).of_int32(h),status:(u||(u=o("LSIntEnum"))).ofNumber(r("LSSearchRequestStatusType").COMPLETE),threadKeyV2:t,type_:u.ofNumber(r("LSMessageSearchType").MESSAGE)})},"readwrite",void 0,void 0,i.id+":561")}).then(function(e){return(c||(c=n("Promise"))).resolve()})})}l.getThreadOtherParticipantContact=p,l.addBridgeSearchMsgsToSearchResult=v,l.addMessagesToSearchResult=S,l.searchSecureDatabaseMessages=R}),98);
__d("addMAWBridgeSearchMessagesToUniversalSearch",["I64","LSIntEnum","LSMessageSearchType","MAWCurrentUser","MAWUniversalMessageSearch","MWContentSearchUtils","MWSearchThreadUtils","ReQL","asyncToGeneratorRuntime","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=(e||(e=o("LSIntEnum"))).ofNumber(r("LSMessageSearchType").THREAD);function c(e,t,n,r,o){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,a,l,c){var d;o("MAWUniversalMessageSearch").updateSecureMsgMatchCountForThread(t,l.length);var m=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.tables.message_search_results).getKeyRange(u,a,t)),p=m==null,_=(s||(s=o("I64"))).to_int32((d=m==null?void 0:m.matchCount)!=null?d:(s||(s=o("I64"))).zero),f=_+l.length,g=yield o("MWSearchThreadUtils").getThreadDataByThreadKey(e,t,s.of_string(o("MAWCurrentUser").getID()),u);if(g!=null){var h=g.profilePicUrl,y=g.secondaryProfilePicUrl,C=g.threadDisplayName,b=g.threadType,v=m==null?void 0:m.globalIndex,S=o("MWContentSearchUtils").getGlobalIndex(l[0].sortOrderMs,m==null?void 0:m.globalIndex),R=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n;yield e.message_search_results.upsert([u,a,t,v!=null?v:S],babelHelpers.extends({},o("MWContentSearchUtils").getContextLineAndMatches(a,f,(n=l[0].msg)==null?void 0:n.content,u),{displayName:C,globalIndex:S,matchCount:(s||(s=o("I64"))).of_int32(f),messageTimestampMs:o("MWContentSearchUtils").getMessageTimestamp(l[0].sortOrderMs),profilePicUrl:h,query:a,secondaryProfilePicUrl:y,threadKey:t,threadType:b,type_:u})),p&&(yield e.message_search_queries.put(babelHelpers.extends({},c,{resultCount:(s||(s=o("I64"))).add(c.resultCount,s.one)})))});return function(n){return e.apply(this,arguments)}})();r("promiseDone")(e.runInTransaction((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield R(e)});return function(t){return e.apply(this,arguments)}})(),"readwrite",void 0,void 0,i.id+":113"))}}),d.apply(this,arguments)}l.default=c}),98);
__d("MAWBridgeAddMessageSearchResultHandler",["I64","LSIntEnum","LSMessageSearchType","MAWCurrentUser","MAWFTSRawStringMatcher","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","MWInboxSecureContentSearch","Promise","ReQL","addMAWBridgeSearchMessagesToUniversalSearch","asyncToGeneratorRuntime","emptyFunction","isMAWUniversalSearchWithEBEnabled","promiseDone","waitForMiActMappingForUniversalSearch"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=(u||(u=o("LSIntEnum"))).ofNumber(r("LSMessageSearchType").MESSAGE),d=u.ofNumber(r("LSMessageSearchType").THREAD);function m(t,o,a){return a.length===0?(e||(e=n("Promise"))).resolve():(e||(e=n("Promise"))).all([f(t,o,a),h(t,o,a)]).then(r("emptyFunction"))}function p(e,t){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield o("MAWFTSRawStringMatcher").load();return t.filter(function(t){var r,o=(r=t.msg)==null?void 0:r.content;return o==null?!1:n(e,o)})}),_.apply(this,arguments)}function f(e,t,n){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,a){var i=yield o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(t.message_search_queries).getKeyRange(c));if(i.length!==0)return o("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(t,a[0].chatJid,"MAWBridgeAddMessageSearchResultHandler",function(t,l){return n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var n=i.filter(function(e){return(s||(s=o("I64"))).equal(e.threadKeyV2,l)})[0];if(n!=null){var r=n.query;if(!(r==null||r.length<2)){var u=(s||(s=o("I64"))).to_int32(n.resultCount),c=yield p(r,a);c.length!==0&&(yield o("MWInboxSecureContentSearch").addBridgeSearchMsgsToSearchResult(e,t,n.query,c,u+c.length,s.of_string(o("MAWCurrentUser").getID())))}}})().then(r("emptyFunction"))})}),g.apply(this,arguments)}function h(e,t,n){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){if(r("isMAWUniversalSearchWithEBEnabled")()){var a=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.message_search_queries).getKeyRange(d).filter(function(e){return(s||(s=o("I64"))).equal(e.threadKeyV2,s.one)}));if(a!=null){var i=a.query;if(!(i==null||i.length<2)){var l=yield p(i,n);l.length!==0&&r("promiseDone")(r("waitForMiActMappingForUniversalSearch")(e,n[0].chatJid),function(t){if(t!=null)return r("addMAWBridgeSearchMessagesToUniversalSearch")(e,t.serverThreadKey,i,l,a)})}}}}),y.apply(this,arguments)}l.call=m}),98);
__d("MAWBridgeCallRestoreNativeOpHandler",["MAWMpsGating","Promise","WAJids","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s=r("requireDeferred")("LSProtobufRestoreHandler").__setRef("MAWBridgeCallRestoreNativeOpHandler");function u(t){var r=t.chatJid,a=t.decryptedMessagesProtobufs,i=t.isPointQuery,l=t.taskSource;return o("MAWMpsGating").isFullMpsEnabled()?(e||(e=n("Promise"))).resolve():s.load().then(function(e){return e.handleProtobufRestoreHelper(o("WAJids").threadIdForChatJid(r),{convertedProtobufs:a,type:"convertedProtobufs"},!1,void 0,!1,void 0,i,void 0,void 0,void 0,void 0,l,r)})}l.call=u}),98);
__d("MAWBridgeDeleteGroupInviteHandler",["LSThreadBitOffset","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","Promise","ReQL","asyncToGeneratorRuntime","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,a){return o("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(t,a.threadJid,"MAWBridgeDeleteGroupInviteHandler",(function(){var a=n("asyncToGeneratorRuntime").asyncToGenerator(function*(a,i){var l=yield o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(a.group_invites).getKeyRange(i));return(e||(e=n("Promise"))).all(l.map(function(e){return a.group_invites.delete(e.threadKey,e.inviterId,e.inviteeId)})).then(function(){r("promiseDone")(o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.threads).getKeyRange(i)),function(e){if(e!=null){var n=o("LSThreadBitOffset").clear([105],e.capabilities,e.capabilities2,e.capabilities3,e.capabilities4,e.capabilities5),r=n[0],a=n[1],i=n[2],l=n[3],s=n[4];return t.threads.put(babelHelpers.extends({},e,{capabilities:r,capabilities2:a,capabilities3:i,capabilities4:l,capabilities5:s,snippet:void 0}))}})})});return function(e,t){return a.apply(this,arguments)}})())}l.call=s}),98);
__d("LSIssueThreadRemove",["LSArrayGetObjectAt","LSIsEncryptionVersionSecure","LSIssueNewTaskAndGetTaskID","LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(e){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][issueThreadRemove] Beginning execution."),r[1]=t.i64.of_float(Date.now()),t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))||!1}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,n){var o,a,i=e.done,l=e.value;return i?(r[15]=new t.Map,r[15].set("error_msg","Expected a nonempty query result"),r[15].set("code",t.i64.cast([0,3])),r[15].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),r[16]=t.createArray(),r[17]=(r[16].push(r[15]),r[16]),o=[void 0,r[16]],r[2]=o[0],r[3]=o[1]):(n=l.item,r[15]=new t.Map,r[15].set("backup_id",n.backupId),r[15].set("device_public_key_blob",n.devicePublicKeyBlob),r[15].set("device_private_key_blob",n.devicePrivateKeyBlob),r[15].set("epoch_storage_public_key_blob",n.epochStoragePublicKeyBlob),r[15].set("epoch_storage_private_key_blob",n.epochStoragePrivateKeyBlob),r[15].set("epoch_auth_public_key_blob",n.epochAuthPublicKeyBlob),r[15].set("epoch_auth_private_key_blob",n.epochAuthPrivateKeyBlob),r[15].set("mailbox_root_key_blob",n.mailboxRootKeyBlob),r[15].set("ocmf_client_state_blob",n.ocmfClientStateBlob),r[15].set("orf_client_state_v2_blob",void 0),r[15].set("orf_v2_authority_level",void 0),r[15].set("oblivious_validation_token_blob",n.obliviousValidationTokenBlob),r[15].set("device_id",n.deviceId),r[15].set("backup_tenancy",n.backupTenancy),r[15].set("encryption_version",n.encryptionVersion),r[15].set("revision_version",n.revisionVersion),r[15].set("initialize_restore_result",void 0),r[15].set("device_creation_timestamp_sec",void 0),r[15].set("authority_level",n.authorityLevel),a=[r[15],void 0],r[2]=a[0],r[3]=a[1])})},function(o){return r[5]=new t.Map,r[5].set("value",r[2]),r[5].set("errors",r[3]),r[6]=r[5].get("value"),r[6]!==void 0?t.sequence([function(o){return r[15]=r[6].get("backup_id"),r[16]=r[6].get("device_public_key_blob"),r[17]=r[6].get("device_private_key_blob"),r[18]=r[6].get("epoch_storage_public_key_blob"),r[19]=r[6].get("epoch_storage_private_key_blob"),r[20]=r[6].get("epoch_auth_public_key_blob"),r[21]=r[6].get("epoch_auth_private_key_blob"),r[22]=r[6].get("mailbox_root_key_blob"),r[23]=r[6].get("ocmf_client_state_blob"),r[24]=r[6].get("orf_client_state_v2_blob"),r[25]=r[6].get("orf_v2_authority_level"),r[26]=r[6].get("oblivious_validation_token_blob"),r[27]=r[6].get("device_id"),r[28]=r[6].get("backup_tenancy"),r[29]=r[6].get("encryption_version"),r[30]=r[6].get("revision_version"),r[31]=r[6].get("initialize_restore_result"),r[32]=r[6].get("device_creation_timestamp_sec"),r[33]=r[6].get("authority_level"),t.i64.neq(r[27],void 0)?t.sequence([function(e){return r[36]=void 0,t.i64.neq(r[36],void 0)?t.resolve(r[37]=r[36]):t.sequence([function(e){return r[43]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[44]=t[0],t})},function(e){return r[44]&&(r[53]=(r[43].push(t.i64.cast([0,0])),r[43])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[45]=t[0],t})},function(e){return r[45]&&(r[53]=(r[43].push(t.i64.cast([0,2])),r[43])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[46]=t[0],t})},function(e){return r[46]&&(r[53]=(r[43].push(t.i64.cast([0,3])),r[43])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[47]=t[0],t})},function(e){return r[47]&&(r[53]=(r[43].push(t.i64.cast([0,4])),r[43])),r[48]=t.createArray(),r[49]=t.i64.of_int32(r[43].length),t.i64.gt(r[49],t.i64.cast([0,0]))?t.loopAsync(r[49],function(e){return r[53]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[43],r[53]).then(function(e){var t;return t=e,r[54]=t[0],r[55]=t[1],t})},function(e){return r[56]=(r[48].push(r[54]),r[48])}])}):t.resolve()},function(e){return t.sequence([function(e){return r[53]=t.createArray(),r[54]=t.i64.of_int32(r[48].length),t.i64.gt(r[54],t.i64.cast([0,0]))?t.loopAsync(r[54],function(e){return r[56]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[48],r[56]).then(function(e){var t;return t=e,r[57]=t[0],r[58]=t[1],t})},function(e){return r[59]=(r[53].push(t.i64.to_string(r[57])),r[53])}])}):t.resolve()},function(e){return r[55]=r[53].join(","),r[50]=r[55]}])},function(e){return r[48].some(function(e){return t.i64.eq(r[29],e)})?r[51]=r[29]:r[51]=void 0,t.i64.neq(r[51],void 0)?r[52]=r[51]:r[52]=void 0,r[37]=r[52]}])},function(o){return t.i64.neq(r[37],void 0)?r[38]=r[37]:r[38]=t.i64.cast([0,0]),t.i64.neq(r[28],void 0)?r[39]=r[28]:r[39]=t.i64.cast([0,1]),t.i64.neq(void 0,void 0)?(r[43]=t.i64.of_float(Date.now()),r[40]=t.i64.le(void 0,t.i64.cast([0,0]))?t.i64.cast([0,0]):t.i64.add(void 0,r[43])):(r[43]=t.i64.of_float(Date.now()),r[40]=t.i64.le(t.i64.cast([0,0]),t.i64.cast([0,0]))?t.i64.cast([0,0]):t.i64.add(r[43],t.i64.sub(t.i64.cast([0,0]),t.i64.mod_(r[43],t.i64.cast([0,0]))))),t.storedProcedure(n("LSIssueNewTaskAndGetTaskID"),["eb_upload",":",e[0]].join(""),t.i64.cast([0,50026]),"",void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]),t.i64.cast([0,93]),void 0,r[40],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[41]=t[0],t})},function(n){return t.db.table(177).add({pk:void 0,pendingBackupTaskId:r[41],actionType:t.i64.cast([0,2]),contentType:t.i64.cast([0,2]),backupStatus:t.i64.cast([0,1]),listKey:e[0],uniqueKey:e[0],sortKey:e[1],persistentId:"",isInstamadillo:!1,lsTraceId:e[3],error:e[4]})},function(n){return t.i64.eq(t.i64.cast([0,2]),t.i64.cast([0,1]))?t.i64.eq(t.i64.cast([0,2]),t.i64.cast([0,1]))?(r[43]=t.createArray(),r[45]=(r[43].push("Successfully issued message backup task. act thread id = "),r[43]),r[45]=(r[43].push(e[0]),r[43]),r[45]=(r[43].push(", otid = "),r[43]),r[45]=(r[43].push(e[0]),r[43]),r[44]=r[43].join(""),(function(e){t.logger(e).info(e)})(["[EncryptedBackups][issueThreadRemove] ","",r[44]].join("")),t.resolve()):(r[43]=t.createArray(),r[45]=(r[43].push("Successfully issued message remove task. act thread id = "),r[43]),r[45]=(r[43].push(e[0]),r[43]),r[45]=(r[43].push(", otid = "),r[43]),r[45]=(r[43].push(e[0]),r[43]),r[44]=r[43].join(""),(function(e){t.logger(e).info(e)})(["[EncryptedBackups][issueThreadRemove] ","",r[44]].join("")),t.resolve()):(r[43]=t.createArray(),r[45]=(r[43].push("Successfully issued thread remove task. act thread id = "),r[43]),r[45]=(r[43].push(e[0]),r[43]),r[44]=r[43].join(""),(function(e){t.logger(e).info(e)})(["[EncryptedBackups][issueThreadRemove] ","",r[44]].join("")),t.resolve())},function(e){var n;return r[42]=new t.Map,r[42].set("task_id",r[41]),n=[r[42],void 0],r[34]=n[0],r[35]=n[1]}]):t.sequence([function(n){return r[36]=t.createArray(),r[39]=(r[36].push("Skipping thread remove since EB is disabled. act thread id = "),r[36]),r[39]=(r[36].push(e[0]),r[36]),r[37]=r[36].join(""),(function(e){t.logger(e).info(e)})(["[EncryptedBackups][issueThreadRemove] ","",r[37]].join("")),t.resolve()},function(e){var n;return r[38]=new t.Map,r[38].set("error_code",t.i64.cast([0,24])),r[38].set("stored_procedure","LSEncryptedBackupsIssueThreadRemoveStoredProcedure"),r[38].set("error_message",""),n=[void 0,r[38]],r[34]=n[0],r[35]=n[1]}])},function(e){var t;return t=[r[34],r[35]],r[7]=t[0],r[8]=t[1],t}]):t.sequence([function(n){return r[15]=r[5].get("errors"),r[16]=r[5].get("errors"),r[17]=t.createArray(),r[20]=(r[17].push("Skipping thread remove since EB is disabled. act thread id = "),r[17]),r[20]=(r[17].push(e[0]),r[17]),r[18]=r[17].join(""),(function(e){t.logger(e).info(e)})(["[EncryptedBackups][issueThreadRemove] ","",r[18]].join("")),t.resolve()},function(e){var n;return r[19]=new t.Map,r[19].set("error_code",t.i64.cast([0,1])),r[19].set("stored_procedure","LSEncryptedBackupsIssueThreadRemoveStoredProcedure"),r[19].set("error_message",""),n=[void 0,r[19]],r[7]=n[0],r[8]=n[1]}])},function(e){return r[9]=t.i64.of_float(Date.now()),r[10]=t.i64.random(),r[12]="Finishing execution. Execution time: ",r[13]=t.i64.to_string(t.i64.sub(r[9],r[0])),r[14]=" ms",r[11]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][issueThreadRemove] ",r[11],r[12],r[11],r[13],r[11],r[14]].join("")),t.i64.eq(t.i64.mod_(r[10],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[15]=",",r[16]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"issueThreadRemove",[r[12],r[15],r[13],r[15],r[14]].join(""),r[16],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[r[7],r[8]],o[0]=t[0],o[1]=t[1],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsIssueThreadRemoveStoredProcedure",e.__tables__=["secure_encrypted_backups_client_state","pending_backups_context_v2"],a.exports=e}),null);
__d("LSIssueThreadRemoveStoredProcedure",["LSIssueThreadRemove","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSIssueThreadRemove"),a.actThreadId,a.sortKey,a.source,a.traceId,a.error);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("MAWBridgeDeleteMessagesOfThreadHandler",["EBIsEbEnabled","LSFactory","LSIntEnum","LSIssueThreadRemoveStoredProcedure","LSMEBTaskCreationSource","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){if(n.actionType===2){if(!(yield o("EBIsEbEnabled").isEbEnabledLS(t)))return;yield r("LSIssueThreadRemoveStoredProcedure")(r("LSFactory")(t),{actThreadId:n.threadId,sortKey:n.ts.toString(),source:(e||(e=o("LSIntEnum"))).ofNumber(r("LSMEBTaskCreationSource").TAM_WEB)})}}),u.apply(this,arguments)}l.call=s}),98);
__d("MAWBridgeEphemeralSettingsUpdatedForUIHandler",["MAWChatJid","MAWEphemeralSettingsUpdate","Promise","WATimeUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r){var a=yield o("MAWChatJid").toThreadKeyMaybe(t,r.chatJid);return a!=null?o("MAWEphemeralSettingsUpdate").updateEphemeralSettingsWithTxn(t,r.ephemeralSettingArgs.ephemeralExpirationInSec,yield o("WATimeUtils").castUnixTimeToMillisTime(r.ephemeralSettingArgs.ephemeralLastUpdatedOrSetTimestamp),r.isEphemeralSettingReset,a,!1,r.author):(e||(e=n("Promise"))).resolve()}),u.apply(this,arguments)}l.call=s}),98);
__d("MAWBridgeFulfillRestorePromisePayloadHandler",["MAWEBRestoreTrackingUtils","Promise"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){return t.success?o("MAWEBRestoreTrackingUtils").markEBRestoreSuccess(t.value.traceId):o("MAWEBRestoreTrackingUtils").markEBRestoreFail(t.error.traceId),(e||(e=n("Promise"))).resolve()}l.call=s}),98);
__d("MAWBridgeGroupInfoUpdatedHandler",["I64","MAWMiActMappingTableAPI","MWFBLogger","ODS","ReQL","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m=o("MWFBLogger").MWLogger().tags(["bridgeUIEvent","Occam","Middleware"]);function p(e,t){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){var r,a=yield o("MAWMiActMappingTableAPI").getMappingRowForChatJid(t,n.chatJid);if(a==null){m.WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Missing thread key for chatJid: ",""])),n.chatJid);return}var i=(r=n.threadName)!=null?r:void 0,l=a.serverThreadKey,p=t.threads,_=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(p).getKeyRange(l));if(_==null){(c||(c=o("ODS"))).bumpEntityKey(3185,"armadillo_group_info_update","missing_thread"),m.WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Missing thread for updating group with threadKey: ",""])),(d||(d=o("I64"))).to_string(l));return}else i==null&&(i=_.threadName,m.WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(['MAWDB groupInfo is missing "name" field for threadKey: ',""])),(d||(d=o("I64"))).to_string(l)));var f=n.memberAddMode!=="all_member_add";yield p.put(babelHelpers.extends({},_,{needsAdminApprovalForNewParticipant:f,threadName:i}))}),_.apply(this,arguments)}l.call=p}),98);
__d("MAWBridgeGroupInviteUpdateHandler",["I64","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","MAWUpdateLSThreadCapabilities","Promise","emptyFunction"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(t,a){return o("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(t,a.threadJid,"MAWBridgeGroupInviteUpdateHandler",function(t,i){var l=(s||(s=o("I64"))).of_string(a.inviterId);return(e||(e=n("Promise"))).all([o("MAWUpdateLSThreadCapabilities").setGroupInviteTxn(t,i,l)]).then(r("emptyFunction"))})}l.call=u}),98);
__d("MAWBridgeHandleCOPDigest",["Promise"],(function(t,n,r,o,a,i){"use strict";var e;function l(t,r){return(e||(e=n("Promise"))).resolve()}i.call=l}),66);
__d("MAWBridgeMediaExpiredHandler",["MAWMiActOnMiThreadExistsForJid__DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return o("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(e,t.threadJid,"MAWBridgeMediaExpiredHandler.bs",function(e,n){return e.attachments.delete(n,t.msgId,String(t.plaintextHash))})}l.call=e}),98);
__d("MAWBridgeMsgUpdatedHandler",["FBLogger","MAWAdminMsgCTA","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","MAWMsgFetchLSReplyMsgAndAttachment","MAWUpdateMsg","MsgrWebGating","Promise","ReQL","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t){return o("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(e,t.chatJid,"MAWBridgeMsgUpdatedHandler",(function(){var a=n("asyncToGeneratorRuntime").asyncToGenerator(function*(n,a){var i,l=yield(i=o("ReQL")).firstAsync(i.fromTableAscending(n.messages.index("messageId")).getKeyRange(t.msgId)),s=yield i.firstAsync(i.fromTableAscending(n.attachments).getKeyRange(a,t.msgId));if(l==null){r("FBLogger")("messenger_web").info("existing message is null for type %s, and attachment is null: %s",t.type_,s==null);return}var c=yield o("MAWAdminMsgCTA").getAdminMsgCtaStep(n,a,t),d=yield u(e,t);return o("MAWUpdateMsg").call(n,d,l,c)});return function(e,t){return a.apply(this,arguments)}})())}function u(e,t){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r){if(o("MsgrWebGating").isQuotedMessagesInLsEnabled()){var a=yield o("MAWMsgFetchLSReplyMsgAndAttachment").fetchReplyLocalViaLS(t,r);return a!=null?a:r}return(e||(e=n("Promise"))).resolve(r)}),c.apply(this,arguments)}l.call=s}),98);
__d("LSUpsertAttachmentRange",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(n){return t.sequence([function(n){return t.forEach(t.db.table(17).fetch([[[e[0],e[1]]]]),function(e){return e.delete()})},function(n){return t.db.table(17).add({threadKey:e[0],mediaGroup:e[1],minTimestampMs:e[2],maxTimestampMs:t.i64.cast([2328,1316134911]),hasMoreBefore:e[3],hasMoreAfter:!1,isLoadingBefore:!1,isLoadingAfter:!1,lastLoadedMessageId:e[4]})}])},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxUpsertAttachmentRangeStoredProcedure",e.__tables__=["attachments_ranges_v2__generated"],a.exports=e}),null);
__d("LSUpsertAttachmentRangeStoredProcedure",["LSSynchronousPromise","LSUpsertAttachmentRange","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSUpsertAttachmentRange"),a.threadKey,a.mediaGroup,a.newMinTs,a.hasMoreBefore,a.newLastLoadedMessageId);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("MAWBridgeNewMediaRangeHandler",["I64","LSFactory","LSIntEnum","LSUpsertAttachmentRangeStoredProcedure","MAWMediaGalleryEBTaggingUtils","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","cr:20238","emptyFunction"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(t,a){return o("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(t,a.threadJid,"MAWBridgeNewMediaRangeHandler",function(t,i){var l=(e||(e=o("I64"))).of_float(a.earliestLoadedMediaTs),u=a.mediaGalleryGroup,c=n("cr:20238")!=null?n("cr:20238").getMediaRestoreEBRange(u).getRange(i):null,d=!!(c!=null&&c.hasMoreBefore)&&o("MAWMediaGalleryEBTaggingUtils").isMediaGalleryGroupSupportedForTaggedRestore(u),m=a.hasMoreBefore||d;return r("LSUpsertAttachmentRangeStoredProcedure")(r("LSFactory")(t),{hasMoreBefore:m,mediaGroup:(s||(s=o("LSIntEnum"))).ofNumber(u),newLastLoadedMessageId:a.lastLoadedMessageId,newMinTs:l,threadKey:i})})}function c(e,t){return u(e,t).then(r("emptyFunction"))}l.call=c}),98);
__d("MAWBridgeNoteReplyStartCountdownHandler",["MAWMessageExpirationStorage","Promise"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,r){return r.msgs.reduce(function(e,t){return e.then(function(){o("MAWMessageExpirationStorage").setMessageForExpiration({bridgeMsgStartCountdown:t,expirationEvent:o("MAWMessageExpirationStorage").expirationNoteReplyEvent})})},(e||(e=n("Promise"))).resolve())}l.call=s}),98);
__d("LSCreateE2EEMetadataThread",["LSArrayGetObjectAt","LSBase64Encode.nop","LSIsEncryptionVersionSecure","LSIssueNewTask","LSLogMebClientEvent.nop","LSQplAnnotateInt.nop","LSQplAnnotateString.nop","LSQplMarkPoint.nop","LSQplStartTrace.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(e){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][createE2EEMetadataThread] Beginning execution."),r[1]=t.i64.of_float(Date.now()),t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))||!1}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,n){var o,a,i=e.done,l=e.value;return i?(r[19]=new t.Map,r[19].set("error_msg","Expected a nonempty query result"),r[19].set("code",t.i64.cast([0,3])),r[19].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),r[20]=t.createArray(),r[21]=(r[20].push(r[19]),r[20]),o=[void 0,r[20]],r[2]=o[0],r[3]=o[1]):(n=l.item,r[19]=new t.Map,r[19].set("backup_id",n.backupId),r[19].set("device_public_key_blob",n.devicePublicKeyBlob),r[19].set("device_private_key_blob",n.devicePrivateKeyBlob),r[19].set("epoch_storage_public_key_blob",n.epochStoragePublicKeyBlob),r[19].set("epoch_storage_private_key_blob",n.epochStoragePrivateKeyBlob),r[19].set("epoch_auth_public_key_blob",n.epochAuthPublicKeyBlob),r[19].set("epoch_auth_private_key_blob",n.epochAuthPrivateKeyBlob),r[19].set("mailbox_root_key_blob",n.mailboxRootKeyBlob),r[19].set("ocmf_client_state_blob",n.ocmfClientStateBlob),r[19].set("orf_client_state_v2_blob",void 0),r[19].set("orf_v2_authority_level",void 0),r[19].set("oblivious_validation_token_blob",n.obliviousValidationTokenBlob),r[19].set("device_id",n.deviceId),r[19].set("backup_tenancy",n.backupTenancy),r[19].set("encryption_version",n.encryptionVersion),r[19].set("revision_version",n.revisionVersion),r[19].set("initialize_restore_result",void 0),r[19].set("device_creation_timestamp_sec",void 0),r[19].set("authority_level",n.authorityLevel),a=[r[19],void 0],r[2]=a[0],r[3]=a[1])})},function(e){return r[5]=new t.Map,r[5].set("value",r[2]),r[5].set("errors",r[3]),r[6]=r[5].get("value"),r[6]!==void 0?t.sequence([function(e){return r[19]=r[6].get("backup_id"),r[20]=r[6].get("device_public_key_blob"),r[21]=r[6].get("device_private_key_blob"),r[22]=r[6].get("epoch_storage_public_key_blob"),r[23]=r[6].get("epoch_storage_private_key_blob"),r[24]=r[6].get("epoch_auth_public_key_blob"),r[25]=r[6].get("epoch_auth_private_key_blob"),r[26]=r[6].get("mailbox_root_key_blob"),r[27]=r[6].get("ocmf_client_state_blob"),r[28]=r[6].get("orf_client_state_v2_blob"),r[29]=r[6].get("orf_v2_authority_level"),r[30]=r[6].get("oblivious_validation_token_blob"),r[31]=r[6].get("device_id"),r[32]=r[6].get("backup_tenancy"),r[33]=r[6].get("encryption_version"),r[34]=r[6].get("revision_version"),r[35]=r[6].get("initialize_restore_result"),r[36]=r[6].get("device_creation_timestamp_sec"),r[37]=r[6].get("authority_level"),t.i64.neq(r[31],void 0)?t.sequence([function(e){return r[39]=void 0,t.i64.neq(r[39],void 0)?t.resolve(r[40]=r[39]):t.sequence([function(e){return r[52]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[53]=t[0],t})},function(e){return r[53]&&(r[62]=(r[52].push(t.i64.cast([0,0])),r[52])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[54]=t[0],t})},function(e){return r[54]&&(r[62]=(r[52].push(t.i64.cast([0,2])),r[52])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[55]=t[0],t})},function(e){return r[55]&&(r[62]=(r[52].push(t.i64.cast([0,3])),r[52])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[56]=t[0],t})},function(e){return r[56]&&(r[62]=(r[52].push(t.i64.cast([0,4])),r[52])),r[57]=t.createArray(),r[58]=t.i64.of_int32(r[52].length),t.i64.gt(r[58],t.i64.cast([0,0]))?t.loopAsync(r[58],function(e){return r[62]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[52],r[62]).then(function(e){var t;return t=e,r[63]=t[0],r[64]=t[1],t})},function(e){return r[65]=(r[57].push(r[63]),r[57])}])}):t.resolve()},function(e){return t.sequence([function(e){return r[62]=t.createArray(),r[63]=t.i64.of_int32(r[57].length),t.i64.gt(r[63],t.i64.cast([0,0]))?t.loopAsync(r[63],function(e){return r[65]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[57],r[65]).then(function(e){var t;return t=e,r[66]=t[0],r[67]=t[1],t})},function(e){return r[68]=(r[62].push(t.i64.to_string(r[66])),r[62])}])}):t.resolve()},function(e){return r[64]=r[62].join(","),r[59]=r[64]}])},function(e){return r[57].some(function(e){return t.i64.eq(r[33],e)})?r[60]=r[33]:r[60]=void 0,t.i64.neq(r[60],void 0)?r[61]=r[60]:r[61]=void 0,r[40]=r[61]}])},function(e){return t.i64.neq(r[40],void 0)?r[41]=r[40]:r[41]=t.i64.cast([0,0]),t.i64.neq(r[32],void 0)?r[42]=r[32]:r[42]=t.i64.cast([0,1]),t.nativeOperation(n("LSBase64Encode.nop"),r[27]).then(function(e){var t;return t=e,r[43]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[26]).then(function(e){var t;return t=e,r[44]=t[0],t})},function(e){return r[45]=new t.Map,r[45].set("ocmf_client_state_blob",r[43]==null?"":r[43]),r[45].set("mailbox_root_key",r[44]==null?"":r[44]),r[46]=t.createArray(),t.forEach(t.filter(t.db.table(169).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))}),function(e){var t=e.item;return r[52]=(r[46].push(t.epochId),r[46])})},function(e){return r[50]="Queried locally available epochs. Count: ",r[47]=t.i64.of_int32(r[46].length),r[51]=t.i64.to_string(r[47]),r[48]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][MEBEpochClientUtils] ",r[48],r[50],r[48],r[51]].join("")),t.resolve()},function(e){return r[49]=new t.Map,r[49].set("device_id",r[31]),r[49].set("raw_tokens",r[45]),r[49].set("locally_available_epochs",r[46]),r[38]=r[49]}]):t.resolve(r[38]=void 0)},function(e){return r[7]=r[38]}]):t.resolve((r[19]=r[5].get("errors"),r[20]=r[5].get("errors"),r[7]=void 0))},function(e){return r[8]=t.i64.random(),r[9]=t.i64.to_string(r[8]),r[9]!==void 0?t.nativeOperation(n("LSQplStartTrace.nop"),t.i64.cast([0,679677570]),r[9],!0,void 0):t.resolve()},function(e){return r[9]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,679677570]),r[9],"issue_task"):t.resolve()},function(e){return r[9]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,679677570]),r[9],"request_type","THREAD_POINT_QUERY"):t.resolve()},function(e){return r[9]!==void 0?t.nativeOperation(n("LSQplAnnotateInt.nop"),t.i64.cast([0,679677570]),r[9],"task_creation_source",t.i64.cast([0,76])==null?t.i64.cast([-1,4294967295]):t.i64.cast([0,76])):t.resolve()},function(o){return r[10]=new t.Map,r[10].set("wa_jid",e[0]),r[10].set("offline_thread_key",e[1]),r[10].set("thread_type",e[2]),r[10].set("folder_type",e[3]),r[10].set("bump_timestamp_ms",e[4]),r[10].set("tam_thread_subtype",t.i64.cast([0,0])),r[10].set("created_by_local_device",e[5]),r[10].set("device_context",r[7]),r[10].set("qpl_instance_key",r[9]),r[10].set("should_run_privacy_and_folder_checks",!1),r[10].set("should_only_create_server_thread",!1),r[11]=r[10].get("offline_thread_key"),r[12]=t.toJSON(r[10]),t.storedProcedure(n("LSIssueNewTask"),t.i64.to_string(r[11]),t.i64.cast([0,388]),r[12],void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]),void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]))},function(e){return r[13]=t.i64.of_float(Date.now()),r[14]=t.i64.random(),r[16]="Finishing execution. Execution time: ",r[17]=t.i64.to_string(t.i64.sub(r[13],r[0])),r[18]=" ms",r[15]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][createE2EEMetadataThread] ",r[15],r[16],r[15],r[17],r[15],r[18]].join("")),t.i64.eq(t.i64.mod_(r[14],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[19]=",",r[20]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"createE2EEMetadataThread",[r[16],r[19],r[17],r[19],r[18]].join(""),r[20],t.i64.cast([0,4]))):t.resolve()}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSE2EEMessagingMetadataMailboxCreateE2EEMetadataThreadStoredProcedure",e.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"],a.exports=e}),null);
__d("LSCreateE2EEMetadataThreadStoredProcedure",["LSCreateE2EEMetadataThread","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSCreateE2EEMetadataThread"),a.waJid,a.offlineThreadKey,a.threadType,a.folderType,a.bumpTimestampMs,a.createdByLocalDevice);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("LSCreateOfflineThreadingIDStoredProcedure",["LSCreateOfflineThreadingID","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSCreateOfflineThreadingID"),a.timestampMs);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("MAWCreateOptimisticThread",["I64","LSAuthorityLevel","LSCreateOfflineThreadingIDStoredProcedure","LSFactory","LSIntEnum","LSMailboxType","LSRtcCallState","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(e){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=yield r("LSCreateOfflineThreadingIDStoredProcedure")(r("LSFactory")(t),{timestampMs:(e||(e=o("I64"))).of_float(Date.now())}),a=n[0];return a}),c.apply(this,arguments)}function d(e,t){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){var a={authorityLevel:(s||(s=o("LSIntEnum"))).ofNumber(r("LSAuthorityLevel").OPTIMISTIC),folderName:"inbox",lastReadWatermarkTimestampMs:(e||(e=o("I64"))).of_float(0),mailboxType:s.ofNumber(r("LSMailboxType").MESSENGER),ongoingCallState:s.ofNumber(r("LSRtcCallState").NO_ONGOING_CALL),parentThreadKey:e.zero,threadKey:n,threadType:s.ofNumber(15)};return yield t.threads.put(a),n}),m.apply(this,arguments)}function p(e){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield u(e);return yield d(e,t),t}),_.apply(this,arguments)}l.createOfflineThreadingId=u,l.createOptimisticThreadWithThreadKey=d,l.createOptimisticThread=p}),98);
__d("MAWBridgeOccamadilloCreateE2EEMetadataThreadHandlerV2",["DedupMiThreadCreationCache","FBLogger","I64","LSAuthorityLevel","LSCreateE2EEMetadataThreadStoredProcedure","LSFactory","LSIntEnum","MAWCreateOptimisticThread","MAWFolderUtils","MAWJids","MAWThreadLoadingState","MAWThreadUtils","Promise","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c="[Occamadillo][CreateE2EEMetadataThreadHandlerV2]";function d(e,t){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=t.bumpTimestampMs,a=t.creationSource,i=t.folderId,l=t.jid,u=t.optimisticThreadKey;g(a,l);var c=u!=null?yield e.threads.get((s||(s=o("I64"))).of_string(u)):null;if(c!=null&&o("DedupMiThreadCreationCache").DedupMiThreadCreationCache.has(l)){b(l);return}if(c!=null&&p(c)){h(l,(s||(s=o("I64"))).to_string(c.threadKey));return}var d={bumpTimestampMs:n,createdByLocalDevice:a==="outgoing_message",folderType:o("MAWFolderUtils").systemFolderToLSCoreClientFolder(i),offlineThreadKey:yield _(c,l,e),threadType:o("MAWThreadUtils").getLSThreadTypeFromJid(l),waJid:o("MAWJids").convertChatJidToIntJid(l)};return C(d),r("LSCreateE2EEMetadataThreadStoredProcedure")(r("LSFactory")(e),d).then(function(){o("DedupMiThreadCreationCache").addToDedupMiThreadCreationCache(l)})}),m.apply(this,arguments)}function p(e){var t=(u||(u=o("LSIntEnum"))).unwrapIntEnum(e.authorityLevel);switch(t){case r("LSAuthorityLevel").CLIENT_PARTIAL:case r("LSAuthorityLevel").OPTIMISTIC:case r("LSAuthorityLevel").SERVER_PARTIAL:return!1;case r("LSAuthorityLevel").AUTHORITATIVE:case r("LSAuthorityLevel").AUTHORITATIVE_PENDING_REPLACEMENT:case r("LSAuthorityLevel").CLIENT_AUTHORITATIVE_DELETE:return!0;default:throw r("FBLogger")("messenger_web").mustfixThrow("Unknown authority level")}}function _(e,t,n){return f.apply(this,arguments)}function f(){return f=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r,a){if(t!=null)return(e||(e=n("Promise"))).resolve(t.threadKey);var i=yield o("MAWCreateOptimisticThread").createOfflineThreadingId(a);return y(r,i),yield(e||(e=n("Promise"))).all([o("MAWCreateOptimisticThread").createOptimisticThreadWithThreadKey(a,i),o("MAWThreadLoadingState").markActThreadLoadingAsCompleted(a,{intJid:o("MAWJids").convertChatJidToIntJid(r),threadKey:i})]),i}),f.apply(this,arguments)}function g(e,t){r("FBLogger")("messenger_web").info(c+" handler called from %s for jid %s",e,t)}function h(e,t){r("FBLogger")("messenger_web").info(c+" handler returned early for jid %s because thread %s was already authoritative",e,t)}function y(e,t){r("FBLogger")("messenger_web").info(c+" no thread exists for jid %s, creating optimistic thread with key %s",e,(s||(s=o("I64"))).to_string(t))}function C(e){r("FBLogger")("messenger_web").info(c+" Calling LSCreateE2EEMetadataThreadStoredProcedure with params: bumpTimestampMs: %s, createdByLocalDevice: %s, folderType: %s, offlineThreadKey: %s, offlineThreadKeySource: %s, threadType: %s, waJid: %s",(s||(s=o("I64"))).to_string(e.bumpTimestampMs),e.createdByLocalDevice,s.to_string(e.folderType),s.to_string(e.offlineThreadKey),s.to_string(e.threadType),s.to_string(e.waJid))}function b(e){r("FBLogger")("messenger_web").info(c+" LSCreateE2EEMetadataThreadStoredProcedure has already been called for jid %s, early returning",e)}l.call=d}),98);
__d("MAWBridgeParticipantRemovedHandler",["I64","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,n){return o("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(t,n.threadJid,"MAWBridgeParticipantRemovedHandler",function(t,r){return t.participants.delete(r,(e||(e=o("I64"))).of_string(n.userId))})}l.call=s}),98);
__d("MAWBridgeRavenActionMsgForUIHandler",["I64","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","MAWMsg","MAWRavenUtils","Promise","ReQL","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e=["ephemeralMediaState"],s,u;function c(t,r){return o("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(t,r.threadJid,"MAWBridgeRavenActionMsgForUIHandler",(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a){var i=t.attachments,l=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(i).getKeyRange(a,r.ravenMsgId));if(l==null||l.ephemeralMediaState==null)return(u||(u=n("Promise"))).resolve();var c=(s||(s=o("I64"))).to_int32(l.ephemeralMediaState);if(l.ephemeralMediaViewMode==null)return(u||(u=n("Promise"))).resolve();var d=s.to_int32(l.ephemeralMediaViewMode),m=o("MAWMsg").MAWRavenMsgEphemeralMediaState.cast(c),p=o("MAWMsg").MAWRavenMsgEphemeralType.cast(d);if(m==null||p==null)return(u||(u=n("Promise"))).resolve();var _=o("MAWRavenUtils").getNextRavenMessageEphemeralState(m,p);if(_==null)return(u||(u=n("Promise"))).resolve();var f=l.ephemeralMediaState,g=babelHelpers.objectWithoutPropertiesLoose(l,e),h=babelHelpers.extends({ephemeralMediaState:s.of_int32(_)},g,{transportKey:"WhatsApp"}),y=[g.threadKey,g.messageId,g.attachmentFbid];return i.upsert(y,h)});return function(e,n){return t.apply(this,arguments)}})())}l.call=c}),98);
__d("MAWBridgeReceivedReceiptHandler",["I64","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","MAWTimeUtils","ReQL","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t,n){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,r){var a=(e||(e=o("I64"))).of_string(n.fbid),i=o("MAWTimeUtils").toTimestamp(n.deliveredWatermarkTs),l=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.participants).getKeyRange(r,a));l!=null&&(yield t.participants.put({authorityLevel:l.authorityLevel,contactId:l.contactId,deliveredWatermarkTimestampMs:(e||(e=o("I64"))).equal(i,(e||(e=o("I64"))).zero)?l.deliveredWatermarkTimestampMs:i,groupParticipantJoinState:l.groupParticipantJoinState,isAdmin:l.isAdmin,isModerator:l.isModerator,isSuperAdmin:l.isSuperAdmin,nickname:l.nickname,normalizedSearchTerms:l.normalizedSearchTerms,participantCapabilities:l.participantCapabilities,readActionTimestampMs:l.readActionTimestampMs,readWatermarkTimestampMs:l.readWatermarkTimestampMs,subscribeSource:l.subscribeSource,threadKey:l.threadKey,threadRoles:(e||(e=o("I64"))).zero}))}),u.apply(this,arguments)}function c(e,t){return o("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(e,t.chatJid,"MAWBridgeReceivedReceiptHandler",function(e,n){return s(e,t,n)})}l.callWithoutWaitingForAnything=s,l.call=c}),98);
__d("LSRefetchContactRowIfExists",["LSIssueNewTask"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.filter(t.db.table(7).fetch([[[e[0]]]]),function(n){return t.i64.eq(n.id,e[0])&&t.i64.eq(t.i64.cast([0,1]),t.i64.cast([0,1]))}).next().then(function(o,a){var i=o.done,l=o.value;return i?0:(a=l.item,t.i64.le(a.authorityLevel,t.i64.cast([0,80]))?(r[0]=new t.Map,r[0].set("contact_id",e[0]),r[1]=t.toJSON(r[0]),t.storedProcedure(n("LSIssueNewTask"),"cpq_v2",t.i64.cast([0,207]),r[1],void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]),void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]))):t.resolve())})},function(e){return t.resolve(o)}])}e.__sproc_name__="LSContactRefetchContactRowIfExistsStoredProcedure",e.__tables__=["contacts"],a.exports=e}),null);
__d("LSRefetchContactRowIfExistsStoredProcedure",["LSRefetchContactRowIfExists","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSRefetchContactRowIfExists"),a.id);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("MAWBridgeRefreshContactHandler",["LSFactory","LSRefetchContactRowIfExistsStoredProcedure"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return r("LSRefetchContactRowIfExistsStoredProcedure")(r("LSFactory")(e),{id:t})}l.call=e}),98);
__d("MAWBridgeRemoveMessageSearchResultHandler",["Promise","ReQL","asyncToGeneratorRuntime","emptyFunction"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,a){return n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var r=yield o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(t.message_search_results).filter(function(e){return a.includes(e.messageOtid)}));yield(e||(e=n("Promise"))).all(r.map(function(e){return t.message_search_results.delete(e.type_,e.query,e.threadKey,e.globalIndex)}))})().then(r("emptyFunction"))}l.call=s}),98);
__d("LSIssueAttachmentRestoreTask",["LSArrayGetObjectAt","LSBase64Encode.nop","LSBinaryToHex.nop","LSCreateDerivedKeys.nop","LSFindBackup","LSGetBlobFromInt64BE.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSIssueNewTask","LSLogMebClientEvent.nop","LSOcmfClientMap.nop","LSOpeEncrypt.nop","LSQplAnnotateString.nop","LSQplMarkEnd.nop","LSQplMarkPoint.nop","LSQplStartTrace.nop","LSTruncateSortKey.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(o){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] Beginning execution."),e[7]!==void 0?t.resolve(r[1]=e[7]):t.sequence([function(e){return r[28]=t.i64.random(),r[29]=t.i64.to_string(r[28]),r[29]!==void 0?t.nativeOperation(n("LSQplStartTrace.nop"),t.i64.cast([0,679684335]),r[29],!0,void 0):t.resolve()},function(e){return r[1]=r[29]}])},function(e){return r[1]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,679684335]),r[1],"LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure_start"):t.resolve()},function(e){return t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,o){var a,i=e.done,l=e.value;return i?(a=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,t.i64.cast([0,1]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,t.i64.cast([0,20]),void 0,void 0],r[2]=a[0],r[3]=a[1],r[4]=a[2],r[5]=a[3],r[6]=a[4],r[7]=a[5],r[8]=a[6],r[9]=a[7],r[10]=a[8],r[11]=a[9],r[12]=a[10],r[13]=a[11],r[14]=a[12],r[15]=a[13],r[16]=a[14],r[17]=a[15],r[18]=a[16],r[19]=a[17],a):(o=l.item,t.sequence([function(e){return r[33]=o.backupTenancy,r[32]=o.encryptionVersion,r[28]=void 0,t.i64.neq(r[28],void 0)?t.resolve(r[29]=r[28]):t.sequence([function(e){return r[34]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[35]=t[0],t})},function(e){return r[35]&&(r[44]=(r[34].push(t.i64.cast([0,0])),r[34])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[36]=t[0],t})},function(e){return r[36]&&(r[44]=(r[34].push(t.i64.cast([0,2])),r[34])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[37]=t[0],t})},function(e){return r[37]&&(r[44]=(r[34].push(t.i64.cast([0,3])),r[34])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[38]=t[0],t})},function(e){return r[38]&&(r[44]=(r[34].push(t.i64.cast([0,4])),r[34])),r[39]=t.createArray(),r[40]=t.i64.of_int32(r[34].length),t.i64.gt(r[40],t.i64.cast([0,0]))?t.loopAsync(r[40],function(e){return r[44]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[34],r[44]).then(function(e){var t;return t=e,r[45]=t[0],r[46]=t[1],t})},function(e){return r[47]=(r[39].push(r[45]),r[39])}])}):t.resolve()},function(e){return t.sequence([function(e){return r[44]=t.createArray(),r[45]=t.i64.of_int32(r[39].length),t.i64.gt(r[45],t.i64.cast([0,0]))?t.loopAsync(r[45],function(e){return r[47]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[39],r[47]).then(function(e){var t;return t=e,r[48]=t[0],r[49]=t[1],t})},function(e){return r[50]=(r[44].push(t.i64.to_string(r[48])),r[44])}])}):t.resolve()},function(e){return r[46]=r[44].join(","),r[41]=r[46]}])},function(e){return r[39].some(function(e){return t.i64.eq(r[32],e)})?r[42]=r[32]:r[42]=void 0,t.i64.neq(r[42],void 0)?r[43]=r[42]:r[43]=void 0,r[29]=r[43]}])},function(e){var n;return t.i64.neq(r[29],void 0)?r[30]=r[29]:r[30]=t.i64.cast([0,0]),t.i64.neq(r[33],void 0)?r[31]=r[33]:r[31]=t.i64.cast([0,1]),n=[o.backupId,o.deviceId,o.mailboxRootKeyBlob,o.ocmfClientStateBlob,void 0,void 0,r[30],r[31],o.epochAuthPublicKeyBlob,o.epochAuthPrivateKeyBlob,o.devicePublicKeyBlob,o.devicePrivateKeyBlob,o.epochStoragePublicKeyBlob,o.epochStoragePrivateKeyBlob,o.obliviousValidationTokenBlob,o.authorityLevel,void 0,void 0],r[2]=n[0],r[3]=n[1],r[4]=n[2],r[5]=n[3],r[6]=n[4],r[7]=n[5],r[8]=n[6],r[9]=n[7],r[10]=n[8],r[11]=n[9],r[12]=n[10],r[13]=n[11],r[14]=n[12],r[15]=n[13],r[16]=n[14],r[17]=n[15],r[18]=n[16],r[19]=n[17]}]))})},function(e){return t.storedProcedure(n("LSFindBackup")).then(function(e){var t;return t=e,r[21]=t[0],t})},function(o){return t.blobs.neq(r[5],void 0)?t.i64.neq(r[3],void 0)?r[21]!==void 0?t.blobs.neq(r[4],void 0)?t.sequence([function(o){return r[28]=t.createArray(),r[35]=(r[28].push(r[21]),r[28]),r[35]=(r[28].push(e[1]),r[28]),r[29]=t.toJSON(r[28]),r[30]=t.createArray(),r[35]=(r[30].push(t.i64.cast([0,32])),r[30]),t.nativeOperation(n("LSGetBlobFromString.nop"),["thread_ope_key","_",e[5]].join("")).then(function(e){var t;return t=e,r[31]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),r[31],void 0,r[4],r[30]).then(function(e){var t;return t=e,r[32]=t[0],t})},function(e){return r[32]?r[33]=!1:r[33]=!0,r[33]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoUtils] Got null keys while deriving message list OPE key. Returning null blobish"),r[36]="Got null keys while deriving message list OPE key. Returning null blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoUtils] ","",r[36]].join("")),r[35]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoUtils",r[36],r[35],t.i64.cast([0,3]))},function(e){return r[34]=void 0}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[32],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[35]=t[0],r[36]=t[1],t})},function(e){return r[34]=r[35]}])},function(o){return t.blobs.neq(r[34],void 0)?t.sequence([function(o){return t.i64.neq(e[9],void 0)?r[35]=e[9]:r[35]=t.i64.cast([-1,4294967295]),t.nativeOperation(n("LSGetBlobFromInt64BE.nop"),e[6]).then(function(e){var t;return t=e,r[36]=t[0],t})},function(e){return t.nativeOperation(n("LSTruncateSortKey.nop"),r[36]).then(function(e){var t;return t=e,r[37]=t[0],t})},function(e){return t.nativeOperation(n("LSOpeEncrypt.nop"),r[34],r[37],t.i64.cast([0,16])).then(function(e){var t;return t=e,r[38]=t[0],t})},function(e){return t.nativeOperation(n("LSBinaryToHex.nop"),r[38]).then(function(e){var t;return t=e,r[39]=t[0],t})},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),r[29]).then(function(e){var t;return t=e,r[40]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("YXR0YWNobWVudF9rZXlfc2NvcGU="),r[40]).then(function(e){var t;return t=e,r[41]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[5],r[41]).then(function(e){var t;return t=e,r[42]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[42]).then(function(e){var t;return t=e,r[43]=t[0],t})},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),r[21]).then(function(e){var t;return t=e,r[44]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("bWFpbGJveF9pZF9zY29wZQ=="),r[44]).then(function(e){var t;return t=e,r[45]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[5],r[45]).then(function(e){var t;return t=e,r[46]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[46]).then(function(e){var t;return t=e,r[47]=t[0],t})},function(o){return t.nativeOperation(n("LSGetBlobFromString.nop"),e[4]).then(function(e){var t;return t=e,r[48]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("bWVzc2FnZV9pZF9zY29wZQ=="),r[48]).then(function(e){var t;return t=e,r[49]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[5],r[49]).then(function(e){var t;return t=e,r[50]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[50]).then(function(e){var t;return t=e,r[51]=t[0],t})},function(o){return t.nativeOperation(n("LSGetBlobFromString.nop"),e[4]).then(function(e){var t;return t=e,r[52]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),r[52]).then(function(e){var t;return t=e,r[53]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[5],r[53]).then(function(e){var t;return t=e,r[54]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[54]).then(function(e){var t;return t=e,r[55]=t[0],t})},function(o){return t.nativeOperation(n("LSGetBlobFromString.nop"),e[5]).then(function(e){var t;return t=e,r[56]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("dGhyZWFkX2lkX3Njb3Bl"),r[56]).then(function(e){var t;return t=e,r[57]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[5],r[57]).then(function(e){var t;return t=e,r[58]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[58]).then(function(e){var t;return t=e,r[59]=t[0],t})},function(o){return r[60]=new t.Map,r[60].set("attachment_index_key",r[43]==null?"":r[43]),r[60].set("backup_ent_fbid",e[0]),r[60].set("delivery_object_id",e[1]),r[60].set("device_id",r[3]),r[60].set("mailbox_partial_id",r[47]==null?"":r[47]),r[60].set("media_type",e[3]),r[60].set("message_partial_id",r[51]==null?"":r[51]),r[60].set("product_type",e[2]),r[60].set("salt_partial_id",r[55]==null?"":r[55]),r[60].set("sort_key",r[39]==null?"":r[39]),r[60].set("thread_partial_id",r[59]==null?"":r[59]),r[60].set("trace_id",r[1]),r[60].set("source",r[35]),r[61]=new t.Map,r[61].set("otid",e[4]),r[61].set("server_thread_key",e[8]),r[61].set("timestamp",t.i64.to_string(e[6])),t.nativeOperation(n("LSBase64Encode.nop"),r[5]).then(function(e){var t;return t=e,r[62]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[4]).then(function(e){var t;return t=e,r[63]=t[0],t})},function(o){return r[64]=new t.Map,r[64].set("ocmf_client_state_blob",r[62]==null?"":r[62]),r[64].set("mailbox_root_key",r[63]==null?"":r[63]),r[65]=t.createArray(),r[76]=(r[65].push(e[4]),r[65]),r[76]=(r[65].push(e[1]),r[65]),r[66]=t.toJSON(r[65]),r[60].set("raw_identifiers",r[61]),r[60].set("backup_id",r[21]),r[60].set("thread_id",e[5]),t.nativeOperation(n("LSGetBlobFromString.nop"),r[66]).then(function(e){var t;return t=e,r[67]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),r[67]).then(function(e){var t;return t=e,r[68]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[5],r[68]).then(function(e){var t;return t=e,r[69]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[69]).then(function(e){var t;return t=e,r[70]=t[0],t})},function(e){return r[60].set("salt_partial_access_token",r[70]==null?"":r[70]),t.nativeOperation(n("LSGetBlobFromString.nop"),r[29]).then(function(e){var t;return t=e,r[71]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("YXR0YWNobWVudF9rZXlfc2FsdF9zY29wZQ=="),r[71]).then(function(e){var t;return t=e,r[72]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[5],r[72]).then(function(e){var t;return t=e,r[73]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[73]).then(function(e){var t;return t=e,r[74]=t[0],t})},function(e){return r[60].set("salt_partial_attachment_index_key",r[74]==null?"":r[74]),r[60].set("raw_tokens",r[64]),r[75]=t.toJSON(r[60]),t.storedProcedure(n("LSIssueNewTask"),"encrypted_backups_attachment_restore",t.i64.cast([0,50020]),r[75],void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]),void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]))}]):t.sequence([function(e){return r[37]=["LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",".","OPE_key_is_null"].join(""),r[1]!==void 0&&r[37]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,679684335]),r[1],"error",r[37]):t.resolve()},function(e){return r[1]!==void 0?t.nativeOperation(n("LSQplMarkEnd.nop"),t.i64.cast([0,679684335]),r[1],!1):t.resolve()},function(e){return r[36]="OPE key is null for IssueAttachmentRestoreTask",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ","",r[36]].join("")),r[35]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",r[36],r[35],t.i64.cast([0,3]))}])}]):t.sequence([function(e){return r[30]=["LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",".","missing_mailbox_root_key"].join(""),r[1]!==void 0&&r[30]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,679684335]),r[1],"error",r[30]):t.resolve()},function(e){return r[1]!==void 0?t.nativeOperation(n("LSQplMarkEnd.nop"),t.i64.cast([0,679684335]),r[1],!1):t.resolve()},function(e){return r[29]="Missing mailbox_root_key for IssueAttachmentRestoreTask",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ","",r[29]].join("")),r[28]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",r[29],r[28],t.i64.cast([0,3]))}]):t.sequence([function(e){return r[30]=["LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",".","missing_backup_id"].join(""),r[1]!==void 0&&r[30]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,679684335]),r[1],"error",r[30]):t.resolve()},function(e){return r[1]!==void 0?t.nativeOperation(n("LSQplMarkEnd.nop"),t.i64.cast([0,679684335]),r[1],!1):t.resolve()},function(e){return r[29]="Missing backup_id for IssueAttachmentRestoreTask",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ","",r[29]].join("")),r[28]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",r[29],r[28],t.i64.cast([0,3]))}]):t.sequence([function(e){return r[30]=["LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",".","missing_device_id"].join(""),r[1]!==void 0&&r[30]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,679684335]),r[1],"error",r[30]):t.resolve()},function(e){return r[1]!==void 0?t.nativeOperation(n("LSQplMarkEnd.nop"),t.i64.cast([0,679684335]),r[1],!1):t.resolve()},function(e){return r[29]="Missing device_id for IssueAttachmentRestoreTask",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ","",r[29]].join("")),r[28]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",r[29],r[28],t.i64.cast([0,3]))}]):t.sequence([function(e){return r[30]=["LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",".","missing_ocmf_client_state_blob"].join(""),r[1]!==void 0&&r[30]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,679684335]),r[1],"error",r[30]):t.resolve()},function(e){return r[1]!==void 0?t.nativeOperation(n("LSQplMarkEnd.nop"),t.i64.cast([0,679684335]),r[1],!1):t.resolve()},function(e){return r[29]="Missing ocmf_client_state_blob for IssueAttachmentRestoreTask",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ","",r[29]].join("")),r[28]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",r[29],r[28],t.i64.cast([0,3]))}])},function(e){return r[22]=t.i64.of_float(Date.now()),r[23]=t.i64.random(),r[25]="Finishing execution. Execution time: ",r[26]=t.i64.to_string(t.i64.sub(r[22],r[0])),r[27]=" ms",r[24]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ",r[24],r[25],r[24],r[26],r[24],r[27]].join("")),t.i64.eq(t.i64.mod_(r[23],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[28]=",",r[29]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",[r[25],r[28],r[26],r[28],r[27]].join(""),r[29],t.i64.cast([0,4]))):t.resolve()}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",e.__tables__=["secure_encrypted_backups_client_state"],a.exports=e}),null);
__d("LSIssueAttachmentRestoreTaskStoredProcedure",["LSIssueAttachmentRestoreTask","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSIssueAttachmentRestoreTask"),a.backupEntFbid,a.deliveryObjectId,a.productType,a.mediaType,a.messageId,a.threadId,a.sortOrder,a.traceId,a.serverThreadKey,a.source);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("MAWAsyncEBMediaDownloadPromise",[],(function(t,n,r,o,a,i){"use strict";var e=new Map;function l(t){var n=t.messageId,r=t.objectId,o=t.plaintextHash,a=t.threadId,i=e.get(r);e.set(r,i!=null?[].concat(i,[{messageId:n,plaintextHash:o,threadId:a}]):[{messageId:n,plaintextHash:o,threadId:a}])}function s(t){var n;return(n=e.get(t))==null?void 0:n.pop()}i.setMediaDownloadPayload=l,i.retrieveMediaDownloadPayload=s}),66);
__d("MAWBridgeResignAttachmentCDNUrlHandler",["I64","LSFactory","LSIssueAttachmentRestoreTaskStoredProcedure","MAWAsyncEBMediaDownloadPromise","MAWBridgeFireAndForget","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e,s="-8";function u(t,n){var a,i=n.traceId,l=(a=n.skipLegacyMediaDownloadFlow)!=null?a:!1;function u(e,t,n){!l&&i!=null&&o("MAWBridgeFireAndForget").fireAndForget("backend","addMediaDownloadQpl",{annotations:n!=null?n:void 0,pointName:t,qplInstanceKey:i,qplType:e})}return u("point","resign_cdn_url_bridge_handler_start"),o("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(t,n.threadJid,"MAWBridgeResignAttachmentCDNUrlHandler",function(t,a){var l={backupEntFbid:(e||(e=o("I64"))).of_string(s),deliveryObjectId:n.deliveryObjectId,mediaType:n.mediaType,messageId:n.messageId,productType:n.productType,serverThreadKey:e.to_string(a),sortOrder:e.of_float(n.sortOrder),threadId:n.threadId,traceId:i.toString()};return n.skipLegacyMediaDownloadFlow!==!0&&o("MAWAsyncEBMediaDownloadPromise").setMediaDownloadPayload({messageId:n.msgId,objectId:n.deliveryObjectId,plaintextHash:n.plaintextHash,threadId:n.threadId}),u("point","resign_cdn_url_issue_attachment_task",{string:{taskTraceId:l.traceId}}),r("LSIssueAttachmentRestoreTaskStoredProcedure")(r("LSFactory")(t),l).then(function(){u("point","resign_cdn_url_issue_attachment_task_end")}).catch(function(e){u("fail","resign_cdn_url_issue_attachment_task_fail",{string:{error:e.toString()}})})})}l.call=u}),98);
__d("MAWBridgeTraceUtils",["I64","Promise","ReQL"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(t,r,a){return o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(t.data_trace_meta).filter(function(e){var t=e.contextThree;return t!=null&&r===t&&(s||(s=o("I64"))).equal(e.traceType,a)?e.shouldFlush===!1:!1})).then(function(t){return t.length!==0?(e||(e=n("Promise"))).resolve(t[0].traceId):(e||(e=n("Promise"))).resolve()})}l.getTraceId=u}),98);
__d("MAWBridgeStartTraceHandler",["ArmadilloDataTraceCheckPoint","ArmadilloDataTraceType","I64","LSAppendDataTraceAddonStoredProcedure","LSDataTraceTag","LSFactory","LSRequestId","MAWAckLevel","MAWBridgeTraceUtils","MAWMsg","MAWTimeUtils","Promise","gkx","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(e,t,n){return e.data_trace_meta.add({contextOne:void 0,contextThree:t.externalId,contextTwo:void 0,foregroundTimestampMs:(s||(s=o("I64"))).zero,initTimestampMs:o("MAWTimeUtils").toTimestamp(t.ts),predefinedId:void 0,shouldFlush:!1,traceId:n,traceType:t.traceType}).then(function(){return r("LSAppendDataTraceAddonStoredProcedure")(r("LSFactory")(e),{checkPointId:o("ArmadilloDataTraceCheckPoint").traceCreated,dataTraceId:n,syncChannel:(s||(s=o("I64"))).neg_one})}).then(function(){var a;if(!(t.threadKey==null||!r("gkx")("23995")))return r("LSAppendDataTraceAddonStoredProcedure")(r("LSFactory")(e),{checkPointId:o("ArmadilloDataTraceCheckPoint").armadilloTlcControlOpenThread,dataTraceId:n,syncChannel:(s||(s=o("I64"))).neg_one,tags:(a=t.threadKey)!=null?a:void 0})})}function c(t,a){var i=a.ack,l=a.traceType;return i===o("MAWAckLevel").ACK.clock?o("MAWBridgeTraceUtils").getTraceId(t,a.externalId,a.traceType).then(function(i){if(i==null){var c=r("LSRequestId").generate();return(s||(s=o("I64"))).equal(l,o("ArmadilloDataTraceType").armadilloMessageSend)?u(t,a,c).then(function(){var e=a.threadType;if(e!=="User")return r("LSAppendDataTraceAddonStoredProcedure")(r("LSFactory")(t),{checkPointId:o("ArmadilloDataTraceCheckPoint").traceGroupMessage,dataTraceId:c,syncChannel:(s||(s=o("I64"))).neg_one})}).then(function(){if(a.isFirstMsg)return r("LSAppendDataTraceAddonStoredProcedure")(r("LSFactory")(t),{checkPointId:o("ArmadilloDataTraceCheckPoint").armadilloActMessageSend,dataTraceId:c,syncChannel:(s||(s=o("I64"))).neg_one,tags:"first_msg=1"})}).then(function(){var i=a.type_,l=i===o("MAWMsg").text?o("ArmadilloDataTraceCheckPoint").traceTextMessage:i===o("MAWMsg").ptt||i===o("MAWMsg").image||i===o("MAWMsg").video||i===o("MAWMsg").gif?o("ArmadilloDataTraceCheckPoint").traceMediaMessage:void 0;return l==null||r("promiseDone")(r("LSAppendDataTraceAddonStoredProcedure")(r("LSFactory")(t),{checkPointId:l,dataTraceId:c,syncChannel:(s||(s=o("I64"))).neg_one})),(e||(e=n("Promise"))).resolve(l)}).then(function(e){if(e!=null&&(s||(s=o("I64"))).equal(e,o("ArmadilloDataTraceCheckPoint").traceMediaMessage)){var n=a.type_,i=n===o("MAWMsg").image?o("LSDataTraceTag").image:n===o("MAWMsg").ptt?o("LSDataTraceTag").audio:n===o("MAWMsg").video?o("LSDataTraceTag").video:n===o("MAWMsg").gif?o("LSDataTraceTag").animatedImage:o("LSDataTraceTag").none;return r("LSAppendDataTraceAddonStoredProcedure")(r("LSFactory")(t),{checkPointId:o("ArmadilloDataTraceCheckPoint").richMediaMediaSendAttachmentType,dataTraceId:c,syncChannel:(s||(s=o("I64"))).neg_one,tags:String(i)})}}):u(t,a,c)}}):(e||(e=n("Promise"))).resolve()}l.call=c}),98);
__d("MAWBridgeXMAShareTombstonedHandler",["FBLogger","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","Promise","ReQL","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,a){var i=String(a.xmaId);return o("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(t,a.threadJid,"MAWBridgeXMAShareTombstonedHandler",function(t,l){return t.attachments.get(l,a.msgId,i).then(function(s){if(s==null)return(e||(e=n("Promise"))).resolve();var u=[s.defaultCtaId,s.attachmentCta1Id,s.attachmentCta2Id,s.attachmentCta3Id].filter(Boolean),c=u.map(function(e){return t.attachment_ctas.delete(e)});return(e||(e=n("Promise"))).all(c).then(function(){return o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.attachments).getKeyRange(l,a.msgId,i)).then((function(){var o=n("asyncToGeneratorRuntime").asyncToGenerator(function*(o){if(o!=null){var a=babelHelpers.extends({},o,{attachmentCta1Id:void 0,attachmentCta2Id:void 0,attachmentCta3Id:void 0,cta1Title:void 0,cta1Type:void 0,cta2Title:void 0,cta2Type:void 0,cta3Title:void 0,cta3Type:void 0,defaultCtaId:void 0,defaultCtaTitle:void 0,maxSubtitleNumOfLines:void 0,maxTitleNumOfLines:void 0,previewHeight:void 0,previewHeightLarge:void 0,previewWidth:void 0,previewWidthLarge:void 0,subtitleText:void 0,titleText:void 0});yield t.attachments.put(a)}else r("FBLogger")("messenger_web_sharing").blameToPreviousFrame().mustfix("Trying to tombstone a secure xma attachment but no existing attachment");return(e||(e=n("Promise"))).resolve()});return function(e){return o.apply(this,arguments)}})())})})})}l.call=s}),98);
__d("MAWBridgeStoryReplyStartCountdownHandler",["I64","MAWBridgeXMAShareTombstonedHandler","MAWDbXMA","MAWMessageExpirationStorage","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","Promise","ReQL","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(t,r){return r.msgs.reduce(function(r,a){return r.then(function(){return o("MAWMessageExpirationStorage").setMessageForExpiration({bridgeMsgStartCountdown:a,expirationEvent:o("MAWMessageExpirationStorage").expirationStoryReplyEvent}),(s||(s=o("I64"))).of_int32(a.millisecondsUntilCountdownTs),o("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(t,a.threadJid,"MAWBridgeMsgsStartCountdownHandler",function(t,r){return o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(t.attachments).getKeyRange(r,a.msgId)).then((function(){var r=n("asyncToGeneratorRuntime").asyncToGenerator(function*(r){yield(e||(e=n("Promise"))).all(r.map(function(e){var n=o("MAWDbXMA").convertNumberToXMAId(Number.parseInt(e.attachmentFbid,10)),r={msgId:a.msgId,threadJid:a.threadJid,xmaId:n};return o("MAWBridgeXMAShareTombstonedHandler").call(t,r)}))});return function(e){return r.apply(this,arguments)}})())})})},(e||(e=n("Promise"))).resolve())}l.call=u}),98);
__d("MAWBridgeSyncContacts",["CurrentMessengerUser","I64","LSAuthorityLevel","LSContactBlockedByViewerStatus","LSContactGender","LSContactIdType","LSContactType","LSContactViewerRelationship","LSContactWorkForeignEntityType","LSFactory","LSIntEnum","LSVerifyContactRowExistsStoredProcedure","Promise","emptyFunction"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=o("CurrentMessengerUser").getID();function d(t,a){return a.reduce(function(e,n){var a=(s||(s=o("I64"))).of_string(n);return e.then(function(){return r("LSVerifyContactRowExistsStoredProcedure")(r("LSFactory")(t),{authorityLevel:(u||(u=o("LSIntEnum"))).ofNumber(r("LSAuthorityLevel").OPTIMISTIC),blockedByViewerStatus:u.ofNumber(r("LSContactBlockedByViewerStatus").UNBLOCKED),contactIdType:u.ofNumber(r("LSContactIdType").FBID),contactType:u.ofNumber(r("LSContactType").USER),contactViewerRelationship:u.ofNumber(r("LSContactViewerRelationship").UNKNOWN),gender:u.ofNumber(r("LSContactGender").UNKNOWN),id:a,isBlocked:!1,isMemorialized:!1,isSelf:c===n,workForeignEntityType:u.ofNumber(r("LSContactWorkForeignEntityType").UNKNOWN)})}).then(r("emptyFunction"))},(e||(e=n("Promise"))).resolve())}l.call=d}),98);
__d("MAWBridgeThreadHiddenV2Handler",["LSFactory","LSIntEnum","LSOptimisticRemoveThreadStoredProcedure","LSThreadRemoveType","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,n){return o("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(t,n,"MAWBridgeThreadHiddenV2Handler",function(t,n){var a=r("LSFactory")(t);return r("LSOptimisticRemoveThreadStoredProcedure")(a,{removeType:(e||(e=o("LSIntEnum"))).ofNumber(r("LSThreadRemoveType").DELETE_THREAD),threadKey:n})})}l.call=s}),98);
__d("MAWBridgeThreadUpdatedHandler",["MAWBridgeBuildThreadSnippet","MAWBridgeUIEventDataValidation","MAWFolderUtils","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","ReQL","asyncToGeneratorRuntime","getMAWLastMessageCtaType"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){var n,r=t.folder!=null?o("MAWFolderUtils").getMessagingFolderTag(t.folder):e.folderName;return(n=t.cannotReplyReason)!=null?n:r==="inbox"?void 0:e.cannotReplyReason}function s(e,t,n){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,a){var i=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.threads).getKeyRange(a));if(i!=null){var l=o("MAWBridgeBuildThreadSnippet").buildBridgeThreadSnippet(n,i.snippet),s=e(i,n),u=r("getMAWLastMessageCtaType")(n.snippetType),c=babelHelpers.extends({},i,{cannotReplyReason:s,folderName:i.folderName,lastMessageCtaType:u,parentThreadKey:i.parentThreadKey,snippet:l,snippetSenderContactId:n.snippetSenderContactId==null?i.snippetSenderContactId:o("MAWBridgeUIEventDataValidation").stringToI64Opt(n.snippetSenderContactId)});yield t.threads.put(c)}}),u.apply(this,arguments)}function c(e,t){var n=t.threadJid;return o("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(e,n,"MAWBridgeThreadUpdatedHandler",function(e,n){return s(e,t,n)})}l.callWithoutWaitingForAnything=s,l.call=c}),98);
__d("MAWBridgeTraceRecordCheckpointHandler",["I64","LSAppendDataTraceAddonStoredProcedure","LSDatabaseSingleton","LSFactory","LSFlushDataTrace.nop"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(t,n){var a=n.checkPointId,i=n.dataTraceId,l=n.errorMessage,s=n.tags;return r("LSAppendDataTraceAddonStoredProcedure")(r("LSFactory")(t),{checkPointId:a,dataTraceId:i,errorMessage:l,syncChannel:(e||(e=o("I64"))).neg_one,tags:s}).then(function(){if(n.shouldFlush)return r("LSFlushDataTrace.nop")(t,0,i)})}function c(e){return(s||(s=o("LSDatabaseSingleton"))).LSDatabaseSingleton.then(function(t){return t.runInTransaction(function(t){return u(t,e)},"readwrite",void 0,void 0,i.id+":43")})}l.call=u,l.callWithoutTxn=c}),98);
__d("MAWBridgeUIEventQueueQPLLogger",["QPLUserFlow","qpl"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){r("QPLUserFlow").start(r("qpl")._(1056849266,"1765"),{annotations:{string_array:{events:t}},instanceKey:e})}function s(e,t){r("QPLUserFlow").addAnnotations(r("qpl")._(1056849266,"1765"),t,{instanceKey:e})}function u(e){r("QPLUserFlow").endSuccess(r("qpl")._(1056849266,"1765"),{instanceKey:e})}function c(e,t){r("QPLUserFlow").endFailure(r("qpl")._(1056849266,"1765"),"MAWBridgeUIEventHandlerFailure",{annotations:{string:{failedEventTag:t}},instanceKey:e})}l.start=e,l.addAnnotations=s,l.endSuccess=u,l.endFailure=c}),98);
__d("MAWDeviceChangeState-resolver",[],(function(t,n,r,o,a,i){"use strict";var e=0,l=[],s={getDeviceAlertCount:function(){return e},subscribe:function(t){return l.push(t),function(){l=l.filter(function(e){return e!==t})}}};function u(t){e!==t&&(e=t,l.forEach(function(e){return e()}))}function c(){return{read:function(){return s.getDeviceAlertCount()},subscribe:function(t){return s.subscribe(t)}}}i.updateDeviceCount=u,i.deviceAlertCount=c}),66);
__d("MAWBridgeUnArchivedSelfDeviceChangeAlertsHandler",["MAWDeviceChangeState-resolver","Promise"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,r){return o("MAWDeviceChangeState-resolver").updateDeviceCount(r),(e||(e=n("Promise"))).resolve()}l.call=s}),98);
__d("MAWBridgeUpdateClientRestoreStatus",["I64","LSEncryptedBackupsClientRestoreState","LSIntEnum","MAWUpdateClientRestoreStatusOperationType","Promise","ReQL","asyncToGeneratorRuntime","emptyFunction","vulture"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(e,t){return o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.encrypted_backups_client_restore_status).filter(function(e){return e.threadId===t})).then(function(t){return r("vulture")("6ohLsZU1yNlCR9ixvbeAM832GX4="),t!=null?e.encrypted_backups_client_restore_status.delete(t.threadId).then(r("emptyFunction")):(u||(u=n("Promise"))).resolve()})}function d(t,a,i,l){return o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.encrypted_backups_client_restore_status).getKeyRange(a)).then(function(l){return l!=null?t.encrypted_backups_client_restore_status.put({lastUpdated:(e||(e=o("I64"))).of_float(Date.now()),restoreStatus:(s||(s=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsClientRestoreState").RESTORE_COMPLETE),serverThreadKey:i,threadId:a}):(u||(u=n("Promise"))).resolve()})}function m(e){return o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(e.encrypted_backups_client_restore_status)).then(function(t){return t.reduce(function(t,n){return t.then(function(){return c(e,n.threadId)})},(u||(u=n("Promise"))).resolve())})}function p(e,t){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a){var i=a.threadId,l=a.action;return l===o("MAWUpdateClientRestoreStatusOperationType").upsertClientRestoreStatus?yield t.encrypted_backups_client_restore_status.put({lastUpdated:(e||(e=o("I64"))).of_float(Date.now()),restoreStatus:(s||(s=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsClientRestoreState").RESTORE_IN_PROGRESS),serverThreadKey:void 0,threadId:i}):yield d(t,a.threadId,void 0,a.ebPrefetch),(u||(u=n("Promise"))).resolve()}),_.apply(this,arguments)}l.truncateClientRestoreStatusTable=m,l.call=p}),98);
__d("MAWBridgeUpdateContactAsConnectedHandler",["FBLogger","I64","LSAddMessengerContactStoredProcedure","LSContactViewerRelationship","LSFactory","LSIntEnum","LSOptimisticAcceptMessageRequestStoredProcedure","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","MAWUpdateLSThreadCapabilities","Promise","ReQL","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(e,t){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a){var i=a.contactUserId,l=a.threadJid,c=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.contacts).getKeyRange((s||(s=o("I64"))).of_string(i)));if(c==null){r("FBLogger")("messenger_web").warn("Missing contact in MAWBridgeUpdateContactAsConnectedHandler");return}var d=babelHelpers.extends({},c,{contactViewerRelationship:(u||(u=o("LSIntEnum"))).ofNumber(r("LSContactViewerRelationship").CONTACT_OF_VIEWER)});return o("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(t,l,"MAWBridgeUpdateContactAsConnectedHandler",(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a){yield(e||(e=n("Promise"))).allSettled([t.contacts.upsert([c.id],d),r("LSAddMessengerContactStoredProcedure")(r("LSFactory")(t),{contactId:c.id}),o("MAWUpdateLSThreadCapabilities").updateNonMessageRequestThreadTxn(t,a),r("LSOptimisticAcceptMessageRequestStoredProcedure")(r("LSFactory")(t),{threadKey:a})])});return function(e,n){return t.apply(this,arguments)}})())}),d.apply(this,arguments)}l.call=c}),98);
__d("LSUpdateE2EEMetadataParticipants",["LSIssueNewTask"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return r[0]=new t.Map,r[0].set("thread_key",e[0]),r[0].set("user_self_remove",!1),r[1]=r[0].get("thread_key"),r[2]=t.toJSON(r[0]),t.storedProcedure(n("LSIssueNewTask"),t.i64.to_string(r[1]),t.i64.cast([0,394]),r[2],void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]),void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]))},function(e){return t.resolve(o)}])}e.__sproc_name__="LSE2EEMessagingMetadataMailboxUpdateE2EEMetadataParticipantsStoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSUpdateE2EEMetadataParticipantsStoredProcedure",["LSSynchronousPromise","LSUpdateE2EEMetadataParticipants","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSUpdateE2EEMetadataParticipants"),a.threadKey);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("MAWBridgeUpdateE2EEMetadataParticipantsHandler",["LSFactory","LSUpdateE2EEMetadataParticipantsStoredProcedure","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return o("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(e,t.threadJid,"MAWBridgeThreadsLoadedHandler",function(e,t){return r("LSUpdateE2EEMetadataParticipantsStoredProcedure")(r("LSFactory")(e),{threadKey:t})})}l.call=e}),98);
__d("LSBumpE2EEMetadataThread",["LSCancelTaskByQueueName","LSIssueNewTask"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(o){return r[0]=new t.Map,r[0].set("bump_timestamp_ms",e[1]),r[0].set("thread_key",e[0]),r[0].set("bumped_by_local_device_send",e[2]),r[0].set("tam_thread_subtype",t.i64.cast([0,0])),r[0].set("wa_jid",void 0),r[0].set("message_ephemeral_duration_in_sec",t.i64.cast([0,0])),r[0].set("message_product_type",void 0),r[0].set("is_message_deletion",!1),r[0].set("is_unbump",e[3]),r[1]=r[0].get("thread_key"),t.storedProcedure(n("LSCancelTaskByQueueName"),t.i64.to_string(r[1]),t.i64.cast([0,389]))},function(o){return r[2]=new t.Map,r[2].set("bump_timestamp_ms",e[1]),r[2].set("thread_key",e[0]),r[2].set("bumped_by_local_device_send",e[2]),r[2].set("tam_thread_subtype",t.i64.cast([0,0])),r[2].set("wa_jid",void 0),r[2].set("message_ephemeral_duration_in_sec",t.i64.cast([0,0])),r[2].set("message_product_type",void 0),r[2].set("is_message_deletion",!1),r[2].set("is_unbump",e[3]),r[3]=r[2].get("thread_key"),r[4]=t.toJSON(r[2]),t.storedProcedure(n("LSIssueNewTask"),t.i64.to_string(r[3]),t.i64.cast([0,389]),r[4],void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]),void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]))}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSE2EEMessagingMetadataMailboxBumpE2EEMetadataThreadStoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSBumpE2EEMetadataThreadStoredProcedure",["LSBumpE2EEMetadataThread","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSBumpE2EEMetadataThread"),a.threadKey,a.serverAuthoritativeTimestampMs,a.bumpedByLocalDeviceSend,a.isUnbump);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("MAWBridgeUpdateThreadActivityHandler",["I64","LSBumpE2EEMetadataThreadStoredProcedure","LSFactory","MAWBridgeOccamadilloCreateE2EEMetadataThreadHandlerV2","MAWBridgeOccamadilloVerifyThreadExistsHandler","MAWChatJid","MAWFolderTypes","MAWJids","MAWMiActGetThreadLifecycleState__DO_NOT_USE","MWFBLogger","ODS","WAJids","WATimeUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("MWFBLogger").MWLogger().tags(["bridgeUIEvent","Occam","ActivityUpdate"]);function c(e,t){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){var r=null;return(e||(e=o("ODS"))).bumpEntityKey(3185,"occam_thread_creation","verify"),yield o("MAWBridgeOccamadilloVerifyThreadExistsHandler").call(t,{authoritativeThreadKey:null,cannotReplyReason:null,clientThreadKey:null,description:"",folder:null,instanceKey:null,isGroup:o("WAJids").switchOnMsgrChatJidType(n.chatJid,{group:function(){return!0},user:function(){return!1}}),jid:n.chatJid,lastReadTs:o("WATimeUtils").castToMillisTime((s||(s=o("I64"))).to_float(n.bumpTimestampMs))}),r=yield o("MAWChatJid").toThreadMaybe(t,n.chatJid),r==null&&((e||(e=o("ODS"))).bumpEntityKey(3185,"occam_thread_creation","create"),yield o("MAWBridgeOccamadilloCreateE2EEMetadataThreadHandlerV2").call(t,{bumpTimestampMs:n.bumpTimestampMs,creationSource:n.source==="outgoing_msg"?"outgoing_message":"incoming_message",folderId:o("MAWFolderTypes").INBOX,jid:n.chatJid,optimisticThreadKey:null}),r=yield o("MAWChatJid").toThreadMaybe(t,n.chatJid)),r==null?(yield b(t,n.chatJid),null):r}),d.apply(this,arguments)}function m(e,t){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield o("MAWChatJid").toThreadMaybe(e,t.chatJid);e:{if(t.source==="outgoing_msg"||t.source==="incoming_msg"){var r=n!=null?n:yield c(e,t);if(r==null){yield b(e,t.chatJid);return}return _(e,r,t)}if(t.source==="deleted_msg"){if(n==null){yield b(e,t.chatJid);return}return g(e,n,t)}if(t.source==="inserted_admin_msg"){if(n==null){yield b(e,t.chatJid);return}return C(n,t,"No bump for admin message")}if(t.source==="eb_restore")return u.warn("Attempted bump from EB restore");throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+t.source)}}),p.apply(this,arguments)}function _(e,t,n){return f.apply(this,arguments)}function f(){return f=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){if(y(t,n)){C(t,n,"Stale incoming bump");return}yield r("LSBumpE2EEMetadataThreadStoredProcedure")(r("LSFactory")(e),{bumpedByLocalDeviceSend:n.source==="outgoing_msg",isUnbump:!1,serverAuthoritativeTimestampMs:n.bumpTimestampMs,threadKey:t.threadKey}),C(t,n,"Thread bumped")}),f.apply(this,arguments)}function g(e,t,n){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){yield e.threads.put(babelHelpers.extends({},t,{lastActivityTimestampMs:(s||(s=o("I64"))).min(t.lastActivityTimestampMs,n.bumpTimestampMs),lastReadWatermarkTimestampMs:s.min(t.lastReadWatermarkTimestampMs,n.bumpTimestampMs)})),C(t,n,"Thread unbumped")}),h.apply(this,arguments)}function y(e,t){return t.source==="incoming_msg"&&(s||(s=o("I64"))).le(t.bumpTimestampMs,e.lastActivityTimestampMs)}function C(e,t,n){var r=[(s||(s=o("I64"))).to_string(e.threadKey),t.source,s.to_string(t.bumpTimestampMs),s.to_string(e.lastActivityTimestampMs),s.to_string(e.lastReadWatermarkTimestampMs)];u.debug.apply(u,[n+". threadKey: %s, source: %s, bumpTimestampMs: %s, originalLastActivityTimestampMs: %s, originalLastReadWatermarkTimestampMs: %s"].concat(r))}function b(e,t){return v.apply(this,arguments)}function v(){return v=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield o("MAWMiActGetThreadLifecycleState__DO_NOT_USE").getThreadLifecycleStateByJid(e,o("MAWJids").convertChatJidToIntJid(t),"MAWBridgeUpdateThreadActivityHandler");u.mustfix("Missing LSDBThread when updating thread activity. jid: %s, thread state: %s",t,n.type)}),v.apply(this,arguments)}l.call=m}),98);
__d("MAWBridgeUpdateTraceHandler",["ArmadilloDataTraceCheckPoint","I64","LSAppendDataTraceAddonStoredProcedure","LSDataTraceCheckPoint","LSFactory","LSIntEnum","MAWBridgeTraceEvent","Promise","ReQL","emptyFunction","updateAndFlushLSDataTrace"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(t,a,i){return o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(t.data_trace_meta).filter(function(e){var t=e.contextThree;return t!=null&&a.externalIds.includes(t)&&(u||(u=o("I64"))).equal(e.traceType,a.traceType)?e.shouldFlush===!1:!1})).then(function(l){var s=[];return l.reduce(function(e,n){return e.then(function(){s.push(n.traceId);var e=a.errorMessage;return e!=null?r("LSAppendDataTraceAddonStoredProcedure")(r("LSFactory")(t),{checkPointId:i,dataTraceId:n.traceId,errorMessage:e,syncChannel:(u||(u=o("I64"))).neg_one}):r("LSAppendDataTraceAddonStoredProcedure")(r("LSFactory")(t),{checkPointId:i,dataTraceId:n.traceId,syncChannel:(u||(u=o("I64"))).neg_one})})},(e||(e=n("Promise"))).resolve()).then(function(){return s})})}function d(t,o){return o.reduce(function(e,n){return e.then(function(){return r("updateAndFlushLSDataTrace")(t,n)})},(e||(e=n("Promise"))).resolve())}function m(t,a){var i=a.event;return i===r("MAWBridgeTraceEvent").ReceivedReceipt?c(t,a,o("ArmadilloDataTraceCheckPoint").deliveryReceiptReceived).then(function(e){return d(t,e)}):i===r("MAWBridgeTraceEvent").ReceivedSent?c(t,a,o("ArmadilloDataTraceCheckPoint").advancedCryptoMEMSendTaskComplete).then(r("emptyFunction")):i===r("MAWBridgeTraceEvent").FlowEndForFailure?c(t,a,(s||(s=o("LSIntEnum"))).ofNumber(r("LSDataTraceCheckPoint").FLOW_END_FOR_FAILURE)).then(function(e){return d(t,e)}):i===r("MAWBridgeTraceEvent").FlowEndForSuccess?c(t,a,(s||(s=o("LSIntEnum"))).ofNumber(r("LSDataTraceCheckPoint").FLOW_END_AND_FLUSH)).then(function(e){return d(t,e)}):(e||(e=n("Promise"))).resolve()}l.call=m}),98);
__d("MAWBridgeXMAShareExpiredHandler",["MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","Promise"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,r,o){var a=String(o.xmaId);return t.attachments.get(r,o.msgId,a).then(function(i){if(i==null)return(e||(e=n("Promise"))).resolve();var l=[i.defaultCtaId,i.attachmentCta1Id,i.attachmentCta2Id,i.attachmentCta3Id].filter(Boolean),s=l.map(function(e){return t.attachment_ctas.delete(e)});return(e||(e=n("Promise"))).all(s).then(function(){return t.attachments.delete(r,o.msgId,a)})})}function u(e,t){return o("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(e,t.threadJid,"MAWBridgeXMAShareExpiredHandler",function(e,n){return s(e,n,t)})}l.callWithoutWaitingForAnything=s,l.call=u}),98);
__d("isInstamadilloDYI",["qex"],(function(t,n,r,o,a,i,l){"use strict";function e(){return r("qex")._("665")===!0}l.default=e}),98);
__d("MAWBridgeUIEventHandler",["EBLogger","MAWAbPropsClient","MAWBridgeAddMessageSearchResultHandler","MAWBridgeCallRestoreNativeOpHandler","MAWBridgeDeleteGroupInviteHandler","MAWBridgeDeleteMessagesHandler","MAWBridgeDeleteMessagesOfThreadHandler","MAWBridgeDeleteReactionHandler","MAWBridgeDropAllSecureThreadsHandler","MAWBridgeEditMsgHistoryAddedHandler","MAWBridgeEphemeralSettingsUpdatedForUIHandler","MAWBridgeFulfillRestorePromisePayloadHandler","MAWBridgeGroupInfoUpdatedHandler","MAWBridgeGroupInviteLoadedHandler","MAWBridgeGroupInviteUpdateHandler","MAWBridgeHandleCOPDigest","MAWBridgeMediaExpiredHandler","MAWBridgeMsgUpdatedHandler","MAWBridgeMsgsStartCountdownHandler","MAWBridgeNewMediaHandler","MAWBridgeNewMediaRangeHandler","MAWBridgeNewMsgHandler","MAWBridgeNewPollHandler","MAWBridgeNewReceiverFetchInfoHandler","MAWBridgeNewXMAHandler","MAWBridgeNoteReplyStartCountdownHandler","MAWBridgeOccamadilloCreateE2EEMetadataThreadHandlerV2","MAWBridgeOccamadilloVerifyThreadExistsHandler","MAWBridgeOneToOneMessageRequestLoadedHandler","MAWBridgeParticipantRemovedHandler","MAWBridgeParticipantsUpdatedHandler","MAWBridgeRavenActionMsgForUIHandler","MAWBridgeReactionUpsertHandler","MAWBridgeReceivedChatStateHandler","MAWBridgeReceivedReceiptHandler","MAWBridgeRefreshContactHandler","MAWBridgeRemoveMessageSearchResultHandler","MAWBridgeResignAttachmentCDNUrlHandler","MAWBridgeStartTraceHandler","MAWBridgeStoryReplyStartCountdownHandler","MAWBridgeSyncContacts","MAWBridgeThreadHiddenV2Handler","MAWBridgeThreadUpdatedHandler","MAWBridgeTraceRecordCheckpointHandler","MAWBridgeUIEventQueueQPLLogger","MAWBridgeUnArchivedSelfDeviceChangeAlertsHandler","MAWBridgeUpdateClientRestoreStatus","MAWBridgeUpdateContactAsConnectedHandler","MAWBridgeUpdateE2EEMetadataParticipantsHandler","MAWBridgeUpdateThreadActivityHandler","MAWBridgeUpdateTraceHandler","MAWBridgeXMAShareExpiredHandler","MAWBridgeXMAShareTombstonedHandler","MAWLoggerUtils","MAWMessageExpirationStorage","MWFBLogger","Promise","WAResultOrError","WATimeUtils","asyncToGeneratorRuntime","emptyFunction","getErrorSafe","isArmadillo","isInstamadilloDYI","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=o("MWFBLogger").MWLogger().tags(["MAWBridgeUIEvent"]);function m(t,r,a){switch(a.tag){case"NewMsg":return o("MAWBridgeNewMsgHandler").call(r,a.value);case"MsgsStartCountdown":return o("MAWBridgeMsgsStartCountdownHandler").call(r,a.value);case"StoryReplyStartCountdown":return o("MAWBridgeStoryReplyStartCountdownHandler").call(r,a.value);case"NoteReplyStartCountdown":return o("MAWBridgeNoteReplyStartCountdownHandler").call(r,a.value);case"MsgClearCountdown":return(c||(c=n("Promise"))).resolve(o("MAWMessageExpirationStorage").clearMessageFromExpiration(a.value));case"DropAllSecureThreads":return o("MAWBridgeDropAllSecureThreadsHandler").call(r);case"VerifyThreadExists":{var i=a.value;return o("MAWBridgeOccamadilloVerifyThreadExistsHandler").call(r,i)}case"CreateE2EEMetadataThreadV2":return o("MAWBridgeOccamadilloCreateE2EEMetadataThreadHandlerV2").call(r,a.value);case"EditMsgHistoryAdded":return o("MAWBridgeEditMsgHistoryAddedHandler").call(t,r,a.value);case"MsgUpdated":return o("MAWBridgeMsgUpdatedHandler").call(r,a.value);case"NewMedia":return o("MAWBridgeNewMediaHandler").call(r,a.value);case"NewMediaRange":return o("MAWBridgeNewMediaRangeHandler").call(r,a.value);case"MediaExpired":return o("MAWBridgeMediaExpiredHandler").call(r,a.value);case"XMAShareExpired":return o("MAWBridgeXMAShareExpiredHandler").call(r,a.value);case"NewXMA":return o("MAWBridgeNewXMAHandler").call(r,a.value);case"XMAShareTombstoned":return o("MAWBridgeXMAShareTombstonedHandler").call(r,a.value);case"ParticipantRemoved":return o("MAWBridgeParticipantRemovedHandler").call(r,a.value);case"UpdateE2EEMetadataParticipants":return o("MAWBridgeUpdateE2EEMetadataParticipantsHandler").call(r,a.value);case"ReceivedReceipt":return o("MAWBridgeReceivedReceiptHandler").call(r,a.value);case"ThreadUpdated":return o("MAWBridgeThreadUpdatedHandler").call(r,a.value);case"GroupInfoUpdated":return o("MAWBridgeGroupInfoUpdatedHandler").call(r,a.value);case"UpdateThreadActivity":return o("MAWBridgeUpdateThreadActivityHandler").call(r,a.value);case"StartTrace":return o("MAWBridgeStartTraceHandler").call(r,a.value);case"UpdateTrace":return o("MAWBridgeUpdateTraceHandler").call(r,a.value);case"ThreadHiddenV2":return o("MAWBridgeThreadHiddenV2Handler").call(r,a.value);case"SyncContacts":return o("MAWBridgeSyncContacts").call(r,a.value);case"ReceivedChatState":return o("MAWBridgeReceivedChatStateHandler").call(r,a.value);case"ClockSkewUpdated":return(c||(c=n("Promise"))).resolve(o("WATimeUtils").setClockSkew(a.value));case"ABPropsUpdated":return d.warn("ABPropsUpdated has been deprecated. Please use the bridge with ABPropsUpdated"),(c||(c=n("Promise"))).resolve(o("MAWAbPropsClient").rewrite(a.value));case"COPDigestReceived":return o("MAWBridgeHandleCOPDigest").call(r,a.value);case"UpsertReaction":return o("MAWBridgeReactionUpsertHandler").call(r,a.value);case"DeleteReaction":return o("MAWBridgeDeleteReactionHandler").call(r,a.value);case"DeleteMessagesOfThread":return o("MAWBridgeDeleteMessagesOfThreadHandler").call(r,a.value);case"ResignAttachmentCDNUrl":return o("MAWBridgeResignAttachmentCDNUrlHandler").call(r,a.value);case"DeleteMessages":return o("MAWBridgeDeleteMessagesHandler").call(r,a.value);case"RestoreMessageBatch":return o("EBLogger").EBLogger().tags(["labyrinth_dyi"]).WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Attempted to call the old DYI V1 flow"]))),(c||(c=n("Promise"))).resolve();case"OneToOneMessageRequestLoaded":return o("MAWBridgeOneToOneMessageRequestLoadedHandler").call(r,a.value);case"GroupInviteUpdate":return o("MAWBridgeGroupInviteUpdateHandler").call(r,a.value);case"UpdateDyiStatus":return o("EBLogger").EBLogger().tags(["labyrinth_dyi"]).WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Attempted to call the old DYI V1 flow"]))),(c||(c=n("Promise"))).resolve();case"DeleteGroupInvite":return o("MAWBridgeDeleteGroupInviteHandler").call(r,a.value);case"TraceRecordCheckpoint":return o("MAWBridgeTraceRecordCheckpointHandler").call(r,a.value);case"ParticipantsUpdated":return o("MAWBridgeParticipantsUpdatedHandler").call(r,a.value);case"StartTraceWithTraceId":return(c||(c=n("Promise"))).resolve();case"UpdateClientRestoreStatus":return o("MAWBridgeUpdateClientRestoreStatus").call(r,a.value);case"NewMsgs":return o("MAWBridgeNewMsgHandler").bulkCall(r,a.value.msgs);case"UnArchivedSelfDeviceChangeAlerts":return o("MAWBridgeUnArchivedSelfDeviceChangeAlertsHandler").call(r,a.value);case"EphemeralSettingsUpdatedForUI":return o("MAWBridgeEphemeralSettingsUpdatedForUIHandler").call(r,a.value);case"RavenActionUpdate":return o("MAWBridgeRavenActionMsgForUIHandler").call(r,a.value);case"GroupInviteLoaded":return o("MAWBridgeGroupInviteLoadedHandler").call(r,a.value);case"RemoveMessageSearchResult":return o("MAWBridgeRemoveMessageSearchResultHandler").call(r,a.value);case"AddMessageSearchResult":return o("MAWBridgeAddMessageSearchResultHandler").call(t,r,a.value);case"FulfillRestorePromise":return o("MAWBridgeFulfillRestorePromisePayloadHandler").call(a.value);case"UpdateContactAsConnected":return o("MAWBridgeUpdateContactAsConnectedHandler").call(r,a.value);case"RefreshContact":return o("MAWBridgeRefreshContactHandler").call(r,a.value);case"NewReceiverFetchInfo":return o("MAWBridgeNewReceiverFetchInfoHandler").call(r,a.value);case"RestoreNativeOp":return o("MAWBridgeCallRestoreNativeOpHandler").call(a.value);case"NewPoll":return o("MAWBridgeNewPollHandler").call(r,a.value);default:return(c||(c=n("Promise"))).resolve()}}function p(e,t){if(!r("isArmadillo")()&&!r("isInstamadilloDYI")()){d.mustfix("User is neither part of armadillo QE and dual send QE but somehow loaded this handler");return}if(!(t.length===1&&t[0].tag==="TraceRecordCheckpoint")){var n={};n=t.reduce(function(e,t){var n;return e[t.tag]=((n=e[t.tag])!=null?n:0)+1,e},n),d.DEBUG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Handle UI Events: ",""])),JSON.stringify(n))}r("promiseDone")(_(e,t),r("emptyFunction"),function(e){d.catching(e).mustfix("[MAWBridgeUIEventHandler] Failed to handle UI events: %s",t.map(function(e){return e.tag}).join(", "))})}function _(e,t){return f.apply(this,arguments)}function f(){return f=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var a=yield e,l=o("MAWLoggerUtils").getInstanceKey(),s=t.map(function(e){return e.tag}),u="";o("MAWBridgeUIEventQueueQPLLogger").start(l,s),o("MAWBridgeUIEventQueueQPLLogger").addAnnotations(l,{int:{queue_size:t.length}});var c;try{c=yield a.runInTransaction((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){for(var n=0;n<t.length;n++){var i=t[n];try{yield m(a,e,i)}catch(e){return u=i.tag,o("WAResultOrError").makeError(r("getErrorSafe")(e))}}return o("WAResultOrError").makeResult(!0)});return function(t){return e.apply(this,arguments)}})(),"readwrite","background",{events:t,type:"maw_ui_bridge"},i.id+":281")}catch(e){c=o("WAResultOrError").makeError(r("getErrorSafe")(e))}c.success?o("MAWBridgeUIEventQueueQPLLogger").endSuccess(l):(o("MAWBridgeUIEventQueueQPLLogger").endFailure(l,u),d.catching(c.error).mustfix("MAWBridgeUIEventHandler] Did not commit UI events to DB, failed at %s, all events: %s",u,s.toString()))}),f.apply(this,arguments)}function g(e,t,n){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){try{yield m(e,t,n)}catch(e){var o=r("getErrorSafe")(e);throw d.catching(o).mustfix("[handleShimEvent] Failed to handle UI event: %s",n.tag),e}}),h.apply(this,arguments)}l.handleEvents=p,l.handleShimEvent=g}),98);
__d("toMsgrUserJid",["MAWJids"],(function(t,n,r,o,a,i,l){"use strict";l.default=o("MAWJids").toUserJid}),98);
__d("MAWFetchContacts",["I64","LSContactTypeExact","LSIntEnum","MAWContactRelationshipType","ReQL","WAJids","asyncToGeneratorRuntime","requireDeferred","toMsgrUserJid"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=r("requireDeferred")("LSDatabaseSingletonLazyWrapper").__setRef("MAWFetchContacts");function c(e){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=yield u.load(),a=yield n(),i=new Set(t.map(function(e){return o("WAJids").extractUserId(e)}));return o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(a.tables.contacts).filter(function(t){return i.has((e||(e=o("I64"))).to_string(t.id))})).then(function(t){return new Map(t.map(function(t){return[r("toMsgrUserJid")((e||(e=o("I64"))).to_string(t.id)),t]}))})}),d.apply(this,arguments)}function m(e){return c(e).then(function(e){var t=new Map;return e.forEach(function(e,n){t.set(n,o("MAWContactRelationshipType").getContactRelationshipType(e))}),t})}function p(t){return c(t).then(function(t){var n=new Map;return t.forEach(function(t,a){var i=t.contactTypeExact!=null&&(e||(e=o("I64"))).equal(t.contactTypeExact,(s||(s=o("LSIntEnum"))).ofNumber(r("LSContactTypeExact").MESSENGER_ONLY_NOT_ALLOWED_ON_FB));n.set(a,i)}),n})}l.fetchContacts=c,l.fetchContactsRelationships=m,l.fetchContactsIsMsplit=p}),98);
__d("MAWBridgeInitOfflineQueueSyncCompleteHandler",["requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e=r("requireDeferred")("MessengerLogHistory").__setRef("MAWBridgeInitOfflineQueueSyncCompleteHandler");function s(){e.onReady(function(e){var t=e.getInstance("maw_setup");t.debug("Init Offline Queue Sync Complete")})}l.call=s}),98);
__d("MAWBridgeInitOfflineQueueSyncStartHandler",["requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e=r("requireDeferred")("MessengerLogHistory").__setRef("MAWBridgeInitOfflineQueueSyncStartHandler");function s(){e.onReady(function(e){var t=e.getInstance("maw_setup");t.debug("Init Offline Queue Sync Start")})}l.call=s}),98);
__d("MAWOfflineQueueThreadStatus",[],(function(t,n,r,o,a,i){"use strict";var e=function(t,n){return Object.entries(t).filter(function(e){var t,r,o=e[0],a=e[1];return((t=n[o])==null?void 0:t.chatStatus)!==a.chatStatus||((r=n[o])==null?void 0:r.snippetStatus)!==a.snippetStatus})},l=function(t,n){return t.reduce(function(e,t){var n=t[0],r=t[1];return e[n]={chatStatus:r.chatStatus,snippetStatus:r.snippetStatus},e},n)};function s(t,n){var r=t!=null?e(t,n):null,o=r==null||r.length===0?n:l(r,babelHelpers.extends({},n));return o}i.calculateOfflineQueueThreadStatus=s}),66);
__d("MAWOfflineQueueState",["MAWOfflineQueueThreadStatus","MAWSharedProtocolQueueConst"],(function(t,n,r,o,a,i,l){"use strict";var e=[],s={offlineQueueCount:0,offlineQueueProgressDownloaded:0,offlineQueueProgressProcessed:0,offlineQueueSyncState:o("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Initializing,offlineQueueThreadStatus:{}},u=babelHelpers.extends({},s),c={getSnapshot:function(){return u},subscribe:function(n){return e.push(n),function(){e=e.filter(function(e){return e!==n})}}};function d(t){u.offlineQueueCount!==t&&(u=babelHelpers.extends({},u,{offlineQueueCount:t}),e.forEach(function(e){return e()}))}function m(t){u.offlineQueueProgressDownloaded!==t&&(u=babelHelpers.extends({},u,{offlineQueueProgressDownloaded:t}),e.forEach(function(e){return e()}))}function p(t,n){var r=o("MAWOfflineQueueThreadStatus").calculateOfflineQueueThreadStatus(n,u.offlineQueueThreadStatus);u.offlineQueueThreadStatus===r&&u.offlineQueueProgressProcessed===t||(u=babelHelpers.extends({},u,{offlineQueueProgressProcessed:t,offlineQueueThreadStatus:r}),e.forEach(function(e){return e()}))}function _(t){var n=o("MAWOfflineQueueThreadStatus").calculateOfflineQueueThreadStatus(t,u.offlineQueueThreadStatus);u.offlineQueueThreadStatus==n&&u.offlineQueueSyncState===o("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete||(u=babelHelpers.extends({},u,{offlineQueueSyncState:o("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete,offlineQueueThreadStatus:n}),e.forEach(function(e){return e()}))}l.EMPTY_STATE=s,l.offlineQueueState=c,l.initOfflineQueueSyncStart=d,l.initOfflineQueueSyncProgress=m,l.initOfflineQueueConsumerSyncProgress=p,l.initOfflineQueueSyncComplete=_}),98);
__d("MAWPostOfflineQueueCompleteActions",["WAMediaWasmWorkerClient"],(function(t,n,r,o,a,i,l){"use strict";function e(){o("WAMediaWasmWorkerClient").prewarmMediaWasmWorker("mp4RepairMux"),o("WAMediaWasmWorkerClient").prewarmMediaWasmWorker("progressiveJpegEncode")}function s(){e()}l.runPostOfflineQueueCompleteActions=s}),98);
__d("MAWSetupBridgeOfflineConsumer",["InteractionTracingMetrics","MAWBridgeInitOfflineQueueSyncCompleteHandler","MAWBridgeInitOfflineQueueSyncStartHandler","MAWMIC","MAWOfflineQueueState","MAWOfflineQueueStatus","MAWPostOfflineQueueCompleteActions","MAWSharedProtocolQueueConst","MWChatInteraction","MWFBLogger","asyncToGeneratorRuntime","interaction-tracing","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=o("MWFBLogger").MWLogger().tags(["ServerRPC","OfflineConsumer"]),m="has_pending_or_inprogress_oq_threads";function p(e){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){return yield e,o("MAWPostOfflineQueueCompleteActions").runPostOfflineQueueCompleteActions(),o("MAWBridgeInitOfflineQueueSyncCompleteHandler").call()}),_.apply(this,arguments)}function f(e){o("MAWMIC").addIntAnnotation("offlineQueueSize",e);var t=o("MWChatInteraction").get(o("MWChatInteraction").MW_AUTO_CHAT_TAB_OPEN);t!=null&&r("InteractionTracingMetrics").addAnnotationInt(t,"offlineQueueSize",e)}function g(e,t){var n=o("MWChatInteraction").get(o("MWChatInteraction").MW_AUTO_CHAT_TAB_OPEN);n!=null&&r("InteractionTracingMetrics").addSubspan(n,"offline_queue","LONGTASK",e,t,{})}function h(){r("interaction-tracing").InteractionTracingCore.getPendingInteractions().forEach(function(e){e.addMarkerPoint("offline_queue_start","AppTiming"),e.addAnnotationBoolean(m,!0)})}function y(){r("interaction-tracing").InteractionTracingCore.getPendingInteractions().forEach(function(e){e.addMarkerPoint("offline_queue_end","AppTiming"),e.addAnnotationBoolean(m,!1)})}var C=function(t){if(t.tag==="InitOfflineQueueSyncProgress"){var e=t.value;return o("MAWOfflineQueueState").initOfflineQueueSyncProgress(e),!0}if(t.tag==="InitOfflineQueueConsumerSyncProgress"){var n=t.value,r=n.chatJidStatus,a=n.processed;return o("MAWOfflineQueueState").initOfflineQueueConsumerSyncProgress(a,r),!0}if(t.tag==="InitOfflineQueueSyncStart"){o("MAWBridgeInitOfflineQueueSyncStartHandler").call();var i=t.value;return o("MAWOfflineQueueState").initOfflineQueueSyncStart(i),!0}if(t.tag==="InitOfflineQueueSyncComplete"){o("MAWBridgeInitOfflineQueueSyncCompleteHandler").call();var l=t.value;return o("MAWOfflineQueueState").initOfflineQueueSyncComplete(l),!0}return!1};function b(t){return function(n){var a=n.chatJidStatus,i=n.status,l=n.timestamp,m=n.totalExpectedCount,_=n.totalProcessedCount;switch(i){case o("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Initializing:h(),d.DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Stats start: ",""])),m),f(m),C({tag:"InitOfflineQueueSyncStart",value:m}),o("MAWOfflineQueueStatus").markThreadWithOfflineQueueStatus(a,o("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Initializing),o("MAWMIC").addPoint("process_offline_queue_start",l),o("MAWOfflineQueueStatus").resetOfflineQueueState();return;case o("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Processing:d.DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Stats: expected: ",", processed: ",""])),m,_),C({tag:"InitOfflineQueueConsumerSyncProgress",value:{chatJidStatus:a,processed:_}}),o("MAWOfflineQueueStatus").markThreadWithOfflineQueueStatus(a,o("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Processing);return;case o("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete:d.DEBUG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Stats end: expected: ",", processed: ",""])),m,_),n.startTime!=null&&g(n.startTime,l),y(),C({tag:"InitOfflineQueueSyncComplete",value:a}),r("promiseDone")(p(t)),o("MAWOfflineQueueStatus").markThreadWithOfflineQueueStatus(a,o("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete),o("MAWMIC").addPoint("process_offline_queue_end",l),o("MAWOfflineQueueStatus").markOfflineQueueComplete();return;case o("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Failed:d.DEBUG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Stats failed: expected: ",", processed: ",""])),m,_),o("MAWMIC").addPoint("process_offline_queue_failed",l),C({tag:"InitOfflineQueueSyncComplete",value:void 0}),r("promiseDone")(p(t)),o("MAWOfflineQueueStatus").markThreadWithOfflineQueueStatus(a,o("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Failed),o("MAWOfflineQueueStatus").markOfflineQueueComplete();return}}}l.processOfflineQueue=C,l.setupBridgeOfflineSnapshotHandler=b}),98);
__d("MAWSetupBridgeOfflineSnapshot",["InteractionTracingMetrics","MAWMIC","MAWSetupBridgeOfflineConsumer","MWChatInteraction","MWFBLogger","WAOfflineUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=o("MWFBLogger").MWLogger().tags(["ServerRPC","Offline"]);function m(e){o("MAWMIC").addIntAnnotation("offlineQueueSize",e);var t=o("MWChatInteraction").get(o("MWChatInteraction").MW_AUTO_CHAT_TAB_OPEN);t!=null&&r("InteractionTracingMetrics").addAnnotationInt(t,"offlineQueueSize",e)}var p=function(){return(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t.downloaded,r=t.expected,a=t.status,i=t.timestamp;switch(a){case o("WAOfflineUtils").WAClientInfraOfflineProgress.Initializing:d.DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Stats start: ",", messages: ",""])),r.count,r.message),m(r.count),o("MAWSetupBridgeOfflineConsumer").processOfflineQueue({tag:"InitOfflineQueueSyncStart",value:r.count}),o("MAWMIC").addPoint("download_offline_queue_start",i);return;case o("WAOfflineUtils").WAClientInfraOfflineProgress.Processing:d.DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Progress: "," / ",", messages: "," / ",""])),n.count,r.count,n.message,r.message),o("MAWSetupBridgeOfflineConsumer").processOfflineQueue({tag:"InitOfflineQueueSyncProgress",value:n.count});return;case o("WAOfflineUtils").WAClientInfraOfflineProgress.Complete:d.DEBUG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Stats end: "," / ",", messages: "," / ",""])),n.count,r.count,n.message,r.message),o("MAWMIC").addIntAnnotation("offlineQueueDownloadedCount",n.count),o("MAWSetupBridgeOfflineConsumer").processOfflineQueue({tag:"InitOfflineQueueSyncProgress",value:r.count}),o("MAWMIC").addPoint("download_offline_queue_end",i);return;case o("WAOfflineUtils").WAClientInfraOfflineProgress.Failed:d.DEBUG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["WA infra offline connection lost"]))),o("MAWMIC").addPoint("download_offline_queue_failed",i);return}});return function(e){return t.apply(this,arguments)}})()},_=p;l.default=_}),98);
__d("MWWorkerOwnedDbKeychain",["Deferred","MAWCryptoConsts","MWFBLogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s={accountKey:null,databaseEncryptionKeys:new Map,dbReady:new(r("Deferred")),latestVersion:o("MAWCryptoConsts").VERSION},u=babelHelpers.extends({},s),c="uninitialized",d=o("MWFBLogger").MWLogger().tags(["MWWorkerOwnedDbKeychain"]);function m(){return u}function p(t){d.DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["handleEARKeyChange"]))),c="initialized",u=t}function _(){return c==="initialized"}function f(){return u.latestVersion}l.getEARKey=m,l.handleEARKeyChange=p,l.isInitialised=_,l.getLatestVersion=f}),98);
__d("IGDSetupBridge",["DTSG","FBLogger","JSResourceForInteraction","LSDatabaseSingleton","LSGetLatestThreadIds.nop","LSInitSyncCompleteSubscription","LSPlatformGraphQLLightspeedRequest","LSPlatformGraphQLLightspeedRequestForIGD","MAWAbPropsClient","MAWBridgeReceivedChatStateHandler","MAWBridgeUIEventHandler","MAWCommonSetupBridge","MAWFetchContacts","MAWGetEphemeralSettings","MAWSetupBridgeOfflineSnapshot","MAWUnrecoverableDbErrors","MWWorkerOwnedDbKeychain","Promise","Run","WAExceededStorageQuota","WAResultOrError","asyncToGeneratorRuntime","cr:3411","emptyFunction","gkx","isInstamadillo","promiseDone","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=(u=r("requireDeferred"))("ArmadilloCutoverClientFalcoEvent").__setRef("IGDSetupBridge"),d=u("IGDBridgeResignCdnUrlHandler").__setRef("IGDSetupBridge"),m=u("MAWBridgeUpdateDYIStatusV2").__setRef("IGDSetupBridge"),p=u("MAWSetupBridgeOfflineConsumer").__setRef("IGDSetupBridge"),_=(s||(s=o("LSDatabaseSingleton"))).LSDatabaseSingleton.then(o("LSInitSyncCompleteSubscription").use).then(function(){return(s||(s=o("LSDatabaseSingleton"))).LSDatabaseSingleton}),f=function(t){c.loadImmediately(function(e){var n=e.log;return n(function(){return{armadillo_thread_id:t.armadilloThreadId,domain:t.domain,event:t.event,event_details:t.eventDetails,open_thread_id:t.openThreadId,success:t.success,trace_id:t.traceId}})})},g=new Set(["StartTraceWithTraceId","TraceRecordCheckpoint"]),h=new Set(["ABPropsUpdated","ClockSkewUpdated","DropAllSecureThreads","LargeClockSkewValue","ReceivedChatState","UpdateMediaStatus"]);function y(t){var a,l=t.logout,u=t.reregisterDevice,c=t.rotateCryptoAuthToken,y=t.worker;function C(){y.postMessage({type:"force-flush-data"})}return o("Run").onUnload(C),o("Run").onBeforeUnload(C,!1),o("MAWCommonSetupBridge").initBridge({customizeEventHandlers:{abPropsUpdated:function(t){o("MAWAbPropsClient").rewrite(t.abProps)},earKeyChange:function(t){o("MWWorkerOwnedDbKeychain").handleEARKeyChange(t)},executeGraphQLLightSpeedRequest:function(t){var e=t.args;return r("gkx")("3889")?r("LSPlatformGraphQLLightspeedRequestForIGD").apply(void 0,e):r("LSPlatformGraphQLLightspeedRequest").apply(void 0,e)},getDTSGToken:function(){return(e||(e=n("Promise"))).resolve(o("DTSG").getToken())},getLSDBEphemeralSetting:function(t){return o("MAWGetEphemeralSettings").getEphemeralSetting(t.chatJid)},getLSDBLatestThreadIds:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield(s||(s=o("LSDatabaseSingleton"))).LSDatabaseSingleton;return t.runInTransaction(function(t){return r("LSGetLatestThreadIds.nop")(t,0,"",e.numThreads,e.miActMappingFilteredThreads)},"readonly",void 0,void 0,i.id+":137")});function t(t){return e.apply(this,arguments)}return t})(),getLSDBUsersIsMsplit:function(t){return o("MAWFetchContacts").fetchContactsIsMsplit(t.users)},getLSDBUsersRelationships:function(t){return o("MAWFetchContacts").fetchContactsRelationships(t.users)},getMediaStorageResult:function(){return(e||(e=n("Promise"))).resolve(o("WAResultOrError").makeError({errorMessage:"getMediaStorageResult is not supported in IGD",errorName:"igd-unsupported"}))},getMinosEpochDataForUser:a=r("emptyFunction"),isDbMigrating:function(t){},logCutoverEvent:f,logout:l,offlineConsumerProgress:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){return(yield p.load()).setupBridgeOfflineSnapshotHandler(_).apply(void 0,arguments)});function t(){return e.apply(this,arguments)}return t})(),offlineSnapshot:r("MAWSetupBridgeOfflineSnapshot")(),receivedChatState:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield _;yield t.runInTransaction((function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){yield o("MAWBridgeReceivedChatStateHandler").call(t,e)});return function(e){return t.apply(this,arguments)}})(),"readwrite",void 0,void 0,i.id+":172")});function t(t){return e.apply(this,arguments)}return t})(),reregisterDevice:u,resignCdnUrl:function(t){var e=t.deliveryObjectId,n=t.payload;return d.load().then(function(t){return t.call(n,e)})},rotateCryptoAuthToken:c,storageQuota:function(t){var e=t.exceededStorageQuota;o("WAExceededStorageQuota").setExceededStorageQuota(e)},trackEbConsistency:function(){},uiUpdate:function(t){var e=t.events,a=[],i=e.filter(function(e){if(g.has(e.tag))return a.push(e),!1;if(h.has(e.tag))return!1});a.length>0&&(n("cr:3411")==null||n("cr:3411").recordBridgeUIEvent(e),o("MAWBridgeUIEventHandler").handleEvents(_,e)),i.length!==0&&(r("isInstamadillo")()?r("FBLogger")("igd_web").warn("[Instamadillo] Unsupported invocation of UI Event Handler. Please deprecate UI Event Handler: %s",e.map(function(e){return e.tag}).join(", ")):r("FBLogger")("igd_web").warn("[IGD] Deprecating UIEventHandlers, please update LSDB directly for UI changes: %s",e.map(function(e){return e.tag}).join(", ")))},unrecoverableDbError:function(t){var e=t.error;return o("MAWUnrecoverableDbErrors").setError(e)},updateDYIStatus:function(t){var e=t.qplEvent,n=t.qplInstanceKeyE2E,o=t.status;r("promiseDone")(m.load().then(function(t){return t.call({qplEvent:e,qplInstanceKeyE2E:n,status:o})}))},updateEBLSInWokerStateInMainThread:a,updateMediaStatus:a,updateStateManagerStateInMainThread:a,uploadOpenMessages:function(t){var e=t.uploadPayloads;r("promiseDone")(r("JSResourceForInteraction")("IGDMessageUploadMutation").__setRef("IGDSetupBridge").load().then(function(t){return t.uploadOpenMessageOverGQL(e)}))},writeToMediaStorage:a},worker:y})}l.setupBridge=y}),98);
__d("MessengerWaitForEvent",["Promise"],(function(t,n,r,o,a,i){"use strict";var e;function l(t,r,o){var a,i=o;return new(e||(e=n("Promise")))(function(e){i?a=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];i.apply(this,n)&&e.apply(this,n)}:a=e,t==null||t.addEventListener==null||t.addEventListener(r,a)}).finally(function(){t==null||t.removeEventListener==null||t.removeEventListener(r,a)})}i.waitForEvent=l}),66);
__d("LocalStorageMutex",["FBLogger","MessengerWaitForEvent","Promise","QPLUserFlow","emptyFunction","pageID","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s=null,u=1e3,c=r("qpl")._(1056847375,"584"),d=(function(){function t(e){var t=this,n=e.mutexKey,o=e.localTakeoverKey,a=e.log,i=e.logError,l=e.getStorage,s=e.setItemGuarded,c=e.mutexTimeoutMs,d=c===void 0?u:c,m=e.mutexTimeoutCallback;this.mutexFilter=function(e){if(e.key!==t.$1)return!1;var n=e.newValue||"";return!n.includes(r("pageID"))},this.$1=n,this.$2=o,this.$5=l,this.$6=s,this.$3=a,this.$4=i,this.$7=d,this.$8=m}var a=t.prototype;return a.init=function(){r("QPLUserFlow").start(c),this.$3("APPMUTEX - this tab is "+r("pageID"));var t=this.getMutex();if(t===r("pageID"))return this.$3("APPMUTEX - WE ALREADY HAVE THE MUTEX LOCK WITHIN INIT"),r("QPLUserFlow").endSuccess(c),(e||(e=n("Promise"))).resolve(!0);if(t!=null)return this.$3("APPMUTEX - initiating localTAKEOVER"),this.localTakeover();this.$3("APPMUTEX - NO1 ELSE IS ALIVE, GET THE MUTEX");var o=this.$9(r("pageID")),a=this.$10(r("pageID"));return!o.success||!a.success?(r("QPLUserFlow").addAnnotations(c,{bool:{setMutexResult:a.success,setTakeoverResult:o.success},string:{setMutexError:a.error,setTakeoverError:o.error}}),r("QPLUserFlow").endFailure(c,"fail_to_set_takeover_or_mutex"),(e||(e=n("Promise"))).resolve(!1)):(r("QPLUserFlow").endSuccess(c),(e||(e=n("Promise"))).resolve(!0))},a.localTakeover=function(){var t,a=this,i=this.$9(r("pageID"));if(!i.success)return r("QPLUserFlow").addAnnotations(c,{string:{initTakeoverError:i.error}}),r("QPLUserFlow").endFailure(c,"local_takeover_init_takeover_failure"),(e||(e=n("Promise"))).resolve(!1);var l,s=function(){l!=null&&clearTimeout(l)},d=o("MessengerWaitForEvent").waitForEvent(window,"storage",this.mutexFilter),m=(t=this.$7)!=null?t:u;return(e||(e=n("Promise"))).race([d,new e(function(e){l=setTimeout(function(){e()},m)}),this.$8?this.$8():new(e||(e=n("Promise")))(r("emptyFunction"))]).then(function(e){if(e==null){a.$3("AppMutex - Forcefully took the mutex and takeover lock");var t=a.$9(r("pageID")),n=a.$10(r("pageID"));return!t.success||!n.success?(r("QPLUserFlow").addAnnotations(c,{string:{setMutexError:n.error,setTakeoverError:t.error}}),r("QPLUserFlow").endFailure(c,"local_takeover_forcefully_takeover_failure"),!1):(r("QPLUserFlow").endSuccess(c),!0)}a.$3("APPMUTEX - GOT MUTEX STORAGE EVENT CHANGE FROM ANOTHER TAB");var o=a.$11(e.newValue);if(!o&&a.hasTakeoverPermission()){a.$3("APPMUTEX - setting mutex on localtakeover");var i=a.$10(r("pageID"));return i.success?(r("QPLUserFlow").endSuccess(c),!0):(r("QPLUserFlow").addAnnotations(c,{string:{setMutexError:i.error}}),r("QPLUserFlow").endFailure(c,"local_takeover_set_mutex_failure"),!1)}else return a.hasTakeoverPermission()&&a.$12(),r("QPLUserFlow").endFailure(c,"local_takeover_no_takeover_permission"),!1}).then(function(e){return s(),e}).catch(function(e){return s(),a.$4("AppMutex - localTakeover error no permission - "+e),r("QPLUserFlow").endFailure(c,"local_takeover_general_failure"),!1})},a.onMutexDeath=function(){var e=this.getMutex();e!=null&&e===r("pageID")&&(this.$3("APPMUTEX - removing mutex on death"),this.$13(),this.hasTakeoverPermission()&&this.$12())},a.takeoverFilter=function(t){if(t.key!==this.$2)return!1;var e=t.newValue||"";return!e.includes(r("pageID"))},a.$14=function(){if(!s){var e=this.$5();if(!e)throw r("FBLogger")("messenger_web").mustfixThrow("Could not get localStorage");s=e}return s},a.getMutex=function(){return s=this.$14(),s.getItem(this.$1)},a.$10=function(t){return s=this.$14(),this.$6(s,this.$1,t)},a.$13=function(){s=this.$14(),s.removeItem(this.$1)},a.getTakeover=function(){return s=this.$14(),s.getItem(this.$2)},a.$9=function(t){return s=this.$14(),this.$6(s,this.$2,t)},a.$12=function(){s=this.$14(),s.removeItem(this.$2)},a.$11=function(t){return t!=null?t:""},a.hasTakeoverPermission=function(){var e=this.getTakeover();return e!=null&&e===r("pageID")},t})();l.THIS_TAB=r("pageID"),l.LocalStorageMutex=d}),98);
__d("MAWAppMutex",["LocalStorageMutex","MAWLocalStorage","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e="armadillo_msgr_mutex",s="armadillo_msgr_local_takeover",u=null;function c(){return u==null&&(u=new(o("LocalStorageMutex")).LocalStorageMutex({getStorage:o("MAWLocalStorage").getStorage,localTakeoverKey:s,log:function(t){o("WALogger").LOG([t])},logError:function(t){o("WALogger").ERROR([t])},mutexKey:e,setItemGuarded:o("MAWLocalStorage").setItemGuarded})),u}l.MAW_MUTEX_KEY=e,l.MAW_LOCALTAKEOVER_KEY=s,l.use=c}),98);
__d("MAWCommonBackendSetup",["EBIsEbEnabled","FBLogger","MAWAppMutex","MAWInitError","MAWLocalStorage","MAWLoggerUtils","MAWSetupWorker","MAWVaultMaterialsStorage","MAWWorkerReboot","Promise","asyncToGeneratorRuntime","getErrorSafe","gkx","requireDeferredForDisplay","shouldUseMAWSharedWorker"],(function(t,n,r,o,a,i,l){"use strict";var e,s=r("requireDeferredForDisplay")("MAWMainThreadLogger").__setRef("MAWCommonBackendSetup"),u=function(r,a){return a?(e||(e=n("Promise"))).resolve(!0):r.measurePerformance("acquire_mutex",function(){return o("MAWAppMutex").use().init()})};function c(e,t,n,r,o,a){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a,i,l,c,d){yield t.measurePerformance("prepare_logger",n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=s.load();(yield e).setupMainWaLogger()})),o("MAWLoggerUtils").initMessengerWebLogging();var m=o("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker();m||(yield t.measurePerformance("detection_support",function(){if(!o("MAWLocalStorage").isLocalStorageAvailable())throw new(o("MAWInitError")).MAWInitError("localstorage_not_supported");return(e||(e=n("Promise"))).resolve()}));var p=t.measurePerformance("setup_vault_materials",function(){return o("MAWVaultMaterialsStorage").setupVaultMaterials()}),_=yield u(t,m);if(!_)throw t.logPoint("maw_appmutex_no_permission"),new(o("MAWInitError")).MAWInitError("maw_appmutex_no_permission");var f=yield p,g;if(r("gkx")("1458"))try{g=yield o("EBIsEbEnabled").isEBEnabled()}catch(e){var h=r("getErrorSafe")(e).message;t.addStringAnnotation("eb_state_fetch_error",h),r("FBLogger")("wmi_eb").mustfix("Failed to get EB state: %s",h),g=void 0}else g=void 0;yield t.measurePerformance("setup_worker",function(){return o("MAWSetupWorker").getOrSetupWorker(f,a,i,l,c,d,g).catch(function(e){return t.logPoint("reboot_worker_on_backend_setup_failure"),t.addStringAnnotation("backend_setup_failure_reason",e.message),o("MAWWorkerReboot").rebootWorker(f,a,i,l,"backend_setup_failure",d).catch(function(e){throw new(o("MAWInitError")).MAWInitError("worker_setup_error",e)})})})}),d.apply(this,arguments)}l.getMutexPermission=u,l.setupArmadilloBackend=c}),98);
__d("MAWIssueNewUserVisibleErrors",["fbt","$InternalEnum","LSDatabaseSingleton","LSFactory","LSIssueNewErrorStoredProcedure","LSRemoveErrorStoredProcedure","Promise","ReQL","asyncToGeneratorRuntime","gkx","promiseDone","vulture"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u;function c(e,t,n,a){r("promiseDone")((u||(u=o("LSDatabaseSingleton"))).LSDatabaseSingleton.then(function(o){return o.runInTransaction(function(o){return r("LSIssueNewErrorStoredProcedure")(r("LSFactory")(o),{errorBodyText:e!=null?e.toString():void 0,errorExtraData:a,errorTitleText:t.toString(),presentationStyle:String(n)})},"readwrite",void 0,void 0,i.id+":38")}))}function d(e,t){return e.runInTransaction(function(e){return r("LSRemoveErrorStoredProcedure")(r("LSFactory")(e),{errorId:t})},"readwrite",void 0,void 0,i.id+":57")}function m(){r("promiseDone")(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var t=yield(u||(u=o("LSDatabaseSingleton"))).LSDatabaseSingleton,r=yield o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(t.tables.user_visible_errors));yield(e||(e=n("Promise"))).all(r.map((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield d(t,e.errorId)});return function(t){return e.apply(this,arguments)}})()))})())}function p(t){r("promiseDone")(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){r("vulture")("VqOBBnDjV_MoNhTCdDjoBEwagF0=");var a=yield(u||(u=o("LSDatabaseSingleton"))).LSDatabaseSingleton,i=yield o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(a.tables.user_visible_errors));yield(e||(e=n("Promise"))).all(i.map((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){e.errorExtraData===t&&(yield d(a,e.errorId))});return function(t){return e.apply(this,arguments)}})()))})())}var _=n("$InternalEnum")({TOAST:"toast",BANNER:"banner"}),f=s._(/*BTDS*/"Couldn't load all end-to-end encrypted chats"),g=s._(/*BTDS*/"Try refreshing the page to see them."),h=s._(/*BTDS*/"You may need to refresh this page"),y=s._(/*BTDS*/"There may be issues sending or receiving messages on this page. Refresh it to reload your chats."),C=r("gkx")("4424")?s._(/*BTDS*/"This browser is not supported"):s._(/*BTDS*/"You may need to update your browser"),b=r("gkx")("4424")?s._(/*BTDS*/"Some messages are missing and certain messaging features are not available. Try using another browser or mobile device."):s._(/*BTDS*/"End-to-end encrypted chats won't appear in this browser. Try updating your browser or use another one."),v=new Map([[f.toString(),f],[h.toString(),h]]),S=new Map([[g.toString(),g],[y.toString(),y]]);l.issueError=c,l.deleteUserVisibleError=d,l.deleteAllErrors=m,l.deleteUserVisibleErrorByJSErrorMessage=p,l.MAWUserVisibleErrorPresentationType=_,l.MAWGeneralErrorMsgTitle=f,l.MAWGeneralErrorMsgBody=g,l.MAWLegacyUserErrorMsgTitle=h,l.MAWLegacyUserErrorMsgBody=y,l.MAWUnsupportedIndexedDBErrorMsgTitle=C,l.MAWUnsupportedIndexedDBErrorMsg=b,l.errorMsgTitleToFbtMap=v,l.errorMsgBodyToFbtMap=S}),226);
__d("WADynamicRouterSync",["ExecutionEnvironment","Promise","WALogger","WAMapWithDefault","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=["toLastActiveClient"],d,m;function p(e,t){if(e!=null){var n=e.toLastActiveClient,r=babelHelpers.objectWithoutPropertiesLoose(e,c);if(n===!0&&t!=null){var o;return babelHelpers.extends({},r,{toClientId:(o=r.toClientId)!=null?o:t})}return r}}var _=(function(){function t(){var e=this;this.$2=new Map,this.$3=new(o("WAMapWithDefault")).MapWithDefault(function(){return new Set}),this.$4=null,this.fireAndForget=function(t,n,r,o,a,i,l){o===void 0&&(o=!1),e.$3.get(t).add({route:n,arg:r,resolver:null,silentLog:o,eventCallbacks:a,transferList:l,opts:p(i,e.$4)}),e.$5(t,n)},this.sendAndReceive=function(t,r,o,a,i,l,s){return a===void 0&&(a=!1),new(m||(m=n("Promise")))(function(n){e.$3.get(t).add({route:r,arg:o,resolver:function(t){n(t)},silentLog:a,transferList:s,eventCallbacks:i,opts:p(l,e.$4)}),e.$5(t,r)})}}var a=t.prototype;return a.setAckPayload=function(t){this.$1=t},a.getAckPayoad=function(){return this.$1},a.hasHandlerForNamespace=function(t){return this.$2.has(t)},a.getHandledNamespaces=function(){return Array.from(this.$2.keys())},a.setNamespaceHandler=function(t,n){var e=this.$2,r=e.get(t);r!==n&&(e.set(t,n),r==null&&this.$5(t))},a.$6=function(r,a){var t=r.arg,i=r.eventCallbacks,l=r.opts,s=r.resolver,u=r.route,c=r.silentLog,d=r.transferList;try{var p;this.$4=(p=l==null?void 0:l.fromClientId)!=null?p:this.$4,a(u,t,s,c,d,i,l)}catch(t){s==null||s((m||(m=n("Promise"))).reject(t)),o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Bridge handler: ",""])),t)}},a.$5=function(t,n){var e=this,a=this.$3.get(t),i=this.$2.get(t);if(i==null){var l=(d||(d=r("ExecutionEnvironment"))).isInWorker?"worker":"main-thread";o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["No handler for bridge with namespace: "," route: "," called in environment: ",""])),t,n,l);return}a.forEach(function(t){a.delete(t),e.$6(t,i)})},a.setHandlers=function(t,n){function e(e,a,i,l,s,c,d){if(n[e]==null)throw o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose([""," is not defined for ",""])),e,t),r("err")(e+" is not defined for "+t);var m=n[e](a,s,d);i&&i(m)}this.setNamespaceHandler(t,e)},t})();l.normaliseHandlerOptions=p,l.DynamicRouterSync=_}),98);
__d("useMWEncryptedBackupsProcessBackupIdsDeferred",["promiseDone","react","requireDeferred","useAsyncReStore"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(e||(e=o("react"))).useEffect,u=r("requireDeferred")("MWEncryptedBackupsProcessBackupIdsDEPRECATED").__setRef("useMWEncryptedBackupsProcessBackupIdsDeferred");function c(e){var t=r("useAsyncReStore")();s(function(){var n,o=!1;return u.onReadyImmediately(function(a){r("promiseDone")(t,function(t){o||(n=a.subscribeToEncryptedBackupsRow(t,e))})}),function(){o=!0,n==null||n()}},[t,e])}l.default=c}),98);
__d("MAWCommonSetup",["EBInitializeMinosDb","EBMainThreadEBDBApiDeferred","EBMainThreadListeners","EBMinosCheckWasmFeatureSupport","ExecutionEnvironment","MAWBridgeFireAndForget","MAWCacheServiceDB","MAWCommonBackendSetup","MAWCurrentUser","MAWEncryptedBackupsStateManager","MAWIndexedDbMetadata","MAWInit","MAWInitError","MAWIsIDBOperational","MAWIssueNewUserVisibleErrors","MAWJobDefinitions","MAWLoggerUtils","MAWMIC","MAWSetupBridgeOfflineConsumer","MAWUIJob","MAWWaitForBackendSetup","MessengerWebInitData","MpsReverbInit","WABridge","WADynamicRouterSync","WAJobOrchestratorTypes","WALogger","asyncToGeneratorRuntime","cr:13007","getErrorSafe","gkx","isAppsSubdomain","justknobx","performance","promiseDone","qpl","react","requireDeferred","useMWEncryptedBackupsProcessBackupIdsDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=(c||(c=o("react"))).useEffect,m=r("requireDeferred")("FBLogger").__setRef("MAWCommonSetup"),p=n("cr:13007")==null?void 0:n("cr:13007").MAWInitialiseMAWDbInUI;r("requireDeferred")("MAWTimedJob").__setRef("MAWCommonSetup");var _=!1,f=function(){return(s||(s=r("performance"))).now()},g=function(t){o("MAWEncryptedBackupsStateManager").setEncryptedBackupsState(t),o("MAWBridgeFireAndForget").fireAndForget("backend","setEncryptedBackupsState",{newState:t})};function h(){o("MAWBridgeFireAndForget").fireAndForget("backend","resendEBLSInWorkerEbEnabledState")}function y(){o("MAWBridgeFireAndForget").fireAndForget("backend","resendWorkerStateManagerValuesToMainThread")}function C(){h(),y()}function b(e){o("MAWLoggerUtils").initMessengerWebLogging();var t=o("MAWIsIDBOperational").useIsIDBOperational();d(function(){t&&(u||(u=r("ExecutionEnvironment"))).isInBrowser&&r("promiseDone")(v(e))},[e,t]),d(function(){t&&r("promiseDone")(o("EBMainThreadListeners").initEBListeners())},[t]),r("useMWEncryptedBackupsProcessBackupIdsDeferred")(g),r("justknobx")._("4966")===!1&&C()}function v(e){return S.apply(this,arguments)}function S(){return S=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t.logout,a=t.reregisterDevice,i=t.rotateCryptoAuthToken,l=t.setupBridge;if(_){m.load().then(function(e){e("messenger_web").warn("Armadillo already setup - return")});return}if(r("isAppsSubdomain")()){o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Armadillo is disabled on apps subdomain"])));return}_=!0,o("MAWMIC").startMAWMICFlow(),o("MAWInit").MAWInit.start(),(u||(u=r("ExecutionEnvironment"))).isInBrowser&&(yield o("MpsReverbInit").initReverb({blockingErrorThreshold:r("justknobx")._("3218"),name:o("MAWIndexedDbMetadata").webReverDbbName(o("MAWCurrentUser").getID()),onBlockingError:function(){},qplEvent:r("qpl")._(1056840657,"2716"),strEncKey:r("MessengerWebInitData").accountKeyV2}),yield o("MAWCacheServiceDB").getOrSetupMAWCacheDB(),p!=null&&r("promiseDone")(p(),function(){},function(e){return m.load().then(function(t){return t("messenger_web").catching(e).mustfix("UI Dexie initialisation failed: %s",e.message)})})),o("WABridge").makeWABridge(new(o("WADynamicRouterSync")).DynamicRouterSync);try{o("MAWIssueNewUserVisibleErrors").deleteAllErrors(),yield o("MAWCommonBackendSetup").setupArmadilloBackend(o("MAWInit").MAWInit,function(e){return l({logout:n,reregisterDevice:a,rotateCryptoAuthToken:i,worker:e})},function(){o("MAWSetupBridgeOfflineConsumer").processOfflineQueue({tag:"InitOfflineQueueSyncComplete",value:void 0}),r("justknobx")._("4966")===!0&&C(),o("MAWMIC").onConnectToExistingWorker()},function(){o("MAWSetupBridgeOfflineConsumer").processOfflineQueue({tag:"InitOfflineQueueSyncComplete",value:void 0})},"mawInit",function(e){}),r("gkx")("15810")||o("MAWUIJob").UIJobStarters.fireAndForget(o("MAWJobDefinitions").jobSerializers.handleFutureproofMsg({priority:o("WAJobOrchestratorTypes").JOB_PRIORITY.LOW})),o("MAWInit").MAWInit.addIntAnnotation("endTimePageRelative",f()),o("MAWInit").MAWInit.endSuccess()}catch(e){var s,c=r("getErrorSafe")(e),d=c instanceof o("MAWInitError").MAWInitError?c.message:"maw_init_failure";c.message=(s=c.message)!=null?s:"Unknown";var g=c.message==="maw_appmutex_no_permission"&&document.visibilityState!=="visible";throw g?o("MAWInit").MAWInit.cancel(d,c):(o("MAWWaitForBackendSetup").rejectBackendSetup(c),o("MAWInit").MAWInit.fail(d,c)),o("MAWIssueNewUserVisibleErrors").issueError(o("MAWIssueNewUserVisibleErrors").MAWGeneralErrorMsgBody,o("MAWIssueNewUserVisibleErrors").MAWGeneralErrorMsgTitle,o("MAWIssueNewUserVisibleErrors").MAWUserVisibleErrorPresentationType.BANNER,c.message),c&&m.load().then(function(e){e("messenger_web").catching(c).mustfix("MAW backend setup failed -- %s",c.message)}),c}o("EBMainThreadEBDBApiDeferred").startListeningDeviceRegistrations();var h=yield o("EBMinosCheckWasmFeatureSupport").checkWasmFeatureSupport();(r("gkx")("20911")||r("gkx")("17219"))&&h&&o("EBInitializeMinosDb").initializeMinosDb()}),S.apply(this,arguments)}l.useArmadillo=b}),98);
__d("MAWOccamadilloOnMutexChange",["I64","LSDefaultSyncGroups","LSIntEnum","LSSyncGroupsUtils","Promise","WALogger","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c;function d(e){var t=o("LSDefaultSyncGroups").e2eeMetadataSyncGroup;return t!=null?e.sync_groups.put(babelHelpers.extends({},o("LSSyncGroupsUtils").defaultSyncGroup,{groupId:(c||(c=o("LSIntEnum"))).ofNumber(t.groupId)})):(s||(s=n("Promise"))).resolve()}function m(e){return e.network_requests.put({epochId:void 0,failureCount:(u||(u=o("I64"))).zero,lastDelayedRequestTimestampMs:void 0,lastSentTimestampMs:u.zero,lastSyncRequestTimestampMs:u.zero,networkTaskIdentifier:void 0,syncDatabaseId:(c||(c=o("LSIntEnum"))).ofNumber(95),taskQueueName:""})}function p(t){o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] Resetting sync cursor and network request"]))),r("promiseDone")(t.runInTransaction(function(e){return(s||(s=n("Promise"))).all([d(e),m(e)])},"readwrite",void 0,void 0,i.id+":53"))}l.onOccamadilloMutexChange=p}),98);
__d("MAWReinit",["ExecutionEnvironment","MAWCurrentUser","QPLUserFlow","QuickPerformanceLogger","WAGetStorageQplAnnotations","asyncToGeneratorRuntime","gkx","qpl","shouldUseMAWSharedWorker"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=r("qpl")._(25310984,"169");function c(t){var a=t!=null?{instanceKey:t}:void 0,i=!1,l=!1;function c(){l||(l=!0,r("QPLUserFlow").start(u,babelHelpers.extends({cancelOnUnload:!0,onFlowTimeout:function(){i=!0},timeoutInMs:(e||(e=r("ExecutionEnvironment"))).canUseDOM?6e4:0},a)),o("WAGetStorageQplAnnotations").getStorageQplAnnotations().then(function(e){r("QPLUserFlow").addAnnotations(u,e)}),C())}function d(e){!l||i||(C(),r("QPLUserFlow").addPoint(u,e,a))}function m(e,t){var n;!l||i||r("QPLUserFlow").addAnnotations(u,{bool:(n={},n[e]=t,n)})}function p(e,t){var n;!l||i||r("QPLUserFlow").addAnnotations(u,{string:(n={},n[e]=t,n)})}function _(e,t){var n;!l||i||r("QPLUserFlow").addAnnotations(u,{string_array:(n={},n[e]=t,n)})}function f(e,t){var n;!l||i||r("QPLUserFlow").addAnnotations(u,{int:(n={},n[e]=t,n)})}function g(e){C(),i=!0,r("QPLUserFlow").addAnnotations(u,{string:{failReason:e}},a),r("QPLUserFlow").endFailure(u,"maw_init_fail",a),y=!1}function h(e){C(),i=!0,y=!1,r("QPLUserFlow").addAnnotations(u,{string:{dropReason:e}},a),(s||(s=r("QuickPerformanceLogger"))).markerDrop(u)}var y=!1;function C(){y||(y=!0,r("QPLUserFlow").addAnnotations(u,{bool:{armadillo_init_sync_api_improvements:r("gkx")("24025"),isArmadilloPublicLaunchUser:r("gkx")("23405"),isTlcPublicUser:o("MAWCurrentUser").isTlcPublicUser(),useSharedWorker:o("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()}}))}function b(e){C(),i=!0,r("QPLUserFlow").addAnnotations(u,{string:{cancelReason:e}},a),r("QPLUserFlow").endCancel(u,a),y=!1}function v(){C(),i=!0,r("QPLUserFlow").endSuccess(u,a),y=!1}function S(e,t){return R.apply(this,arguments)}function R(){return R=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=e+"_start",r=e+"_end";d(n);var o=yield t();return d(r),o}),R.apply(this,arguments)}return{addBoolAnnotation:m,addIntAnnotation:f,addStringAnnotation:p,addStringArrayAnnotation:_,cancel:b,drop:h,endSuccess:v,fail:g,logPoint:d,measurePerformance:S,start:c}}l.getMAWReinit=c}),98);
__d("MAWReinitWorker",["MAWCommonBackendSetup","MAWOccamadilloOnMutexChange","MAWReinit","MAWSetupBridgeOfflineConsumer","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.allTablesPersisted,n=e.db,r=e.instanceKey,a=e.logout,i=e.reregisterDevice,l=e.rotateCryptoAuthToken,s=e.setupBridge,u=e.workerCreateReason,c=o("MAWReinit").getMAWReinit(r);c.start();var d=function(){o("MAWSetupBridgeOfflineConsumer").processOfflineQueue({tag:"InitOfflineQueueSyncComplete",value:void 0})};yield o("MAWCommonBackendSetup").setupArmadilloBackend(c,function(e){var r=s({logout:a,reregisterDevice:i,rotateCryptoAuthToken:l,worker:e});return t||o("MAWOccamadilloOnMutexChange").onOccamadilloMutexChange(n),r},d,d,u,function(e){}),c.endSuccess()}),s.apply(this,arguments)}l.default=e}),98);
__d("MAWSetupMutex",["LocalStorageMutex","MAWAppMutex","MAWBridge","MAWInit","MAWIssueNewUserVisibleErrors","MAWLocalStorage","MAWMIC","MAWReinitWorker","MAWSetupWorker","MAWWaitForBackendSetup","MAWWebWorkerSingleton","MWFBLogger","QPLUserFlow","Run","asyncToGeneratorRuntime","getErrorSafe","isInstamadillo","promiseDone","qpl","react","useReStore"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=s||(s=o("react")),c=u.useCallback,d=u.useEffect,m=u.useMemo,p=o("MWFBLogger").MWLogger().tags(["MAWInit"]),_=!1,f=0;function g(e){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(document.visibilityState!=="visible")return!1;var t=window.indexedDB!=null,n=o("MAWLocalStorage").isLocalStorageAvailable();return e?(p.debug("AppMutex - Shouldn't reinitialize, worker already exists"),!1):!(!t||!n)}),h.apply(this,arguments)}function y(t){var a=t.logout,i=t.reregisterDevice,l=t.rotateCryptoAuthToken,s=t.setupBridge,u=m(function(){return o("MAWAppMutex").use()},[]),h=(e||(e=r("useReStore")))(),y=h.persistenceTypes.includes("indexeddb"),C=c((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=u.takeoverFilter(e);!t||e.newValue===o("LocalStorageMutex").THIS_TAB||e.newValue===""||(!y&&!r("isInstamadillo")()&&o("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"DropAllSecureThreads",value:void 0}]}),yield o("MAWSetupWorker").terminateDedicatedWorker("MAWSetupMutexV2:handleStoreChange"),o("MAWWaitForBackendSetup").resetBackendSetup(),o("MAWMIC").cancel("workerMutexLost"),o("MAWInit").MAWInit.cancel("workerMutexLost"),u.onMutexDeath())});return function(t){return e.apply(this,arguments)}})(),[u,y]),b=c(function(){u.onMutexDeath(),r("promiseDone")(o("MAWSetupWorker").terminateDedicatedWorker("MAWSetupMutexV2:handleUnload"))},[u]),v=c(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=yield o("MAWWebWorkerSingleton").doesWorkerExist(),t=yield g(e);if(!(!t||_)){_=!0,f++;try{yield r("MAWReinitWorker")({allTablesPersisted:y,db:h,instanceKey:f,logout:a,reregisterDevice:i,rotateCryptoAuthToken:l,setupBridge:s,workerCreateReason:"mawReinitSetupMutex"}),o("MAWIssueNewUserVisibleErrors").deleteUserVisibleErrorByJSErrorMessage("maw_appmutex_no_permission")}catch(e){var n=r("getErrorSafe")(e);p.catching(n).mustfix("AppMutex - failed to reinitialize worker"),r("QPLUserFlow").endFailure(r("qpl")._(25310984,"169"),"failed_to_reinitialize_worker",{annotations:{string:{error:n.message}},error:n,instanceKey:f})}finally{_=!1}}}),[y,h,a,i,l,s]);d(function(){window.addEventListener("storage",C);var e=o("Run").onBeforeUnload(b,!1),t=o("Run").onUnload(b);return window.addEventListener("visibilitychange",v),function(){window.removeEventListener("storage",C),e.remove(),t.remove(),window.removeEventListener("visibilitychange",v)}},[C,b,v])}l.useMutex=y}),98);
__d("MAWSetupMutex.react",["MAWSetupMutex"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.environment,n=e.fbId,r=e.platformSetupUtils;return o("MAWSetupMutex").useMutex(r),null}l.default=e}),98);
__d("LSGetThreadDataFromTam.nop",["I64","LSMessagingThreadTypeUtil","LSResult","LSShape","LSVec","ReQL","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,a){var i=yield o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(t.threads).filter(function(e){var t=e.threadType;return o("LSMessagingThreadTypeUtil").isArmadilloSecure(t)}).take((e||(e=o("I64"))).to_int32(a))),l=i.map(function(t,n){var r=t.lastActivityTimestampMs,a=t.lastReadWatermarkTimestampMs,i=t.threadKey,l=t.threadType;return o("LSShape").ofRecord({client_thread_pk:i,display_timestamp_ms:r,is_group_thread:o("LSMessagingThreadTypeUtil").isGroup(l),last_activity_timestamp_ms:r,last_read_watermark_timestamp_ms:a,server_thread_key:i,sort_order:(e||(e=o("I64"))).of_int32(n)})});return r("LSResult")(r("LSVec").ofArray(l))});function a(e,n,r){return t.apply(this,arguments)}return a})();s.__nop_name__="LSGetThreadDataFromTam",l.default=s}),98);
__d("LSScheduleOccamThreadsIntegrityChecker",["LSGetCursor","LSGetThreadDataFromTam.nop","LSIssueNewTask"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(e){return t.storedProcedure(n("LSGetCursor"),t.i64.cast([0,95])).then(function(e){var t;return t=e,r[0]=t[0],t})},function(n){return r[1]=t.createArray(),r[2]=t.createArray(),t.i64.neq(e[1],void 0)?r[3]=e[1]:r[3]=t.i64.cast([0,20]),t.forEach(t.db.table(220).fetch([[[t.i64.cast([0,95]),t.i64.cast([0,0])]]]),function(e){var n=e.item;return r[10]=n.minLastActivityTimestampMs,r[9]=new t.Map,r[9].set("has_more_before",n.hasMoreBefore),r[9].set("is_loading_before",n.isLoadingBefore),r[9].set("min_last_activity_timestamp_ms",r[10]),r[9].set("min_thread_key",n.minThreadKey),r[9].set("parent_thread_key",t.i64.cast([0,0])),r[11]=(r[2].push(r[9]),r[2]),t.forEach(t.islc(t.filter(t.db.table(9).fetch([[[{gte:r[10]}]],"lastActivityTimestampMs"]),function(e){return t.i64.ge(e.lastActivityTimestampMs,r[10])&&t.i64.eq(e.syncGroup,t.i64.cast([0,95]))&&t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))}),0,t.i64.to_float(r[3])),function(e){var n=e.item;return r[11]=new t.Map,r[11].set("authority_level",n.authorityLevel),r[11].set("folder_name",n.folderName),r[11].set("last_activity_timestamp_ms",n.lastActivityTimestampMs),r[11].set("last_read_watermark_timestamp_ms",n.lastReadWatermarkTimestampMs),r[11].set("thread_key",n.threadKey),r[12]=(r[1].push(r[11]),r[1])})})},function(e){return r[4]=t.createArray(),t.nativeOperation(n("LSGetThreadDataFromTam.nop"),r[3]).then(function(e){var t;return t=e,r[5]=t[0],t})},function(e){return r[6]=t.createArray(),r[7]=new t.Map,r[7].set("cursor",r[0]),r[7].set("mi_act_mapping_columns_for_integrity_check",r[6]),r[7].set("occam_threads_columns_for_integrity_check",r[1]),r[7].set("threads_ranges_columns_for_integrity_check",r[2]),r[7].set("tam_threads_columns_for_integrity_check",r[5]),r[8]=t.toJSON(r[7]),t.storedProcedure(n("LSIssueNewTask"),"occam-threads-integrity-check",t.i64.cast([0,701]),r[8],void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]),void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]))}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSE2EEMessagingMetadataMailboxScheduleOccamThreadsIntegrityCheckerStoredProcedure",e.__tables__=["sync_group_threads_ranges","threads"],a.exports=e}),null);
__d("LSScheduleOccamThreadsIntegrityCheckerStoredProcedure",["LSScheduleOccamThreadsIntegrityChecker","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){a===void 0&&(a={});var i=t.storedProcedure(r("LSScheduleOccamThreadsIntegrityChecker"),a.delayMs,a.maxThreadCount);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("MWChatFetchThreadMessageCounts",["asyncToGeneratorRuntime"],(function(t,n,r,o,a,i){"use strict";function e(e){return l.apply(this,arguments)}function l(){return l=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){return{}}),l.apply(this,arguments)}function s(e,t){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){return 0}),u.apply(this,arguments)}i.fetchArmadilloThreadMessageCounts=e,i.fetchArmadilloThreadMessageCount=s}),66);
__d("globalCryptoSubtle",[],(function(t,n,r,o,a,i){"use strict";var e=t.crypto.subtle,l=e;i.default=l}),66);
__d("useDataLossStatisticsStorageListener",["LSDatabaseSingleton","MWChatFetchThreadMessageCounts","Visibility","WebStorage","promiseDone","react"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=(s||(s=o("react"))).useEffect,d="armadillo_msgr_data_loss_stats";function m(){c(function(){var t;return window.setTimeout(function(){t=r("Visibility").addListener(r("Visibility").HIDDEN,function(){r("promiseDone")((u||(u=o("LSDatabaseSingleton"))).LSDatabaseSingleton.then(function(t){return o("MWChatFetchThreadMessageCounts").fetchArmadilloThreadMessageCounts(t).then(function(t){(e||(e=r("WebStorage"))).setItemGuarded(e.getLocalStorage(),d,JSON.stringify(t))})}))})},3e4),function(){var e;(e=t)==null||e.remove()}},[])}l.DATA_LOSS_STATISTICS_STORAGE_KEY=d,l.useDataLossStatisticsStorageListener=m}),98);
__d("MWChatDataLossCheckerUtil",["FBLogger","I64","MWChatFetchThreadMessageCounts","Promise","QuickPerformanceLogger","WebStorage","asyncToGeneratorRuntime","getErrorSafe","globalCryptoSubtle","promiseDone","qpl","useDataLossStatisticsStorageListener"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c;function d(e){var t=Array.from(new Uint8Array(e));return t.map(function(e){return e.toString(16).padStart(2,"0")}).join("")}function m(e){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){try{var t=new TextEncoder,n=t.encode(e).buffer,o=yield r("globalCryptoSubtle").digest("SHA-256",n);return d(o)}catch(e){return r("getErrorSafe")(e).message}}),p.apply(this,arguments)}function _(e){return f.apply(this,arguments)}function f(){return f=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.currentIDBCnt,n=e.currentMsgCnt,o=e.logThreadId,a=e.prevMsgCnt,i=e.qplEvent,l=e.threadId;if(o!=null&&o){var s=yield m(l);t!=null?((u||(u=r("QuickPerformanceLogger"))).markerStartFromNavStart(i),u.markerAnnotate(i,{int:{current_idb_count:t,current_msg_count:n,prev_msg_count:a},string:{encrypted_threadId:s}}),u.markerEnd(i,2)):((u||(u=r("QuickPerformanceLogger"))).markerStartFromNavStart(i),u.markerAnnotate(i,{int:{current_msg_count:n,prev_msg_count:a},string:{encrypted_threadId:s}}),u.markerEnd(i,2))}else t!=null?((u||(u=r("QuickPerformanceLogger"))).markerStartFromNavStart(i),u.markerAnnotate(i,{int:{current_idb_count:t,current_msg_count:n,prev_msg_count:a}}),u.markerEnd(i,2)):((u||(u=r("QuickPerformanceLogger"))).markerStartFromNavStart(i),u.markerAnnotate(i,{int:{current_msg_count:n,prev_msg_count:a}}),u.markerEnd(i,2))}),f.apply(this,arguments)}function g(e){var t=e.currentMsgCnt,n=e.logThreadId,r=e.prevMsgCnt,o=e.qplEvent,a=e.threadId;return _({currentMsgCnt:t,logThreadId:n,prevMsgCnt:r,qplEvent:o,threadId:a})}function h(e,t){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){try{var n,a=yield o("MWChatFetchThreadMessageCounts").fetchArmadilloThreadMessageCount(e,t),i=(c||(c=r("WebStorage"))).getAllowlistedKeyFromLocalStorage(o("useDataLossStatisticsStorageListener").DATA_LOSS_STATISTICS_STORAGE_KEY);if(i==null)return{isThreadMissingMessages:!1};var l=JSON.parse(i),u=(n=l[(s||(s=o("I64"))).to_string(t)])!=null?n:null;return u==null?{isThreadMissingMessages:!1}:u>0&&a===0?{currCount:a,isThreadMissingMessages:!0,prevCount:u}:{isThreadMissingMessages:!1}}catch(e){return r("FBLogger")("labyrinth").catching(r("getErrorSafe")(e)).warn("Failed to check for data loss"),{isThreadMissingMessages:!1}}}),y.apply(this,arguments)}function C(t){var a=o("MWChatFetchThreadMessageCounts").fetchArmadilloThreadMessageCounts(t);return a.then(function(t){var a=(c||(c=r("WebStorage"))).getAllowlistedKeyFromLocalStorage(o("useDataLossStatisticsStorageListener").DATA_LOSS_STATISTICS_STORAGE_KEY);if(a==null)return(e||(e=n("Promise"))).resolve(null);var i=JSON.parse(a);return(e||(e=n("Promise"))).resolve({current:t,previous:i})}).then(function(t){if(t==null)return(e||(e=n("Promise"))).resolve();var r=t.current,o=t.previous;return b(o,r)}).catch(function(e){return r("FBLogger")("labyrinth").catching(r("getErrorSafe")(e)).warn("Failed to check for data loss")}),a.then(function(){})}function b(e,t){return v.apply(this,arguments)}function v(){return v=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,o){var a=[];for(var i in t)Object.prototype.hasOwnProperty.call(o,i)&&a.push(i);for(var l=[],s=0;s<a.length;s++){var u=a[s],c={currentMsgCnt:o[u],prevMsgCnt:t[u],threadId:u};t[u]>0&&o[u]===0?(l.push(g(babelHelpers.extends({},c,{qplEvent:r("qpl")._(717553665,"1183")}))),l.push(g(babelHelpers.extends({},c,{logThreadId:!0,qplEvent:r("qpl")._(717562243,"1358")})))):(l.push(g(babelHelpers.extends({},c,{qplEvent:r("qpl")._(717553666,"1184")}))),l.push(g(babelHelpers.extends({},c,{logThreadId:!0,qplEvent:r("qpl")._(717556541,"1361")}))))}yield(e||(e=n("Promise"))).all(l)}),v.apply(this,arguments)}function S(e){var t=function(n){r("promiseDone")(m(n).then(function(t){(u||(u=r("QuickPerformanceLogger"))).markerStartFromNavStart(r("qpl")._(717567419,"1383")),u.markerAnnotate(r("qpl")._(717567419,"1383"),{string:{encryptedThreadId:t,msg_count:e[n].toString()}}),u.markerEnd(r("qpl")._(717567419,"1383"),2)}))};for(var n in e)t(n)}l.qplLog=g,l.checkIsThreadMissingMessages=h,l.fetchCountsAndLogDataLoss=C,l.logThreadCompleteDataLoss=b,l.logLocalStatistics=S}),98);
__d("useOnMawSetupComplete.react",["emptyFunction","promiseDone","react","waitForMAWMIC"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(e||(e=o("react"))).useEffect;function u(e,t,n){t===void 0&&(t=r("emptyFunction")),s(function(){var n=!1;return r("promiseDone")(o("waitForMAWMIC").promise.then(function(){n||e()}).catch(function(){n||t()})),function(){n=!0}},n)}l.useOnMawSetupComplete=u}),98);
__d("useDataLossChecker",["FBLogger","I64","LSDatabaseSingleton","LSFactory","LSScheduleOccamThreadsIntegrityCheckerStoredProcedure","MWChatDataLossCheckerUtil","asyncToGeneratorRuntime","getErrorSafe","gkx","justknobx","promiseDone","useDataLossStatisticsStorageListener","useOnMawSetupComplete.react"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(){o("useDataLossStatisticsStorageListener").useDataLossStatisticsStorageListener(),o("useOnMawSetupComplete.react").useOnMawSetupComplete(function(){r("promiseDone")(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var t=yield(e||(e=o("LSDatabaseSingleton"))).LSDatabaseSingleton;yield o("MWChatDataLossCheckerUtil").fetchCountsAndLogDataLoss(t)})()),c()},c(),[])}function c(){try{var t=r("gkx")("24061"),a=r("justknobx")._("1683");t&&a&&r("promiseDone")(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var t=yield(e||(e=o("LSDatabaseSingleton"))).LSDatabaseSingleton;return t.runInTransaction(function(e){return r("LSScheduleOccamThreadsIntegrityCheckerStoredProcedure")(r("LSFactory")(e),{delayMs:(s||(s=o("I64"))).of_int32(6e4),maxThreadCount:s.of_int32(20)})},"readonly",void 0,void 0,i.id+":62")})())}catch(e){var l=r("getErrorSafe")(e);r("FBLogger")("wmi_eb").warn("Error running thread integrity checker",l.message)}}l.default=u}),98);
__d("useLegacyUserWatchdog",["MAWIssueNewUserVisibleErrors","clearTimeout","react","setTimeout"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(e||(e=o("react"))).useEffect,u=1440*60*1e3,c=5*u;function d(){s(function(){var e=r("setTimeout")(function(){var e;(e=o("MAWIssueNewUserVisibleErrors")).issueError(e.MAWLegacyUserErrorMsgBody,e.MAWLegacyUserErrorMsgTitle,e.MAWUserVisibleErrorPresentationType.BANNER)},c);return function(){return r("clearTimeout")(e)}},void 0)}l.default=d}),98);
__d("useMAWReregisterDeviceOnError",["FBLogger","LSPersistedDbGating","MAWEBSwitch","MAWIssueNewUserVisibleErrors","MAWLoggerUtils","MAWReinitWorker","MAWSetupWorker","MAWWaitForBackendSetup","MWEncryptedBackupsInitializeRestoreDeferred","ODS","WAOdsEnums","WMIWABridgeApi","asyncToGeneratorRuntime","emptyFunction","getErrorSafe","promiseDone","react","useAsyncReStore"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=(s||(s=o("react"))).useCallback,d=!1,m=typeof window!="undefined"?window:self;function p(){d=!0,r("promiseDone")(o("MAWSetupWorker").terminateWorkerPermanently(),function(){(u||(u=o("ODS"))).bumpEntityKey(3185,"armadillo_forced_reregister_fail",m.location.hostname),u.bumpEntityKey(3185,o("WAOdsEnums").Entity.WA_REREGISTRATION,"reregister_fail_logout"),o("MAWIssueNewUserVisibleErrors").issueError(o("MAWIssueNewUserVisibleErrors").MAWLegacyUserErrorMsgBody,o("MAWIssueNewUserVisibleErrors").MAWLegacyUserErrorMsgTitle,o("MAWIssueNewUserVisibleErrors").MAWUserVisibleErrorPresentationType.BANNER)})}function _(t){var a=t.rotateCryptoAuthToken,i=t.setupBridge,l=r("useAsyncReStore")();return c(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(!d){(u||(u=o("ODS"))).bumpEntityKey(3185,"armadillo_forced_deregister",m.location.hostname),yield r("WMIWABridgeApi").removeCurrentDevice(),yield o("MAWSetupWorker").terminateWorker("useMAWReregisterDeviceOnError"),o("MAWWaitForBackendSetup").resetBackendSetup();try{var t=yield l;(u||(u=o("ODS"))).bumpEntityKey(3185,o("WAOdsEnums").Entity.WA_REREGISTRATION,"reinit_worker"),yield r("MAWReinitWorker")({allTablesPersisted:o("LSPersistedDbGating").allTablesPersisted,db:t,logout:p,reregisterDevice:p,rotateCryptoAuthToken:a,setupBridge:i,workerCreateReason:"mawReinitReregDevice"}),r("MAWEBSwitch").isEnabled()&&((u||(u=o("ODS"))).bumpEntityKey(3185,o("WAOdsEnums").Entity.WA_REREGISTRATION,"eb_initial_restore"),yield o("MWEncryptedBackupsInitializeRestoreDeferred").encryptedBackupsInitializeRestoreDeferred({db:t,onFailure:r("emptyFunction"),onSuccess:r("emptyFunction")}))}catch(t){var n,s=r("getErrorSafe")(t);o("MAWWaitForBackendSetup").rejectBackendSetup(s);var c=s.message;r("FBLogger")("wmi_wa").tags([(n=o("MAWLoggerUtils")).Tag.DeviceRegistration,n.Tag.LogoutHandler,n.Tag.WorkerSetup,n.Tag.MAWWorker,n.Tag.MAWInit]).catching(s).MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Unable to reinit worker: ",""])),c),(u||(u=o("ODS"))).bumpEntityKey(3185,o("WAOdsEnums").Entity.WA_REREGISTRATION,"reinit_worker_fail.${message}"),o("MAWIssueNewUserVisibleErrors").issueError(o("MAWIssueNewUserVisibleErrors").MAWLegacyUserErrorMsgBody,o("MAWIssueNewUserVisibleErrors").MAWLegacyUserErrorMsgTitle,o("MAWIssueNewUserVisibleErrors").MAWUserVisibleErrorPresentationType.BANNER)}}}),[l,a,i])}l.default=_}),98);
__d("useStorageUsageMetricsLogger",["cr:20551","react"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(e||(e=o("react"))).useEffect;function u(){s(function(){n("cr:20551")==null||n("cr:20551").logMAWDBUsageMetrics()},[])}l.default=u}),98);
__d("MAWSetupImpl.react",["BaseHeadingContext","CometRelay","MAWCommonSetup","MAWCryptoAuthToken","MAWSetupMutex.react","cr:6159","cr:6160","cr:8800","promiseDone","react","shouldUseMAWSharedWorker","useDataLossChecker","useLegacyUserWatchdog","useMAWReregisterDeviceOnError","useStorageUsageMetricsLogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=e,c=u.useCallback,d=u.useContext,m=u.useMemo;window.XPlatTesting=n("cr:6159"),window.XPlatTestingGroups=n("cr:6160"),window.XPlatMockServer=n("cr:8800");function p(e){var t=e.children,n=e.fbid,a=e.logout,i=e.setupBridge,l=o("CometRelay").useRelayEnvironment(),u=c(function(){return o("MAWCryptoAuthToken").fetchFreshCAT(l)},[l]),p=r("useMAWReregisterDeviceOnError")({rotateCryptoAuthToken:u,setupBridge:i}),_=m(function(){return{logout:a!=null?a:function(){return r("promiseDone")(p())},reregisterDevice:function(){return r("promiseDone")(p())},rotateCryptoAuthToken:u,setupBridge:i}},[u,a,p,i]);o("MAWCommonSetup").useArmadillo(_),r("useLegacyUserWatchdog")(),r("useDataLossChecker")(),r("useStorageUsageMetricsLogger")();var f=d(r("BaseHeadingContext")),g=!o("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker();return s.jsxs(r("BaseHeadingContext").Provider,{value:f+1,children:[t,g?s.jsx(r("MAWSetupMutex.react"),{environment:l,fbId:n,platformSetupUtils:_}):null]})}p.displayName=p.name+" [from "+i.id+"]",l.default=p}),98);
__d("IGDAWSetup.react",["FBLogger","IGDSetIGE2EEEligibility","IGDSetupBridge","MAWCurrentUser","MAWSetupImpl.react","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=e.useCallback;function c(e){var t=o("react-compiler-runtime").c(4),n=e.children,a=d;o("IGDSetIGE2EEEligibility").useUpsertSetIGE2EEEligibilityOnMount();var i;t[0]===Symbol.for("react.memo_cache_sentinel")?(i={className:"xjp7ctv"},t[0]=i):i=t[0];var l;t[1]===Symbol.for("react.memo_cache_sentinel")?(l=o("MAWCurrentUser").getID(),t[1]=l):l=t[1];var u;return t[2]!==n?(u=s.jsx("div",babelHelpers.extends({},i,{"data-testid":void 0,children:s.jsx(r("MAWSetupImpl.react"),{fbid:l,logout:a,setupBridge:o("IGDSetupBridge").setupBridge,children:n})})),t[2]=n,t[3]=u):u=t[3],u}function d(){}l.default=c}),98);
__d("IGDChatTabMessageNotificationUtils",["fbt","I64","LSBitFlag","LSIntEnum","LSMessagingThreadTypeUtil","MNXMAPreviewImageDecorationType","MessagingAttachmentType","ReQL","asyncToGeneratorRuntime","getLSMediaContactProfilePictureUrl","intlList","qex"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u;function c(e,t){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){var a=yield o("ReQL").firstAsync(o("ReQL").fromTableDescending(t.tables.attachments).getKeyRange(n.threadKey,n.messageId));if(a!=null){var i=a.attachmentType,l=(e||(e=o("I64"))).equal(n.displayedContentTypes,(u||(u=o("LSIntEnum"))).ofNumber(4096))||a.stickerType!=null,s=a.hasMedia&&(e||(e=o("I64"))).equal(i,(u||(u=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").IMAGE))||(e||(e=o("I64"))).equal(i,(u||(u=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").VIDEO))||(e||(e=o("I64"))).equal(i,(u||(u=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").ANIMATED_IMAGE)),c=a.hasXma&&a.defaultCtaType!=="xma_web_url";if(l||s||c)return a.previewUrl}return null}),d.apply(this,arguments)}function m(e,t){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){var a,i=yield o("ReQL").firstAsync(o("ReQL").fromTableDescending(t.tables.attachments).getKeyRange(n.threadKey,n.messageId));if(i!=null){if((e||(e=o("I64"))).equal(n.displayedContentTypes,(u||(u=o("LSIntEnum"))).ofNumber(4096))||i.stickerType!=null)return s._(/*BTDS*/"Sent a sticker.");if(i.hasXma){var l,c=(l=i.headerTitle)!=null?l:"Instagram User",d=i.defaultCtaType,m=i.previewImageDecorationType;m!=null&&(e||(e=o("I64"))).equal(m,(u||(u=o("LSIntEnum"))).ofNumber(r("MNXMAPreviewImageDecorationType").REEL))?a=s._(/*BTDS*/"Sent a reel by {author}",[s._param("author",c)]):d==="igd_web_post_share"?a=s._(/*BTDS*/"Sent a post by {author}",[s._param("author",c)]):d==="xma_montage_share"?a=o("LSBitFlag").has((u||(u=o("LSIntEnum"))).ofNumber(512),n.displayedContentTypes)?s._(/*BTDS*/"Replied to your story"):s._(/*BTDS*/"Sent a story by {author}",[s._param("author",c)]):(i.playableUrlMimeType==="image/gif"||i.playableUrlMimeType==="video/mp4")&&(a=s._(/*BTDS*/"Sent an attachment."))}else if(i.hasMedia){var p=i.attachmentType;(e||(e=o("I64"))).equal(p,(u||(u=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").IMAGE))?a=s._(/*BTDS*/"Sent a photo."):(e||(e=o("I64"))).equal(p,(u||(u=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").VIDEO))?a=s._(/*BTDS*/"Sent a video."):(e||(e=o("I64"))).equal(p,(u||(u=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").AUDIO))?a=s._(/*BTDS*/"Sent a voice message."):(e||(e=o("I64"))).equal(p,(u||(u=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").ANIMATED_IMAGE))&&(a=s._(/*BTDS*/"Sent an attachment."))}}return a}),p.apply(this,arguments)}function _(t,n){return(e||(e=o("I64"))).to_float(t.muteExpireTimeMs)===-1||(e||(e=o("I64"))).to_float(t.muteExpireTimeMs)>n}function f(e,t,n,r,o,a){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,r,a,i,l){var s,u=(s=a.reactionCreationTimestampMs)!=null?s:a.timestampMs;if((e||(e=o("I64"))).equal(a.actorId,n)||(e||(e=o("I64"))).to_float(u)<i||l!=null&&l.has((e||(e=o("I64"))).to_string(a.threadKey)))return!1;var c=yield t.tables.threads.get(a.threadKey);if(c==null)return!1;var d=_(c,i);return d?!1:r==null?(e||(e=o("I64"))).equal(u,c.lastActivityTimestampMs):!((e||(e=o("I64"))).equal(r.senderId,a.actorId)||!(e||(e=o("I64"))).equal(r.senderId,n))}),g.apply(this,arguments)}function h(e,t,n,r,o){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,a,i,l){if(n.isAdminMessage||(e||(e=o("I64"))).equal(n.senderId,a)||(e||(e=o("I64"))).to_float(n.timestampMs)<i||l!=null&&l.has((e||(e=o("I64"))).to_string(n.threadKey)))return!1;var s=yield t.tables.threads.get(n.threadKey);if(s!=null&&_(s,i))return!1;var u=r("qex")._("1684")===!0;return!(u&&s!=null&&o("LSMessagingThreadTypeUtil").isIGDMessageRequest(s))}),y.apply(this,arguments)}function C(t,n){var a=t.length,i=String(s._(/*BTDS*/"Instagram User")),l=t.filter(function(t){return!(e||(e=o("I64"))).equal(t[0].contactId,n)}).map(function(e){var t=e[0].nickname,n=e[1];if(t!=null)return t;var r;return(r=n==null?void 0:n.name)!=null?r:i});l.splice(0,0,"you");var u="";if(a!==0){if(a===1){var c,d=t[0],m=d[0],p=d[1];u=m.nickname!=null?m.nickname:(c=p==null?void 0:p.name)!=null?c:i}else if(a===2||a===3)u=r("intlList")(l,r("intlList").CONJUNCTIONS.AND,r("intlList").DELIMITERS.COMMA).toString();else{l.splice(2);var _=String(a-2).concat(" others");l.push(_),u=r("intlList")(l,r("intlList").CONJUNCTIONS.AND,r("intlList").DELIMITERS.COMMA).toString()}return s._(/*BTDS*/"To {subtitle}",[s._param("subtitle",u.replace("and","&"))])}}function b(e,t,n,r,o,a,i){return v.apply(this,arguments)}function v(){return v=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,a,i,l,s,u){var c=yield t.tables.contacts.get(a),d=yield t.tables.threads.get(n),m=c!=null?{mediaPreviewSrc:l,message:s,messageId:i,senderImageSrc:r("getLSMediaContactProfilePictureUrl")(c),senderName:c.name,thread:d,threadKey:(e||(e=o("I64"))).to_string(n),timestampMs:u}:{mediaPreviewSrc:l,message:s,messageId:i,thread:d,threadKey:(e||(e=o("I64"))).to_string(n),timestampMs:u};return m}),v.apply(this,arguments)}l.getMediaPreviewSrc=c,l.generateChatTabNotifPreviewTextForAttachment=m,l.shouldRenderChatTabReactionNotification=f,l.shouldRenderChatTabMessageNotification=h,l.generateChatTabNotifSubtitleTextForGroupMessage=C,l.generateChatTabsPreviewNotification=b}),226);
__d("IGDChatTabMessageNotification.react",["fbt","BaseImage.react","I64","IGDChatTabMessageNotificationUtils","IGDChatTabsEnv","IGDFallbackProfileUrl","IGDSAvatar.react","IGDSBox.react","IGDSTextVariants.react","IGDThreadListNewMessageLoggingDataContext","LSIntEnum","MWPActor.react","MessengerWebUXLogger","ReQL","ReQLSuspense","react","react-compiler-runtime","useReStore"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u,c,d,m=d||(d=o("react")),p=60,_="x1vd4nto-B",f={fadeIn:{animationDuration:"xs4xyr0",animationName:"x1rp1485",animationTimingFunction:"x4hg4is",$$css:!0},mediaPreview:{borderStartStartRadius:"xjwep3j",borderStartEndRadius:"x1t39747",borderEndEndRadius:"x1wcsgtt",borderEndStartRadius:"x1pczhz8",objectFit:"xl1xv1r",$$css:!0},messageBox:{flexBasis:"x1t1x2f9",flexGrow:"x1iyjqo2",flexShrink:"xs83m0k",$$css:!0},root:{backgroundColor:"x7r02ix",borderStartStartRadius:"x6nl9eh",borderStartEndRadius:"x1a5l9x9",borderEndEndRadius:"x7vuprf",borderEndStartRadius:"x1mg3h75",boxShadow:"x1wp8tw6",zIndex:"x1vjfegm",":hover_backgroundColor":"x2nact",$$css:!0}};function g(t){var n=o("react-compiler-runtime").c(41),a=t.previewData,l=a.mediaPreviewSrc,d=a.message,_=a.senderImageSrc,g=a.senderName,h=a.thread,y=a.threadKey,C=o("IGDThreadListNewMessageLoggingDataContext").useFlowInstanceIdContext(),b;n[0]!==C?(b={eventName:"igd_chat_tabs_notification",flowInstanceId:C},n[0]=C,n[1]=b):b=n[1];var v=r("MessengerWebUXLogger").useImpressionLoggerRef(b),S=(e||(e=r("useReStore")))(),R=o("MWPActor.react").useActor(),L;n[2]!==S.tables.contacts||n[3]!==S.tables.participants||n[4]!==y?(L=function(){return o("ReQL").leftJoin(o("ReQL").fromTableAscending(S.tables.participants,["contactId","nickname"]).getKeyRange((u||(u=o("I64"))).of_string(y)),o("ReQL").fromTableAscending(S.tables.contacts,["name"])).take(5)},n[2]=S.tables.contacts,n[3]=S.tables.participants,n[4]=y,n[5]=L):L=n[5];var E;n[6]!==S||n[7]!==y?(E=[S,y],n[6]=S,n[7]=y,n[8]=E):E=n[8];var k=o("ReQLSuspense").useArray(L,E,i.id+":96"),I;n[9]!==R||n[10]!==k||n[11]!==h?(I=h!=null&&(u||(u=o("I64"))).equal(h.threadType,(c||(c=o("LSIntEnum"))).ofNumber(2))?h.threadName!=null?h.threadName:o("IGDChatTabMessageNotificationUtils").generateChatTabNotifSubtitleTextForGroupMessage(k,R):null,n[9]=R,n[10]=k,n[11]=h,n[12]=I):I=n[12];var T=I,D;n[13]===Symbol.for("react.memo_cache_sentinel")?(D=[f.root,f.fadeIn],n[13]=D):D=n[13];var x;n[14]===Symbol.for("react.memo_cache_sentinel")?(x=s._(/*BTDS*/"Instagram Avatar Profile Picture"),n[14]=x):x=n[14];var $=_!=null?_:o("IGDFallbackProfileUrl").FALLBACK_PROFILE_PIC_URL,P;n[15]!==$?(P=m.jsx(r("IGDSBox.react"),{margin:3,children:m.jsx(r("IGDSAvatar.react"),{alt:x,size:"large",src:$})}),n[15]=$,n[16]=P):P=n[16];var N;n[17]!==g?(N=g!=null?g:s._(/*BTDS*/"Instagram User"),n[17]=g,n[18]=N):N=n[18];var M;n[19]!==N?(M=m.jsx(r("IGDSBox.react"),{children:m.jsx(o("IGDSTextVariants.react").IGDSTextBodyEmphasized,{maxLines:1,textAlign:"start",zeroMargin:!0,children:N})}),n[19]=N,n[20]=M):M=n[20];var w;n[21]!==T?(w=T!=null&&T!==""?m.jsx(r("IGDSBox.react"),{marginTop:1,width:"100%",children:m.jsx(o("IGDSTextVariants.react").IGDSTextBodyEmphasized,{maxLines:1,textAlign:"start",zeroMargin:!0,children:T})}):null,n[21]=T,n[22]=w):w=n[22];var A=T!=null?1:2,F;n[23]!==d?(F=d!=null?d:s._(/*BTDS*/"Sent a message."),n[23]=d,n[24]=F):F=n[24];var O;n[25]!==A||n[26]!==F?(O=m.jsx(r("IGDSBox.react"),{marginTop:1,width:"100%",children:m.jsx(o("IGDSTextVariants.react").IGDSTextBody,{color:"secondaryText",maxLines:A,textAlign:"start",zeroMargin:!0,children:F})}),n[25]=A,n[26]=F,n[27]=O):O=n[27];var B;n[28]!==M||n[29]!==w||n[30]!==O?(B=m.jsxs(r("IGDSBox.react"),{direction:"column",height:"100%",justifyContent:"center",marginEnd:3,overflow:"hidden",paddingY:3,xstyle:f.messageBox,children:[M,w,O]}),n[28]=M,n[29]=w,n[30]=O,n[31]=B):B=n[31];var W;n[32]!==l?(W=l!=null&&m.jsx(r("IGDSBox.react"),{padding:4,children:m.jsx(r("BaseImage.react"),{height:p,src:l,width:p,xstyle:f.mediaPreview})}),n[32]=l,n[33]=W):W=n[33];var q;n[34]!==B||n[35]!==W||n[36]!==P?(q=m.jsxs(r("IGDSBox.react"),{alignItems:"center",direction:"row",height:o("IGDChatTabsEnv").NOTIFICATION_HEIGHT,overflow:"hidden",width:o("IGDChatTabsEnv").NOTIFICATION_WIDTH,xstyle:D,children:[P,B,W]}),n[34]=B,n[35]=W,n[36]=P,n[37]=q):q=n[37];var U;return n[38]!==v||n[39]!==q?(U=m.jsx(r("IGDSBox.react"),{containerRef:v,children:q}),n[38]=v,n[39]=q,n[40]=U):U=n[40],U}l.default=g}),226);
__d("useAddToNotificationQueue",["IGDChatTabsStateContext.react","react","react-compiler-runtime","setTimeout"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(e||(e=o("react"))).useCallback,u=5e3;function c(){var e=o("react-compiler-runtime").c(2),t=o("IGDChatTabsStateContext.react").useIGDChatTabsDispatch(),n;return e[0]!==t?(n=function(n){t==null||t({notification:n,type:"push_notification"}),r("setTimeout")(function(){t==null||t({messageId:n.messageId,type:"clear_notification"})},u)},e[0]=t,e[1]=n):n=e[1],n}l.default=c}),98);
__d("useSubscribeToMessages",["I64","IGDChatTabMessageNotificationUtils","IGDChatTabsStateContext.react","LSIntEnum","MWPActor.react","ReQL","asyncToGeneratorRuntime","react","react-compiler-runtime","useAddToNotificationQueue","useServerTime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=(e||(e=o("react"))).useCallback;function d(){var e=o("react-compiler-runtime").c(5),t=o("MWPActor.react").useActor(),a=r("useServerTime")(),i=o("IGDChatTabsStateContext.react").useIGDChatTabsState(),l=r("useAddToNotificationQueue")(),c;return e[0]!==t||e[1]!==l||e[2]!==a||e[3]!==(i==null?void 0:i.openedTabs)?(c=function(r){var e=o("ReQL").fromTableDescending(r.tables.messages.index("timestampMs")).subscribe((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,n){if(n.operation==="add"){var c=n.value,d=yield o("IGDChatTabMessageNotificationUtils").shouldRenderChatTabMessageNotification(r,c,t,a.valueOf(),i==null?void 0:i.openedTabs);if(d){var m=(s||(s=o("I64"))).equal(c.displayedContentTypes,(u||(u=o("LSIntEnum"))).ofNumber(1)),p=m?c.text:yield o("IGDChatTabMessageNotificationUtils").generateChatTabNotifPreviewTextForAttachment(r,c),_=m?null:yield o("IGDChatTabMessageNotificationUtils").getMediaPreviewSrc(r,c),f=yield o("IGDChatTabMessageNotificationUtils").generateChatTabsPreviewNotification(r,c.threadKey,c.senderId,c.messageId,_,p,c.timestampMs);l(f)}}});return function(t,n){return e.apply(this,arguments)}})());return e},e[0]=t,e[1]=l,e[2]=a,e[3]=i==null?void 0:i.openedTabs,e[4]=c):c=e[4],i==null||i.openedTabs,c}l.default=d}),98);
__d("useSubscribeToReactions",["fbt","IGDChatTabMessageNotificationUtils","IGDChatTabsStateContext.react","MWPActor.react","ReQL","asyncToGeneratorRuntime","react","react-compiler-runtime","useAddToNotificationQueue","useServerTime"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=(e||(e=o("react"))).useCallback,c=function(t){return s._(/*BTDS*/"Reacted {emoji} to your message",[s._param("emoji",t)])},d=function(){return s._(/*BTDS*/"Liked your message")};function m(){var e=o("react-compiler-runtime").c(5),t=o("MWPActor.react").useActor(),a=r("useServerTime")(),i=o("IGDChatTabsStateContext.react").useIGDChatTabsState(),l=r("useAddToNotificationQueue")(),s;return e[0]!==t||e[1]!==l||e[2]!==a||e[3]!==(i==null?void 0:i.openedTabs)?(s=function(r){var e=o("ReQL").fromTableDescending(r.tables.reactions.index("fk_messages")).subscribe((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,n){if(n.operation==="add"){var s=n.value,u=yield r.tables.messages.index("messageId").get(s.messageId),m=yield o("IGDChatTabMessageNotificationUtils").shouldRenderChatTabReactionNotification(r,t,u,s,a.valueOf(),i==null?void 0:i.openedTabs);if(m){var p=s.reaction==="\u2764"?d():c(s.reaction),_=yield o("IGDChatTabMessageNotificationUtils").generateChatTabsPreviewNotification(r,s.threadKey,s.actorId,s.messageId,null,p,s.timestampMs);l(_)}}});return function(t,n){return e.apply(this,arguments)}})());return e},e[0]=t,e[1]=l,e[2]=a,e[3]=i==null?void 0:i.openedTabs,e[4]=s):s=e[4],i==null||i.openedTabs,s}l.default=m}),226);
__d("useSubscribeToNotifications",["promiseDone","react","react-compiler-runtime","useAsyncReStore","useSubscribeToMessages","useSubscribeToReactions"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(e||(e=o("react"))).useEffect;function u(){var e=o("react-compiler-runtime").c(8),t=r("useAsyncReStore")(),n=r("useSubscribeToMessages")(),a=r("useSubscribeToReactions")(),i,l;e[0]!==t||e[1]!==n?(i=function(){var e=t.then(function(e){return n(e)});return(function(){r("promiseDone")(e.then(d))})},l=[t,n],e[0]=t,e[1]=n,e[2]=i,e[3]=l):(i=e[2],l=e[3]),s(i,l);var u,m;e[4]!==t||e[5]!==a?(u=function(){var e=t.then(function(e){return a(e)});return(function(){r("promiseDone")(e.then(c))})},m=[t,a],e[4]=t,e[5]=a,e[6]=u,e[7]=m):(u=e[6],m=e[7]),s(u,m)}function c(e){e()}function d(e){e()}l.default=u}),98);
__d("IGDChatTabMessageNotificationsContainer.react",["CometPressable.react","IGDChatTabMessageNotification.react","IGDChatTabSingleContainerStyles","IGDChatTabsEnv","IGDChatTabsJewelStyles","IGDChatTabsQPLInstanceKeyContext.react","IGDChatTabsStateContext.react","IGDChatTabsStateTypes","IGDSBox.react","IGDSThemeConstantsHelpers","IGDThreadListNewMessageLoggingDataContext","MessengerWebUXLogger","QuickPerformanceLogger","Random","loadIGDChatTabEntryPoint","qpl","react","react-compiler-runtime","useCometRelayEntrypointContextualEnvironmentProvider","useIGDOpenChatTab.react","usePolarisIsSmallScreen","useSubscribeToNotifications"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=s||(s=o("react")),c=s.useCallback,d={chatTabsClosedRoot:{bottom:"xrsf3xo",$$css:!0},chatTabsOpenRoot:{bottom:"xqxrpsi",$$css:!0},mobileNavRoot:{marginBottom:"xp13qc",$$css:!0},pressableContainer:{borderStartStartRadius:"x6nl9eh",borderStartEndRadius:"x1a5l9x9",borderEndEndRadius:"x7vuprf",borderEndStartRadius:"x1mg3h75",$$css:!0},root:{insetInlineEnd:"x145d82y",left:null,right:null,position:"xixxii4",rowGap:"x3pnbk8",zIndex:"x1vjfegm",$$css:!0}},m=3,p=o("IGDSThemeConstantsHelpers").getNumericValue("revamp-nav-bottom-toolbar-height");function _(){var t,n,a=o("react-compiler-runtime").c(24),i=o("IGDChatTabsStateContext.react").useIGDChatTabsDispatch(),l=o("IGDChatTabsStateContext.react").useIGDChatTabsState(),s=r("usePolarisIsSmallScreen")(),c=l==null?void 0:l.notifications,_=(l==null?void 0:l.activeView)!=null;r("useSubscribeToNotifications")();var f=o("IGDThreadListNewMessageLoggingDataContext").useFlowInstanceIdContext(),g=o("IGDChatTabsQPLInstanceKeyContext.react").useIGDChatTabsQPLInstanceKeyContext(),h=r("MessengerWebUXLogger").useInteractionLogger(),y=_?o("IGDChatTabsStateTypes").IGDChatTabsMessagingInitiationSource.NotificationWithTabOpen:o("IGDChatTabsStateTypes").IGDChatTabsMessagingInitiationSource.NotificationWithJewel,C=r("useIGDOpenChatTab.react")(),b;a[0]!==i||a[1]!==f||a[2]!==y||a[3]!==h||a[4]!==C||a[5]!==g?(b=function(n){C(n.threadKey,y),i==null||i({messageId:n.messageId,type:"clear_notification"}),h==null||h({eventName:"igd_chat_tabs_notification_clicked",flowInstanceId:f});var t=g.threadViewKeys[n.threadKey]==null,a=o("Random").uint32();g.setThreadViewKey(n.threadKey,a),(e||(e=r("QuickPerformanceLogger"))).markerStart(r("qpl")._(882771792,"2790"),a),e.markerAnnotate(r("qpl")._(882771792,"2790"),{bool:{isFirstLoad:t},string:{trigger:"notification"}},{instanceKey:a})},a[0]=i,a[1]=f,a[2]=y,a[3]=h,a[4]=C,a[5]=g,a[6]=b):b=a[6];var v=b,S=(t=(n=document.documentElement)==null?void 0:n.clientHeight)!=null?t:0,R=(_?o("IGDChatTabsEnv").CHAT_TAB_HEIGHT+o("IGDChatTabSingleContainerStyles").CHAT_TAB_CONTAINER_MARGIN:o("IGDChatTabsJewelStyles").JEWEL_SIZE+o("IGDChatTabsJewelStyles").JEWEL_MARGIN)+(s?p:0),L=Math.min(Math.floor((S-R)/(o("IGDChatTabsEnv").NOTIFICATION_HEIGHT+o("IGDChatTabsEnv").NOTIFICATION_ROW_GAP)),m),E=r("useCometRelayEntrypointContextualEnvironmentProvider")(),k;a[7]!==E?(k=function(t){r("loadIGDChatTabEntryPoint")(E,t)},a[7]=E,a[8]=k):k=a[8];var I=k;if(c==null||c.size===0||L===0)return null;var T=s&&d.mobileNavRoot,D=_?d.chatTabsOpenRoot:d.chatTabsClosedRoot,x;a[9]!==T||a[10]!==D?(x=[d.root,T,D],a[9]=T,a[10]=D,a[11]=x):x=a[11];var $;a[12]!==c?($=Array.from(c.values()),a[12]=c,a[13]=$):$=a[13];var P;a[14]!==L||a[15]!==$?(P=$.slice(-L),a[14]=L,a[15]=$,a[16]=P):P=a[16];var N;a[17]!==v||a[18]!==I||a[19]!==P?(N=P.map(function(e,t){return u.jsx(r("CometPressable.react"),{expanding:!0,onHoverIn:function(){return I(e.threadKey)},onPress:function(){v(e)},role:"button",xstyle:d.pressableContainer,children:u.jsx(r("IGDChatTabMessageNotification.react"),{previewData:e})},t)}),a[17]=v,a[18]=I,a[19]=P,a[20]=N):N=a[20];var M;return a[21]!==x||a[22]!==N?(M=u.jsx(r("IGDSBox.react"),{direction:"columnReverse",xstyle:x,children:N}),a[21]=x,a[22]=N,a[23]=M):M=a[23],M}l.default=_}),98);
__d("IGDChatTabsContent.entrypoint",["IGPresenceUnifiedSetupQuery$Parameters","JSResourceForInteraction","PolarisViewerSettingsQuery$Parameters"],(function(t,n,r,o,a,i,l){"use strict";var e={getPreloadProps:function(t){var e={presenceSetupQueryRef:{parameters:r("IGPresenceUnifiedSetupQuery$Parameters"),variables:{}},viewerSettingsQueryRef:{parameters:r("PolarisViewerSettingsQuery$Parameters"),variables:{}}};return{queries:e}},root:r("JSResourceForInteraction")("IGDChatTabsContent.react").__setRef("IGDChatTabsContent.entrypoint")};l.default=e}),98);
__d("useIGDChatTabsRenderCircularJewel.react",["react-compiler-runtime","useGetPageIDFromCometRouterState.react","useIGDChatTabsReelsPageResize.react","usePolarisIsSmallScreen"],(function(t,n,r,o,a,i,l){"use strict";var e=new Set(["AdTools","boostMediaPage","mediaInsights","insightsMediaGrid"]);function s(){var t=o("react-compiler-runtime").c(2),n=r("useGetPageIDFromCometRouterState.react")(),a=r("usePolarisIsSmallScreen")(),i=r("useIGDChatTabsReelsPageResize.react")(),l=i[0];if(a||l)return!0;if(n==null)return!1;var s;return t[0]!==n?(s=e.has(n),t[0]=n,t[1]=s):s=t[1],s}l.default=s}),98);
__d("IGDChatTabsJewel.react",["fbt","CometPressable.react","IGDChatTabsJewelStyles","IGDChatTabsQPLInstanceKeyContext.react","IGDChatTabsStateContext.react","IGDChatTabsStateTypes","IGDSBox.react","IGDSDirectPrismOutline24Icon.react","IGDSText.react","IGDThreadListNewMessageLoggingDataContext","MessengerWebUXLogger","PolarisBadgeConstants","PolarisDirectNavItemBadge.react","PolarisDirectStringHelpers","PolarisPageTitle.react","QuickPerformanceLogger","Random","deferredLoadComponent","qpl","react","react-compiler-runtime","requireDeferred","useIGDChatTabsGetUnreadThreads.react","useIGDChatTabsRenderCircularJewel.react","usePolarisIsSmallScreen"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u,c=u||(u=o("react")),d=u.useCallback,m=r("deferredLoadComponent")(r("requireDeferred")("IGDChatTabsPOGs.react").__setRef("IGDChatTabsJewel.react")),p={directIcon:{marginTop:"xvijh9v",$$css:!0},jewelForMobileNav:{width:"x15yg21f",$$css:!0}},_=s._(/*BTDS*/"Messages");function f(){var t=o("react-compiler-runtime").c(50),n=o("IGDChatTabsStateContext.react").useIGDChatTabsDispatch(),a=o("IGDThreadListNewMessageLoggingDataContext").useFlowInstanceIdContext(),i=o("IGDChatTabsQPLInstanceKeyContext.react").useIGDChatTabsQPLInstanceKeyContext(),l=r("MessengerWebUXLogger").useInteractionLogger(),u=r("usePolarisIsSmallScreen")(),d=r("useIGDChatTabsGetUnreadThreads.react")(),f=d.length,h=f<o("PolarisBadgeConstants").BADGE_COUNT_LIMIT?String(f):o("PolarisBadgeConstants").BADGE_COUNT_LIMIT+"+",y=r("useIGDChatTabsRenderCircularJewel.react")(),C;t[0]!==n||t[1]!==a||t[2]!==l||t[3]!==i||t[4]!==f?(C=function(){n==null||n({type:"open_view",view:o("IGDChatTabsStateTypes").IGDChatTabsView.ChatTabsThreadListView}),l==null||l({eventName:"igd_chat_tabs_jewel_clicked",extraData:{unSeenCount:String(f)},flowInstanceId:a});var t=o("Random").uint32();(e||(e=r("QuickPerformanceLogger"))).markerStart(r("qpl")._(882771984,"2789"),t),i.threadListKey===0&&(e||(e=r("QuickPerformanceLogger"))).markerAnnotate(r("qpl")._(882771984,"2789"),{bool:{isFirstLoad:!0}},{instanceKey:t}),i.setThreadListKey(t)},t[0]=n,t[1]=a,t[2]=l,t[3]=i,t[4]=f,t[5]=C):C=t[5];var b=C,v;t[6]!==a?(v={eventName:"igd_chat_tabs_jewel",flowInstanceId:a},t[6]=a,t[7]=v):v=t[7];var S=r("MessengerWebUXLogger").useImpressionLoggerRef(v,g),R=r("MessengerWebUXLogger").useImpressionLogger(),L;t[8]!==a||t[9]!==R?(L=function(){R==null||R({eventName:"igd_chat_tabs_badge",flowInstanceId:a})},t[8]=a,t[9]=R,t[10]=L):L=t[10];var E=L,k;t[11]===Symbol.for("react.memo_cache_sentinel")?(k=c.jsx(r("IGDSDirectPrismOutline24Icon.react"),{alt:_,color:"ig-primary-icon"}),t[11]=k):k=t[11];var I=k,T;t[12]!==h||t[13]!==E||t[14]!==f?(T=f>0&&c.jsx(r("IGDSBox.react"),{containerRef:E,children:c.jsx(r("PolarisDirectNavItemBadge.react"),{ariaLabel:o("PolarisDirectStringHelpers").getBadgeNotificationAltText(f),badgeText:f>0?h:void 0})}),t[12]=h,t[13]=E,t[14]=f,t[15]=T):T=t[15];var D;t[16]!==T?(D=c.jsxs(r("IGDSBox.react"),{display:"flex",position:"relative",xstyle:p.directIcon,children:[I,T]}),t[16]=T,t[17]=D):D=t[17];var x=D,$;t[18]!==f?($=f>0?" - "+s._(/*BTDS*/"_j{\"*\":\"{notificationCount} new notifications\",\"_1\":\"{notificationCount} new notification\"}",[s._plural(f),s._param("notificationCount",f)]).toString():"",t[18]=f,t[19]=$):$=t[19];var P=$,N;t[20]===Symbol.for("react.memo_cache_sentinel")?(N=_.toString(),t[20]=N):N=t[20];var M=""+N+P,w=y?"column":"row",A=f===0?2:f<9?3:4,F;t[21]!==x||t[22]!==A?(F=c.jsx(r("IGDSBox.react"),{marginEnd:A,children:x}),t[21]=x,t[22]=A,t[23]=F):F=t[23];var O;t[24]===Symbol.for("react.memo_cache_sentinel")?(O=c.jsx(r("IGDSText.react"),{size:"label",weight:"semibold",zeroMargin:!1,children:_}),t[24]=O):O=t[24];var B;t[25]!==F?(B=c.jsxs(r("IGDSBox.react"),{alignItems:"center",direction:"row",children:[F,O]}),t[25]=F,t[26]=B):B=t[26];var W;t[27]!==b||t[28]!==d?(W=c.jsx(m,{onChatTabJewelClick:b,unreadThreads:d}),t[27]=b,t[28]=d,t[29]=W):W=t[29];var q;t[30]!==B||t[31]!==W||t[32]!==M||t[33]!==w?(q=c.jsxs(r("IGDSBox.react"),{accessibilityLabel:M,alignItems:"center",direction:w,display:"flex",justifyContent:"between",position:"relative",width:"100%",children:[B,W]}),t[30]=B,t[31]=W,t[32]=M,t[33]=w,t[34]=q):q=t[34];var U=q,V=u&&o("IGDChatTabsJewelStyles").IGDChatTabsJewelStyles.rootForMobileNav,H;t[35]!==V?(H=[o("IGDChatTabsJewelStyles").IGDChatTabsJewelStyles.root,V],t[35]=V,t[36]=H):H=t[36];var G;t[37]!==f?(G=c.jsx(r("PolarisPageTitle.react"),{badgeConfig:{badgeCount:f,badgeCountLimit:o("PolarisBadgeConstants").BADGE_COUNT_LIMIT}}),t[37]=f,t[38]=G):G=t[38];var z=y&&p.jewelForMobileNav,j;t[39]!==z?(j=[o("IGDChatTabsJewelStyles").IGDChatTabsJewelStyles.button,o("IGDChatTabsJewelStyles").IGDChatTabsJewelStyles.buttonExpanded,z],t[39]=z,t[40]=j):j=t[40];var K=y?x:U,Q;t[41]!==b||t[42]!==j||t[43]!==K?(Q=c.jsx(r("CometPressable.react"),{onPress:b,role:"button",testid:void 0,xstyle:j,children:K}),t[41]=b,t[42]=j,t[43]=K,t[44]=Q):Q=t[44];var X;return t[45]!==S||t[46]!==H||t[47]!==G||t[48]!==Q?(X=c.jsxs(r("IGDSBox.react"),{containerRef:S,xstyle:H,children:[G,Q]}),t[45]=S,t[46]=H,t[47]=G,t[48]=Q,t[49]=X):X=t[49],X}function g(){(e||(e=r("QuickPerformanceLogger"))).markerEnd(r("qpl")._(882775198,"2787"),2),e.markerAnnotate(r("qpl")._(25305590,"1127"),{string:{entrypoint:"igd_chat_tabs"}})}l.default=f}),226);
__d("IGDChatTabsOmnipickerHeader.react",["fbt","IGDChatTabsHeader.react","IGDChatTabsStateContext.react","IGDChatTabsStateTypes","IGDSText.react","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react")),c=e.useCallback;function d(){var e=o("react-compiler-runtime").c(8),t=o("IGDChatTabsStateContext.react").useIGDChatTabsDispatch(),n;e[0]===Symbol.for("react.memo_cache_sentinel")?(n=u.jsx(r("IGDSText.react"),{elementType:"h3",size:"label",weight:"semibold",zeroMargin:!1,children:s._(/*BTDS*/"New message")}),e[0]=n):n=e[0];var a=n,i;e[1]!==t?(i=function(){t==null||t({type:"open_view",view:o("IGDChatTabsStateTypes").IGDChatTabsView.ChatTabsThreadListView})},e[1]=t,e[2]=i):i=e[2];var l=i,c;e[3]!==t?(c=function(){t==null||t({type:"close_view",view:o("IGDChatTabsStateTypes").IGDChatTabsView.ChatTabsOmnipickerView})},e[3]=t,e[4]=c):c=e[4];var d=c,m;return e[5]!==l||e[6]!==d?(m=u.jsx(r("IGDChatTabsHeader.react"),{headerContent:a,headerType:"omnipicker",onClose:d,onGoBack:l}),e[5]=l,e[6]=d,e[7]=m):m=e[7],m}l.default=d}),226);
__d("IGDChatTabsOmnipickerPlaceholder.react",["IGDChatTabSingleTabContainer.react","IGDChatTabsOmnipickerHeader.react","IGDSBox.react","IGDSGlimmer.react","MWXSpinner.react","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u={chatButtonGlimmer:{borderStartStartRadius:"x1obq294",borderStartEndRadius:"x5a5i1n",borderEndEndRadius:"xde0f50",borderEndStartRadius:"x15x8krk",$$css:!0},glimmer:{height:"x5yr21d",width:"xh8yej3",$$css:!0}};function c(){var e=o("react-compiler-runtime").c(3),t;e[0]===Symbol.for("react.memo_cache_sentinel")?(t=s.jsx(r("IGDChatTabsOmnipickerHeader.react"),{}),e[0]=t):t=e[0];var n;e[1]===Symbol.for("react.memo_cache_sentinel")?(n=s.jsx(r("IGDSBox.react"),{height:400,justifyContent:"center",children:s.jsx(r("MWXSpinner.react"),{color:"disabled_DEPRECATED",size:32})}),e[1]=n):n=e[1];var a;return e[2]===Symbol.for("react.memo_cache_sentinel")?(a=s.jsxs(r("IGDChatTabSingleTabContainer.react"),{children:[t,s.jsxs(r("IGDSBox.react"),{alignItems:"center",direction:"column",children:[n,s.jsx(r("IGDSBox.react"),{height:44,paddingX:4,width:"100%",children:s.jsx(r("IGDSGlimmer.react"),{index:2,xstyle:[u.glimmer,u.chatButtonGlimmer]})})]})]}),e[2]=a):a=e[2],a}l.default=c}),98);
__d("IGDChatTabsOmnipickerContainerLazyLoaded.react",["CometPlaceholder.react","IGDChatTabsOmnipickerPlaceholder.react","IGDChatTabsStateContext.react","IGDChatTabsStateTypes","JSResourceForInteraction","lazyLoadComponent","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=r("lazyLoadComponent")(r("JSResourceForInteraction")("IGDChatTabsOmnipickerContainer.react").__setRef("IGDChatTabsOmnipickerContainerLazyLoaded.react"));function c(){var e=o("react-compiler-runtime").c(2),t=o("IGDChatTabsStateContext.react").useCurrentChatTabsView();if(t===o("IGDChatTabsStateTypes").IGDChatTabsView.ChatTabsOmnipickerView){var n;e[0]===Symbol.for("react.memo_cache_sentinel")?(n=s.jsx(r("IGDChatTabsOmnipickerPlaceholder.react"),{}),e[0]=n):n=e[0];var a;return e[1]===Symbol.for("react.memo_cache_sentinel")?(a=s.jsx(r("CometPlaceholder.react"),{fallback:n,name:i.id,children:s.jsx(u,{})}),e[1]=a):a=e[1],a}return null}l.default=c}),98);
__d("useIGDChatTabsReOpenTabFromInbox.react",["IGDChatTabsStateContext.react","IGDChatTabsStateTypes","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(e||(e=o("react"))).useEffect;function u(){var e=o("react-compiler-runtime").c(6),t=o("IGDChatTabsStateContext.react").useIGDChatTabsState(),n=o("IGDChatTabsStateContext.react").useIGDChatTabsDispatch(),r;e[0]!==n||e[1]!==(t==null?void 0:t.selectedThreadKeyFromInbox)?(r=function(){(t==null?void 0:t.selectedThreadKeyFromInbox)!=null&&(n==null||n({source:o("IGDChatTabsStateTypes").IGDChatTabsMessagingInitiationSource.DirectInbox,threadKey:t==null?void 0:t.selectedThreadKeyFromInbox,type:"open_tab"}))},e[0]=n,e[1]=t==null?void 0:t.selectedThreadKeyFromInbox,e[2]=r):r=e[2];var a=t==null?void 0:t.selectedThreadKeyFromInbox,i;e[3]!==n||e[4]!==a?(i=[n,a],e[3]=n,e[4]=a,e[5]=i):i=e[5],s(r,i)}l.default=u}),98);
__d("IGDChatTabsRootContent.react",["CometPageletWithDiv.react","CometRelay","HeroInteractionIgnoreWithDiv.react","IGDChatTabMessageNotificationsContainer.react","IGDChatTabsContent.entrypoint","IGDChatTabsJewel.react","IGDChatTabsJewelPlaceholder.react","IGDChatTabsOmnipickerContainerLazyLoaded.react","IGDChatTabsQPLInstanceKeyContext.react","IGDChatTabsStateContext.react","IGDChatTabsThemeProvider.react","IGDChatTabsThreadListContainerPlaceholder.react","IGDPageSetup.react","PolarisSuspenseWithErrorBoundary.react","react","react-compiler-runtime","useCometRelayEntrypointContextualEnvironmentProvider","useIGDChatTabsReOpenTabFromInbox.react","usePolarisIsTinyScreen"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react"));function u(){var e=o("react-compiler-runtime").c(14),t=o("IGDChatTabsStateContext.react").useIGDChatTabsState(),n=r("usePolarisIsTinyScreen")(),a=r("useCometRelayEntrypointContextualEnvironmentProvider")(),i=o("CometRelay").useEntryPointLoader(a,r("IGDChatTabsContent.entrypoint")),l=i[0],u=i[1];(t==null?void 0:t.activeView)!=null&&l==null&&u({}),r("useIGDChatTabsReOpenTabFromInbox.react")();var c;e[0]!==n?(c={0:"x1vjfegm",1:"x1vjfegm xlshs6z"}[!!n<<0],e[0]=n,e[1]=c):c=e[1];var d;e[2]===Symbol.for("react.memo_cache_sentinel")?(d=s.jsx(r("IGDChatTabsJewelPlaceholder.react"),{}),e[2]=d):d=e[2];var m;e[3]===Symbol.for("react.memo_cache_sentinel")?(m=s.jsx(r("IGDChatTabsJewelPlaceholder.react"),{}),e[3]=m):m=e[3];var p,_,f;e[4]===Symbol.for("react.memo_cache_sentinel")?(p=s.jsx(r("IGDChatTabsJewel.react"),{}),_=s.jsx(r("IGDChatTabMessageNotificationsContainer.react"),{}),f=s.jsx(r("IGDChatTabsOmnipickerContainerLazyLoaded.react"),{}),e[4]=p,e[5]=_,e[6]=f):(p=e[4],_=e[5],f=e[6]);var g;e[7]!==l?(g=l!=null&&s.jsx(r("PolarisSuspenseWithErrorBoundary.react"),{loadingRenderer:s.jsx(r("IGDChatTabsThreadListContainerPlaceholder.react"),{}),name:"IGDChatTabsContent",children:s.jsx(o("CometRelay").EntryPointContainer,{entryPointReference:l,props:{}})}),e[7]=l,e[8]=g):g=e[8];var h;e[9]!==g?(h=s.jsx(o("IGDChatTabsQPLInstanceKeyContext.react").IGDChatTabsQPLInstanceKeyContextProvider,{children:s.jsx(r("IGDChatTabsThemeProvider.react"),{children:s.jsx(r("HeroInteractionIgnoreWithDiv.react"),{children:s.jsxs(r("IGDPageSetup.react"),{disableRouteProvider:!0,placeholder:m,shouldUseDeferredLoadingStrategy:!1,threadDisplayType:"ChatTab",children:[p,_,f,g]})})})}),e[9]=g,e[10]=h):h=e[10];var y;return e[11]!==c||e[12]!==h?(y=s.jsx(o("CometPageletWithDiv.react").Placeholder,{className:c,fallback:d,name:"IGDChatTabsRootContent",children:h}),e[11]=c,e[12]=h,e[13]=y):y=e[13],y}l.default=u}),98);